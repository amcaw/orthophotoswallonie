import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Pe,K as C,A as ye,B as Re,C as he,J as ze,am as H,F as W,D as F,w as r,M as y,G as j}from"../chunks/Ehb9Q6W5.js";import{o as Me,e as A}from"../chunks/BKIJojkU.js";import{s as pe}from"../chunks/yJVuIktW.js";import{b as ae}from"../chunks/m2zDNTuv.js";import{i as Ie}from"../chunks/D631TkqT.js";import{S as _e,m as G,M as Fe}from"../chunks/VYvS0YDk.js";import{o as me}from"../chunks/C4AmPXCP.js";import{Y as ge}from"../chunks/Br037vyA.js";var Ge=ye('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div> <!></div> <!> <!></div>');function Ne(V,P){Pe(P,!1);let R=C(),X=C(),T=C(),n,w,N=C(50),E=!1,K=C({lng:4.35,lat:50.85}),Q=C(11);function ve(e){const i=me;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${i.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${i.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}const p=me.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let x=C(p[0].id),S=C(p[p.length-1].id);function we(e){e.preventDefault(),e.stopPropagation(),E=!0}function be(e){if(!E||!r(T))return;e.preventDefault();const i=r(T).getBoundingClientRect(),a=e.clientX-i.left;y(N,Math.max(0,Math.min(100,a/i.width*100)))}function xe(){E=!1}function Se(e){e.preventDefault(),e.stopPropagation(),E=!0}function Ce(e){if(!E||!r(T))return;e.preventDefault();const i=r(T).getBoundingClientRect(),a=e.touches[0].clientX-i.left;y(N,Math.max(0,Math.min(100,a/i.width*100)))}function Ee(){E=!1}function k(e,i){const a=e.getStyle();if(a?.layers)for(const s of a.layers){if(!s.id.endsWith("-layer"))continue;e.getLayer(s.id)&&e.removeLayer(s.id);const c=s.source;c&&e.getSource(c)&&e.removeSource(c)}i.layers.forEach(s=>{const c=s.id,M=`${s.id}-layer`;e.getSource(c)||e.addSource(c,{type:"raster",tiles:[ve(s)],tileSize:256,maxzoom:20}),e.getLayer(M)||e.addLayer({id:M,type:"raster",source:c,paint:{"raster-opacity":0,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),i.layers.forEach(s=>{const c=`${s.id}-layer`;e.getLayer(c)&&e.moveLayer(c)});const u=i.layers.map(s=>`${s.id}-layer`);let z=0;const Y=u.length,te=()=>{z++,z>=Y&&u.forEach(s=>{e.getLayer(s)&&e.setPaintProperty(s,"raster-opacity",1)})},Z=s=>{s.isSourceLoaded&&s.sourceId&&i.layers.some(c=>c.id===s.sourceId)&&te()};e.on("sourcedata",Z),setTimeout(()=>{e.off("sourcedata",Z),u.forEach(s=>{e.getLayer(s)&&e.getPaintProperty(s,"raster-opacity")===0&&e.setPaintProperty(s,"raster-opacity",1)})},2e3)}function Be(e){if(!n)return;const i=p.find(a=>a.id===e);if(i&&(k(n,i),y(x,e),typeof window<"u"&&n)){const a=n.getCenter(),u=n.getZoom();window.location.hash=`${a.lat.toFixed(6)},${a.lng.toFixed(6)},${u.toFixed(2)}z,${r(x)},${r(S)}`}}function Te(e){if(!w)return;const i=p.find(a=>a.id===e);if(i&&(k(w,i),y(S,e),typeof window<"u"&&n)){const a=n.getCenter(),u=n.getZoom();window.location.hash=`${a.lat.toFixed(6)},${a.lng.toFixed(6)},${u.toFixed(2)}z,${r(x)},${r(S)}`}}Me(async()=>{let e=null;const i=()=>{if(typeof window>"u")return!1;const o=window.location.hash.slice(1);if(!o)return!1;const t=o.split(",");if(t.length>=3){const l=parseFloat(t[0]),f=parseFloat(t[1]),v=parseFloat(t[2].replace("z",""));if(!isNaN(l)&&!isNaN(f)&&!isNaN(v)){if(e={center:[f,l],zoom:v},t.length>=5){const q=t[3],se=t[4];p.find(_=>_.id===q)&&y(x,q),p.find(_=>_.id===se)&&y(S,se)}return!0}}return!1};i()||(await new Promise(o=>setTimeout(o,10)),i());let a=!1;const u=new Map,z=[[4.243,50.764],[4.482,50.913]],Y=[[4.05,50.65],[4.68,51.05]],te=p.find(o=>o.id===r(x)),Z=p.find(o=>o.id===r(S));n=new G.Map({container:r(R),style:{version:8,sources:{},layers:[]},...e?{center:e.center,zoom:e.zoom}:{bounds:z,fitBoundsOptions:{padding:0}},minZoom:10,maxZoom:20,maxBounds:Y,attributionControl:!1}),w=new G.Map({container:r(X),style:{version:8,sources:{},layers:[]},...e?{center:e.center,zoom:e.zoom}:{bounds:z,fitBoundsOptions:{padding:0}},minZoom:10,maxZoom:20,maxBounds:Y,interactive:!1,attributionControl:!1}),n.once("load",()=>k(n,te)),w.once("load",()=>k(w,Z)),n.addControl(new G.NavigationControl,"bottom-left"),n.addControl(new G.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const s={forwardGeocode:async o=>{const t=(o.query??"").trim().toLowerCase();if(u.has(t))return u.get(t);const l=[];try{const v=encodeURIComponent(t);if(!v)return{type:"FeatureCollection",features:l};const q=`https://nominatim.openstreetmap.org/search?q=${v}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,_=await(await fetch(q,{headers:{"Accept-Language":"fr"}})).json();for(const m of _.features??[]){const ue=m.properties?.address?.region,U=m.properties?.address?.state;if(!(ue?.includes("Bruxelles")||ue?.includes("Brussels")||U==="Bruxelles-Capitale"||U==="Brussels Hoofdstedelijk Gewest"||U==="Région de Bruxelles-Capitale"||U==="Brussels-Capital"))continue;const ne=m.bbox,b=Array.isArray(ne)&&ne.length===4?ne.map(Number):void 0;let $;if(b)$=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2];else if(m.geometry?.type==="Point"&&Array.isArray(m.geometry.coordinates))$=[Number(m.geometry.coordinates[0]),Number(m.geometry.coordinates[1])];else{const B=[],fe=d=>{d&&(d.type==="Point"?B.push([+d.coordinates[0],+d.coordinates[1]]):d.type==="LineString"||d.type==="MultiPoint"?d.coordinates.forEach(g=>B.push([+g[0],+g[1]])):d.type==="Polygon"||d.type==="MultiLineString"?d.coordinates.flat(1).forEach(g=>B.push([+g[0],+g[1]])):d.type==="MultiPolygon"?d.coordinates.flat(2).forEach(g=>B.push([+g[0],+g[1]])):d.type==="GeometryCollection"&&(d.geometries||[]).forEach(fe))};if(fe(m.geometry),B.length){const d=B.map(ie=>ie[0]),g=B.map(ie=>ie[1]),L=[Math.min(...d),Math.min(...g),Math.max(...d),Math.max(...g)];$=[L[0]+(L[2]-L[0])/2,L[1]+(L[3]-L[1])/2]}else $=[4.3517,50.8503]}l.push({type:"Feature",geometry:{type:"Point",coordinates:$},place_name:m.properties?.display_name,properties:{...m.properties,bbox:b},text:m.properties?.display_name,place_type:["place"],center:$,bbox:b})}}catch(v){console.error("forwardGeocode error:",v)}const f={type:"FeatureCollection",features:l};if(u.size>=50){const v=u.keys().next().value;v!==void 0&&u.delete(v)}return u.set(t,f),f}},c=new Fe(s,{maplibregl:G,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});n.addControl(c,"top-left");const M=o=>{const t=o.bbox??o.properties?.bbox;t&&Array.isArray(t)&&t.length===4?n.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):n.flyTo({center:o.center,zoom:15,duration:1200})};let I=[],h=0;c.on("results",o=>{I=o.features||[],h=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(l=>l.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&o.addEventListener("keydown",t=>{const l=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&I.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const f=I[h];f&&(M(f),t.target.value="",c.clear(),I=[])}else t.key==="ArrowDown"&&l.length>0?(t.preventDefault(),h=Math.min(h+1,I.length-1),l.forEach(f=>f.classList.remove("active")),l[h]&&l[h].classList.add("active")):t.key==="ArrowUp"&&l.length>0&&(t.preventDefault(),h=Math.max(h-1,0),l.forEach(f=>f.classList.remove("active")),l[h]&&l[h].classList.add("active"))},!0)},100),c.on("result",o=>{const t=o.result;M(t),setTimeout(()=>{const l=document.querySelector(".maplibregl-ctrl-geocoder input");l&&(l.value=""),c.clear()},100)});const Ae=(o,t)=>{a||(a=!0,t.jumpTo({center:o.getCenter(),zoom:o.getZoom(),bearing:o.getBearing(),pitch:o.getPitch()}),requestAnimationFrame(()=>{a=!1}))};n.on("move",()=>{!E&&!a&&Ae(n,w);const o=n.getCenter();y(K,{lng:o.lng,lat:o.lat}),y(Q,n.getZoom()),typeof window<"u"&&(window.location.hash=`${o.lat.toFixed(6)},${o.lng.toFixed(6)},${r(Q).toFixed(2)}z,${r(x)},${r(S)}`)});let oe=null;const re=()=>{oe||(oe=window.setTimeout(()=>{n&&n.resize(),w&&w.resize(),oe=null},250))};return setTimeout(re,100),window.addEventListener("resize",re),()=>{window.removeEventListener("resize",re),n.remove(),w.remove()}}),Ie();var J=Ge();A("mousemove",H,be),A("mouseup",H,xe),A("touchmove",H,Ce),A("touchend",H,Ee);var D=W(J),le=W(D);ae(le,e=>y(R,e),()=>r(R));var ee=F(le,2);ae(ee,e=>y(X,e),()=>r(X));var O=F(ee,2),ce=W(O);j(O);var $e=F(O,2);_e($e,{get lat(){return r(K).lat},get lng(){return r(K).lng},get zoom(){return r(Q)},get yearBefore(){return r(x)},get yearAfter(){return r(S)}}),j(D),ae(D,e=>y(T,e),()=>r(T));var de=F(D,2);ge(de,{side:"left",get groups(){return p},get selectedId(){return r(x)},$$events:{select:e=>Be(e.detail.id)}});var Le=F(de,2);ge(Le,{side:"right",get groups(){return p},get selectedId(){return r(S)},$$events:{select:e=>Te(e.detail.id)}}),j(J),Re(()=>{pe(ee,`clip-path: inset(0 0 0 ${r(N)??""}%)`),pe(O,`left: ${r(N)??""}%`)}),A("mousedown",ce,we),A("touchstart",ce,Se),he(V,J),ze()}var ke=ye('<div class="page-container svelte-1ewpa8p"><!></div>');function Ke(V){var P=ke(),R=W(P);Ne(R,{}),j(P),he(V,P)}export{Ke as component};
