import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Ze,K as A,A as Ae,B as je,C as Le,J as Ve,am as Y,F as X,D as U,w as l,M as y,G as J}from"../chunks/Ehb9Q6W5.js";import{o as Xe,e as I}from"../chunks/BKIJojkU.js";import{s as xe}from"../chunks/yJVuIktW.js";import{b as pe}from"../chunks/m2zDNTuv.js";import{i as Je}from"../chunks/D631TkqT.js";import{S as Ke,m as q,M as Qe}from"../chunks/VYvS0YDk.js";import{o as Be}from"../chunks/C4AmPXCP.js";import{Y as Me}from"../chunks/Br037vyA.js";var et=Ae('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div> <!></div> <!> <!></div>');function tt(K,F){Ze(F,!1);let G=A(),Q=A(),$=A(),n,m,ee=A(50),C=!1,te=null;function me(e){y(ee,e),te&&cancelAnimationFrame(te),te=requestAnimationFrame(()=>{m&&m.triggerRepaint()})}let oe=A({lng:4.35,lat:50.85}),ge=A(11);function Re(e,r=512){const a=Be;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${a.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${r}&HEIGHT=${r}&BBOX={bbox-epsg-3857}`:`${a.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${r}&HEIGHT=${r}&BBOX={bbox-epsg-3857}`}const he=new WeakMap;function Ie(e){let r=he.get(e);return r||(r=new Set,he.set(e,r)),r}function $e(e,r,a=3e3){return new Promise(d=>{let f=!1;const c=()=>{f||(f=!0,j(),d())},B=()=>{r.every(L=>{const O=L.replace(/-layer$/,"");return!!e.getSource(O)&&e.isSourceLoaded(O)})&&e.areTilesLoaded()&&c()},ne=setTimeout(c,a),j=()=>{e.off("idle",B),clearTimeout(ne)};e.on("idle",B),B()})}function _e(e,r,a=512){const d=r.id,f=`${r.id}-layer`;return e.getSource(d)||e.addSource(d,{type:"raster",tiles:[Re(r,a)],tileSize:a,maxzoom:20}),e.getLayer(f)||e.addLayer({id:f,type:"raster",source:d,layout:{visibility:"visible"},paint:{"raster-opacity":0,"raster-fade-duration":300,"raster-resampling":"nearest"}}),f}const g=Be.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let E=A(g[0].id),x=A(g[g.length-1].id);function Ne(e){e.preventDefault(),e.stopPropagation(),C=!0}function ze(e){if(!C||!l($))return;e.preventDefault();const r=l($).getBoundingClientRect(),a=e.clientX-r.left;me(Math.max(0,Math.min(100,a/r.width*100)))}function Pe(){C=!1}function Fe(e){C=!0}function Ge(e){if(!C||!l($))return;const r=l($).getBoundingClientRect(),a=e.touches[0].clientX-r.left;me(Math.max(0,Math.min(100,a/r.width*100)))}function ke(){C=!1}function Oe(){C=!1}async function _(e,r){const a=Ie(e),d=[...a],f=r.layers.map(c=>_e(e,c,512));f.forEach(c=>e.moveLayer(c)),await $e(e,f,3e3),f.forEach(c=>{e.getLayer(c)&&e.setPaintProperty(c,"raster-opacity",1)}),d.forEach(c=>{e.getLayer(c)&&e.setPaintProperty(c,"raster-opacity",0)}),setTimeout(()=>{d.forEach(c=>{if(!f.includes(c)){const B=c.replace(/-layer$/,"");e.getLayer(c)&&e.removeLayer(c),e.getSource(B)&&e.removeSource(B),a.delete(c)}}),f.forEach(c=>a.add(c))},400)}let k=null;function He(e){if(!n)return;const r=g.find(a=>a.id===e);r&&(_(n,r),y(E,e),k&&k(!0))}function De(e){if(!m)return;const r=g.find(a=>a.id===e);r&&(_(m,r),y(x,e),k&&k(!0))}Xe(()=>{let e=null;(()=>{if(typeof window>"u")return!1;const o=window.location.hash.slice(1);if(!o)return!1;const t=o.split(",");if(t.length>=3){const s=parseFloat(t[0]),i=parseFloat(t[1]),h=parseFloat(t[2].replace("z",""));if(!isNaN(s)&&!isNaN(i)&&!isNaN(h)){if(e={center:[i,s],zoom:h},t.length>=5){const S=t[3],M=t[4];g.find(v=>v.id===S)&&y(E,S),g.find(v=>v.id===M)&&y(x,M)}return!0}}return!1})();let a=!1;const d=new Map,f=[[4.243,50.764],[4.482,50.913]],c=[[4.05,50.65],[4.68,51.05]],B=g.find(o=>o.id===l(E)),ne=g.find(o=>o.id===l(x)),j={version:8,sources:{positron:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://b.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://c.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> © <a href="https://carto.com/attributions">CARTO</a>'}},layers:[{id:"positron-layer",type:"raster",source:"positron",paint:{"raster-opacity":1}}]},N={container:l(G),style:j,minZoom:10,maxZoom:20,maxBounds:c,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(N.center=e.center,N.zoom=e.zoom):(N.bounds=f,N.fitBoundsOptions={padding:0}),n=new q.Map(N);const L={container:l(Q),style:JSON.parse(JSON.stringify(j)),minZoom:10,maxZoom:20,maxBounds:c,interactive:!1,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(L.center=e.center,L.zoom=e.zoom):(L.bounds=f,L.fitBoundsOptions={padding:0}),m=new q.Map(L);const O=new Map,ae=o=>t=>{if(console.warn("Map error:",t?.error?.status,t?.sourceId),t.sourceId&&t.error?.status>=500){const s=O.get(t.sourceId)||0;s<2&&(O.set(t.sourceId,s+1),setTimeout(()=>{const i=o.getSource(t.sourceId);i&&"reload"in i&&i.reload()},1e3*(s+1)))}};n.on("error",ae(n)),m.on("error",ae(m)),n.once("load",()=>_(n,B)),m.once("load",()=>_(m,ne)),n.addControl(new q.NavigationControl,"bottom-left"),n.addControl(new q.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const qe={forwardGeocode:async o=>{const t=(o.query??"").trim().toLowerCase();if(d.has(t))return d.get(t);const s=[];try{const h=encodeURIComponent(t);if(!h)return{type:"FeatureCollection",features:s};const S=`https://nominatim.openstreetmap.org/search?q=${h}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,v=await(await fetch(S,{headers:{"Accept-Language":"fr"}})).json();for(const p of v.features??[]){const Ce=p.properties?.address?.region,V=p.properties?.address?.state;if(!(Ce?.includes("Bruxelles")||Ce?.includes("Brussels")||V==="Bruxelles-Capitale"||V==="Brussels Hoofdstedelijk Gewest"||V==="Région de Bruxelles-Capitale"||V==="Brussels-Capital"))continue;const de=p.bbox,T=Array.isArray(de)&&de.length===4?de.map(Number):void 0;let z;if(T)z=[T[0]+(T[2]-T[0])/2,T[1]+(T[3]-T[1])/2];else if(p.geometry?.type==="Point"&&Array.isArray(p.geometry.coordinates))z=[Number(p.geometry.coordinates[0]),Number(p.geometry.coordinates[1])];else{const R=[],Ee=u=>{u&&(u.type==="Point"?R.push([+u.coordinates[0],+u.coordinates[1]]):u.type==="LineString"||u.type==="MultiPoint"?u.coordinates.forEach(b=>R.push([+b[0],+b[1]])):u.type==="Polygon"||u.type==="MultiLineString"?u.coordinates.flat(1).forEach(b=>R.push([+b[0],+b[1]])):u.type==="MultiPolygon"?u.coordinates.flat(2).forEach(b=>R.push([+b[0],+b[1]])):u.type==="GeometryCollection"&&(u.geometries||[]).forEach(Ee))};if(Ee(p.geometry),R.length){const u=R.map(fe=>fe[0]),b=R.map(fe=>fe[1]),P=[Math.min(...u),Math.min(...b),Math.max(...u),Math.max(...b)];z=[P[0]+(P[2]-P[0])/2,P[1]+(P[3]-P[1])/2]}else z=[4.3517,50.8503]}s.push({type:"Feature",geometry:{type:"Point",coordinates:z},place_name:p.properties?.display_name,properties:{...p.properties,bbox:T},text:p.properties?.display_name,place_type:["place"],center:z,bbox:T})}}catch(h){console.error("forwardGeocode error:",h)}const i={type:"FeatureCollection",features:s};if(d.size>=50){const h=d.keys().next().value;h!==void 0&&d.delete(h)}return d.set(t,i),i}},H=new Qe(qe,{maplibregl:q,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});n.addControl(H,"top-left");const we=o=>{const t=o.bbox??o.properties?.bbox;t&&Array.isArray(t)&&t.length===4?n.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):n.flyTo({center:o.center,zoom:15,duration:1200})};let D=[],w=0;H.on("results",o=>{D=o.features||[],w=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(s=>s.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&o.addEventListener("keydown",t=>{const s=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&D.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const i=D[w];i&&(we(i),t.target.value="",H.clear(),D=[])}else t.key==="ArrowDown"&&s.length>0?(t.preventDefault(),w=Math.min(w+1,D.length-1),s.forEach(i=>i.classList.remove("active")),s[w]&&s[w].classList.add("active")):t.key==="ArrowUp"&&s.length>0&&(t.preventDefault(),w=Math.max(w-1,0),s.forEach(i=>i.classList.remove("active")),s[w]&&s[w].classList.add("active"))},!0)},100),H.on("result",o=>{const t=o.result;we(t),setTimeout(()=>{const s=document.querySelector(".maplibregl-ctrl-geocoder input");s&&(s.value=""),H.clear()},100)});const We=(o,t)=>{a||(a=!0,t.jumpTo({center:o.getCenter(),zoom:o.getZoom(),bearing:o.getBearing(),pitch:o.getPitch()}),requestAnimationFrame(()=>{a=!1}))};let ie=null,Se="";const le=(o=!1)=>{if(typeof window>"u"||!n)return;const t=n.getCenter(),s=n.getZoom(),i=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${s.toFixed(2)}z,${l(E)},${l(x)}`;i!==Se&&(Se=i,o?window.location.hash=i:history.replaceState(null,"",`#${i}`))};k=le,n.on("move",()=>{!C&&!a&&We(n,m);const o=n.getCenter();y(oe,{lng:o.lng,lat:o.lat}),y(ge,n.getZoom()),le(!1),ie&&clearTimeout(ie),ie=window.setTimeout(()=>{le(!0)},1e3)});let ce=null;const ue=()=>{ce||(ce=window.setTimeout(()=>{n&&n.resize(),m&&m.resize(),ce=null},250))};setTimeout(ue,100),window.addEventListener("resize",ue);const Te=()=>{if(typeof window>"u")return;const o=window.location.hash.slice(1);if(!o)return;const t=o.split(",");if(t.length>=3){const s=parseFloat(t[0]),i=parseFloat(t[1]),h=parseFloat(t[2].replace("z",""));if(!isNaN(s)&&!isNaN(i)&&!isNaN(h)&&(n&&n.flyTo({center:[i,s],zoom:h,duration:1e3}),t.length>=5)){const S=t[3],M=t[4];if(S&&S!==l(E)){const v=g.find(p=>p.id===S);v&&(y(E,S),_(n,v))}if(M&&M!==l(x)){const v=g.find(p=>p.id===M);v&&(y(x,M),_(m,v))}}}};return window.addEventListener("hashchange",Te),()=>{window.removeEventListener("resize",ue),window.removeEventListener("hashchange",Te),n.remove(),m.remove()}}),Je();var re=et();I("mousemove",Y,ze),I("mouseup",Y,Pe),I("touchmove",Y,Ge),I("touchend",Y,ke),I("touchcancel",Y,Oe);var W=X(re),ye=X(W);pe(ye,e=>y(G,e),()=>l(G));var se=U(ye,2);pe(se,e=>y(Q,e),()=>l(Q));var Z=U(se,2),ve=X(Z);J(Z);var Ye=U(Z,2);Ke(Ye,{get lat(){return l(oe).lat},get lng(){return l(oe).lng},get zoom(){return l(ge)},get yearBefore(){return l(E)},get yearAfter(){return l(x)}}),J(W),pe(W,e=>y($,e),()=>l($));var be=U(W,2);Me(be,{side:"left",get groups(){return g},get selectedId(){return l(E)},$$events:{select:e=>He(e.detail.id)}});var Ue=U(be,2);Me(Ue,{side:"right",get groups(){return g},get selectedId(){return l(x)},$$events:{select:e=>De(e.detail.id)}}),J(re),je(()=>{xe(se,`clip-path: inset(0 0 0 calc(${l(ee)??""}% - 0.5px))`),xe(Z,`left: ${l(ee)??""}%`)}),I("mousedown",ve,Ne),I("touchstart",ve,Fe),Le(K,re),Ve()}var ot=Ae('<div class="page-container svelte-1ewpa8p"><!></div>');function mt(K){var F=ot(),G=X(F);tt(G,{}),J(F),Le(K,F)}export{mt as component};
