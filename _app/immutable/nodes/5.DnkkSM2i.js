import"../chunks/DsnmJJEf.js";import"../chunks/CQmyZwkG.js";import{I as Je,K as L,A as $e,B as Xe,C as Ne,J as Ke,F as te,D as k,w as i,M as v,G as re}from"../chunks/CwdBl0A7.js";import{o as Qe,e as Q}from"../chunks/CWmqxiNW.js";import{s as Pe}from"../chunks/CrLrFCfu.js";import{b as ee}from"../chunks/Cgb6JafD.js";import{i as et}from"../chunks/Ci2bA8W4.js";import{S as tt,m as q,M as rt}from"../chunks/TnEXErsI.js";import{o as Me}from"../chunks/C4AmPXCP.js";import{Y as _e}from"../chunks/D2JjHbTp.js";var ot=$e('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="geocoder-overlay svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div> <!></div> <!> <!></div>');function nt(oe,G){Je(G,!1);let H=L(),ne=L(),Y=L(),D=L(),a,m,se=L(50),W=!1,U=null,ae=null;function ze(e){v(se,e),ae&&cancelAnimationFrame(ae),ae=requestAnimationFrame(()=>{m&&m.triggerRepaint()})}let ie=L({lng:4.35,lat:50.85}),we=L(11);function Fe(e,n=512){const c=Me;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${c.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${n}&HEIGHT=${n}&BBOX={bbox-epsg-3857}`:`${c.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${n}&HEIGHT=${n}&BBOX={bbox-epsg-3857}`}const be=new WeakMap;function ke(e){let n=be.get(e);return n||(n=new Set,be.set(e,n)),n}let Se=new Set;function Ge(e,n,c=3e3){return new Promise(f=>{let g=!1;const E=()=>{g||(g=!0,M(),Se.delete(T),f())},T=()=>{g||(console.log("Tile wait cancelled - user is interacting"),E())};Se.add(T);const l=()=>{n.every(J=>{const X=J.replace(/-layer$/,"");return!!e.getSource(X)&&e.isSourceLoaded(X)})&&e.areTilesLoaded()&&E()},B=()=>{console.log("Map movement detected - finishing tile wait early"),E()},P=setTimeout(E,c),M=()=>{e.off("idle",l),e.off("movestart",B),clearTimeout(P)};e.on("idle",l),e.on("movestart",B),l()})}function He(e,n,c=512){const f=n.id,g=`${n.id}-layer`;return e.getSource(f)||e.addSource(f,{type:"raster",tiles:[Fe(n,c)],tileSize:c,maxzoom:20}),e.getLayer(g)||e.addLayer({id:g,type:"raster",source:f,layout:{visibility:"visible"},paint:{"raster-opacity":0,"raster-fade-duration":300,"raster-resampling":"nearest"}}),g}const h=Me.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let x=L(h[0].id),A=L(h[h.length-1].id);function Oe(e){e.currentTarget.setPointerCapture(e.pointerId),U=e.pointerId,W=!0}function qe(e){if(!W||U!==e.pointerId||!i(Y))return;const n=i(Y).getBoundingClientRect(),c=e.clientX-n.left;ze(Math.max(0,Math.min(100,c/n.width*100)))}function Ee(e){if(U===e.pointerId){const n=e.currentTarget;try{n.releasePointerCapture(e.pointerId)}catch{}W=!1,U=null}}const le=new WeakMap;async function N(e,n){const c=le.get(e);c&&(console.log("Waiting for previous layer change to complete..."),await c);const f=(async()=>{const g=ke(e),E=[...g],T=n.layers.map(l=>He(e,l,512));requestAnimationFrame(()=>{T.forEach(l=>{e.getLayer(l)&&e.moveLayer(l)})}),await Ge(e,T,1500),requestAnimationFrame(()=>{T.forEach(l=>{e.getLayer(l)&&e.setPaintProperty(l,"raster-opacity",1)}),E.forEach(l=>{e.getLayer(l)&&e.setPaintProperty(l,"raster-opacity",0)})}),setTimeout(()=>{E.forEach(l=>{if(!T.includes(l)){const B=l.replace(/-layer$/,"");e.getLayer(l)&&e.removeLayer(l),e.getSource(B)&&e.removeSource(B),g.delete(l)}}),T.forEach(l=>g.add(l))},400)})();le.set(e,f),await f,le.delete(e)}let O=null;function Ye(e){if(!a)return;const n=h.find(c=>c.id===e);n&&(N(a,n),v(x,e),O&&O(!0))}function De(e){if(!m)return;const n=h.find(c=>c.id===e);n&&(N(m,n),v(A,e),O&&O(!0))}Qe(()=>{let e=null;(()=>{if(typeof window>"u")return!1;const r=window.location.hash.slice(1);if(!r)return!1;const t=r.split(",");if(t.length>=3){const o=parseFloat(t[0]),s=parseFloat(t[1]),d=parseFloat(t[2].replace("z",""));if(!isNaN(o)&&!isNaN(s)&&!isNaN(d)){if(e={center:[s,o],zoom:d},t.length>=5){const w=t[3],y=t[4];h.find(b=>b.id===w)&&v(x,w),h.find(b=>b.id===y)&&v(A,y)}return!0}}return!1})();let c=!1;const f=new Map,g=[[4.243,50.764],[4.482,50.913]],E=[[4.05,50.65],[4.68,51.05]],T=h.find(r=>r.id===i(x)),l=h.find(r=>r.id===i(A)),B={version:8,sources:{positron:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://b.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://c.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> © <a href="https://carto.com/attributions">CARTO</a>'}},layers:[{id:"positron-layer",type:"raster",source:"positron",paint:{"raster-opacity":1}}]},P={container:i(H),style:B,minZoom:10,maxZoom:20,maxBounds:E,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(P.center=e.center,P.zoom=e.zoom):(P.bounds=g,P.fitBoundsOptions={padding:0}),a=new q.Map(P);const M={container:i(ne),style:JSON.parse(JSON.stringify(B)),minZoom:10,maxZoom:20,maxBounds:E,interactive:!1,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(M.center=e.center,M.zoom=e.zoom):(M.bounds=g,M.fitBoundsOptions={padding:0}),m=new q.Map(M);const ue=new Map,J=r=>t=>{if(console.warn("Map error:",t?.error?.status,t?.sourceId),t.sourceId&&t.error?.status>=500){const o=ue.get(t.sourceId)||0;o<2&&(ue.set(t.sourceId,o+1),setTimeout(()=>{const s=r.getSource(t.sourceId);s&&"reload"in s&&s.reload()},1e3*(o+1)))}};a.on("error",J(a)),m.on("error",J(m)),a.once("load",()=>N(a,T)),m.once("load",()=>N(m,l)),a.addControl(new q.NavigationControl,"bottom-left"),a.addControl(new q.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const X={forwardGeocode:async r=>{const t=(r.query??"").trim().toLowerCase();if(f.has(t))return f.get(t);const o=[];try{const d=encodeURIComponent(t);if(!d)return{type:"FeatureCollection",features:o};const w=`https://nominatim.openstreetmap.org/search?q=${d}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,b=await(await fetch(w,{headers:{"Accept-Language":"fr"}})).json();for(const p of b.features??[]){const Be=p.properties?.address?.region,K=p.properties?.address?.state;if(!(Be?.includes("Bruxelles")||Be?.includes("Brussels")||K==="Bruxelles-Capitale"||K==="Brussels Hoofdstedelijk Gewest"||K==="Région de Bruxelles-Capitale"||K==="Brussels-Capital"))continue;const ye=p.bbox,I=Array.isArray(ye)&&ye.length===4?ye.map(Number):void 0;let z;if(I)z=[I[0]+(I[2]-I[0])/2,I[1]+(I[3]-I[1])/2];else if(p.geometry?.type==="Point"&&Array.isArray(p.geometry.coordinates))z=[Number(p.geometry.coordinates[0]),Number(p.geometry.coordinates[1])];else{const $=[],Re=u=>{u&&(u.type==="Point"?$.push([+u.coordinates[0],+u.coordinates[1]]):u.type==="LineString"||u.type==="MultiPoint"?u.coordinates.forEach(S=>$.push([+S[0],+S[1]])):u.type==="Polygon"||u.type==="MultiLineString"?u.coordinates.flat(1).forEach(S=>$.push([+S[0],+S[1]])):u.type==="MultiPolygon"?u.coordinates.flat(2).forEach(S=>$.push([+S[0],+S[1]])):u.type==="GeometryCollection"&&(u.geometries||[]).forEach(Re))};if(Re(p.geometry),$.length){const u=$.map(ve=>ve[0]),S=$.map(ve=>ve[1]),F=[Math.min(...u),Math.min(...S),Math.max(...u),Math.max(...S)];z=[F[0]+(F[2]-F[0])/2,F[1]+(F[3]-F[1])/2]}else z=[4.3517,50.8503]}o.push({type:"Feature",geometry:{type:"Point",coordinates:z},place_name:p.properties?.display_name,properties:{...p.properties,bbox:I},text:p.properties?.display_name,place_type:["place"],center:z,bbox:I})}}catch(d){console.error("forwardGeocode error:",d)}const s={type:"FeatureCollection",features:o};if(f.size>=50){const d=f.keys().next().value;d!==void 0&&f.delete(d)}return f.set(t,s),s}},_=new rt(X,{maplibregl:q,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1}),Ze=_.onAdd(a);i(D)&&i(D).appendChild(Ze);const fe=r=>{const t=r.bbox??r.properties?.bbox;t&&Array.isArray(t)&&t.length===4?a.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):a.flyTo({center:r.center,zoom:15,duration:1200})};let R=[],C=0;_.on("results",r=>{R=r.features||[],C=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(o=>o.classList.remove("active")),t[0].classList.add("active"),t.forEach((o,s)=>{const d=w=>{if(w.preventDefault(),w.stopPropagation(),R[s]){const y=document.querySelector(".maplibregl-ctrl-geocoder input");y&&y.blur(),fe(R[s]),setTimeout(()=>{y&&(y.value=""),_.clear(),R=[]},100)}};o.removeEventListener("touchend",d),o.removeEventListener("click",d),o.addEventListener("touchend",d,{passive:!1}),o.addEventListener("click",d)}))},50)}),setTimeout(()=>{const r=document.querySelector(".maplibregl-ctrl-geocoder input");r&&r.addEventListener("keydown",t=>{const o=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&R.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const s=R[C];s&&(fe(s),t.target.value="",_.clear(),R=[])}else t.key==="ArrowDown"&&o.length>0?(t.preventDefault(),C=Math.min(C+1,R.length-1),o.forEach(s=>s.classList.remove("active")),o[C]&&o[C].classList.add("active")):t.key==="ArrowUp"&&o.length>0&&(t.preventDefault(),C=Math.max(C-1,0),o.forEach(s=>s.classList.remove("active")),o[C]&&o[C].classList.add("active"))},!0)},100),_.on("result",r=>{const t=r.result;fe(t),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&(o.value=""),_.clear()},100)});const je=(r,t)=>{c||(c=!0,t.jumpTo({center:r.getCenter(),zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch()}),requestAnimationFrame(()=>{c=!1}))};let pe=null,Le="";const me=(r=!1)=>{if(typeof window>"u"||!a)return;const t=a.getCenter(),o=a.getZoom(),s=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${o.toFixed(2)}z,${i(x)},${i(A)}`;s!==Le&&(Le=s,r?window.location.hash=s:history.replaceState(null,"",`#${s}`))};O=me;let xe=0;a.on("move",()=>{!W&&!c&&je(a,m);const r=a.getCenter();v(ie,{lng:r.lng,lat:r.lat}),v(we,a.getZoom());const t=performance.now();t-xe>120&&(me(!1),xe=t),pe&&clearTimeout(pe),pe=window.setTimeout(()=>{me(!0)},800)});let ge=null;const he=()=>{ge||(ge=window.setTimeout(()=>{a&&a.resize(),m&&m.resize(),ge=null},250))};setTimeout(he,100),window.addEventListener("resize",he);const Ae=()=>{if(typeof window>"u")return;const r=window.location.hash.slice(1);if(!r)return;const t=r.split(",");if(t.length>=3){const o=parseFloat(t[0]),s=parseFloat(t[1]),d=parseFloat(t[2].replace("z",""));if(!isNaN(o)&&!isNaN(s)&&!isNaN(d)&&(a&&a.flyTo({center:[s,o],zoom:d,duration:1e3}),t.length>=5)){const w=t[3],y=t[4];if(w&&w!==i(x)){const b=h.find(p=>p.id===w);b&&(v(x,w),N(a,b))}if(y&&y!==i(A)){const b=h.find(p=>p.id===y);b&&(v(A,y),N(m,b))}}}};window.addEventListener("hashchange",Ae);const Ve=setInterval(()=>{c&&(console.warn("isSyncing stuck - forcing reset"),c=!1)},5e3);return()=>{window.removeEventListener("resize",he),window.removeEventListener("hashchange",Ae),clearInterval(Ve),a.remove(),m.remove()}}),et();var ce=ot(),Z=te(ce),Te=te(Z);ee(Te,e=>v(H,e),()=>i(H));var de=k(Te,2);ee(de,e=>v(ne,e),()=>i(ne));var Ce=k(de,2);ee(Ce,e=>v(D,e),()=>i(D));var j=k(Ce,2),V=te(j);re(j);var We=k(j,2);tt(We,{get lat(){return i(ie).lat},get lng(){return i(ie).lng},get zoom(){return i(we)},get yearBefore(){return i(x)},get yearAfter(){return i(A)}}),re(Z),ee(Z,e=>v(Y,e),()=>i(Y));var Ie=k(Z,2);_e(Ie,{side:"left",get groups(){return h},get selectedId(){return i(x)},$$events:{select:e=>Ye(e.detail.id)}});var Ue=k(Ie,2);_e(Ue,{side:"right",get groups(){return h},get selectedId(){return i(A)},$$events:{select:e=>De(e.detail.id)}}),re(ce),Xe(()=>{Pe(de,`clip-path: inset(0 0 0 calc(${i(se)??""}% - 0.5px))`),Pe(j,`left: ${i(se)??""}%`)}),Q("pointerdown",V,Oe),Q("pointermove",V,qe),Q("pointerup",V,Ee),Q("pointercancel",V,Ee),Ne(oe,ce),Ke()}var st=$e('<div class="page-container svelte-1ewpa8p"><!></div>');function yt(oe){var G=st(),H=te(G);nt(H,{}),re(G),Ne(oe,G)}export{yt as component};
