import"../chunks/DsnmJJEf.js";import"../chunks/T5vn-GjU.js";import{I as he,A as ie,B as ye,C as le,J as be,w as p,K as M,M as B,F as ce,D as Z,G as pe}from"../chunks/HUyCGl9y.js";import{o as ve,e as we}from"../chunks/Ba58zEHK.js";import{s as se,m as h,M as ae}from"../chunks/DvzMNcMn.js";import{b as ne}from"../chunks/BIZiTCpg.js";import{i as xe}from"../chunks/7nCQ08Wj.js";import{o as U}from"../chunks/C4AmPXCP.js";import{S as Se}from"../chunks/Dv3aDMON.js";var Ce=ie('<div class="map-lens-wrapper svelte-lapvzq"><div></div> <div></div> <div class="lens-border svelte-lapvzq"></div> <button class="swap-button svelte-lapvzq" title="Inverser les couches"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-lapvzq"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg></button> <!></div>');function ze(k,w){he(w,!1);let x=M(),L=M(),i,s,E=M(!1),N=M({lng:4.35,lat:50.85}),P=M(11);const de=[[4.243,50.764],[4.482,50.913]],j=[[4.05,50.65],[4.68,51.05]];function D(a){const f=U;return a.service==="urban-brussels"&&a.crs==="EPSG:31370"?`${f.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${a.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${f.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${a.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}function ue(){B(E,!p(E))}ve(()=>{let a;const f=()=>{if(typeof window>"u")return!1;const t=window.location.hash.slice(1);if(!t)return!1;const e=t.split(",");if(e.length===3){const o=parseFloat(e[0]),n=parseFloat(e[1]),u=parseFloat(e[2].replace("z",""));if(!isNaN(o)&&!isNaN(n)&&!isNaN(u))return a={center:[n,o],zoom:u},!0}return!1};f()||setTimeout(()=>f(),10);let S=!1;const y=new Map,T=U.orthophotos.find(t=>t.id==="ortho-1971"),R=U.orthophotos.find(t=>t.id==="ortho-2024"),K=a?{center:a.center,zoom:a.zoom}:{bounds:de,fitBoundsOptions:{padding:20}};s=new h.Map({container:p(L),style:{version:8,sources:{positron:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://b.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://c.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> © <a href="https://carto.com/attributions">CARTO</a>'},[R.id]:{type:"raster",tiles:[D(R)],tileSize:256}},layers:[{id:"positron-layer",type:"raster",source:"positron",paint:{"raster-opacity":1}},{id:`${R.id}-layer`,type:"raster",source:R.id,paint:{"raster-opacity":1,"raster-fade-duration":300}}]},...K,minZoom:10,maxZoom:20,maxBounds:j,attributionControl:!1}),i=new h.Map({container:p(x),style:{version:8,sources:{positron:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://b.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://c.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> © <a href="https://carto.com/attributions">CARTO</a>'},[T.id]:{type:"raster",tiles:[D(T)],tileSize:256}},layers:[{id:"positron-layer",type:"raster",source:"positron",paint:{"raster-opacity":1}},{id:`${T.id}-layer`,type:"raster",source:T.id,paint:{"raster-opacity":1,"raster-fade-duration":300}}]},...K,minZoom:10,maxZoom:20,maxBounds:j,attributionControl:!1}),s.on("error",t=>{console.warn("AfterMap tile loading error:",t)}),i.on("error",t=>{console.warn("BeforeMap tile loading error:",t)}),s.addControl(new h.NavigationControl,"bottom-left"),i.addControl(new h.NavigationControl,"bottom-left"),s.addControl(new h.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Orthophotos: <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> & <a href="https://bruciel.brussels/" target="_blank">Bruciel</a> (CC-BY)'}),"bottom-right");const Q={forwardGeocode:async t=>{const e=(t.query??"").trim().toLowerCase();if(y.has(e))return y.get(e);const o=[];try{const u=encodeURIComponent(e);if(!u)return{type:"FeatureCollection",features:o};const fe=`https://nominatim.openstreetmap.org/search?q=${u}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,ge=await(await fetch(fe,{headers:{"Accept-Language":"fr"}})).json();for(const l of ge.features??[]){const oe=l.properties?.address?.region,_=l.properties?.address?.state;if(!(oe?.includes("Bruxelles")||oe?.includes("Brussels")||_==="Bruxelles-Capitale"||_==="Brussels Hoofdstedelijk Gewest"||_==="Région de Bruxelles-Capitale"||_==="Brussels-Capital"))continue;const G=l.bbox,m=Array.isArray(G)&&G.length===4?G.map(Number):void 0;let b;if(m)b=[m[0]+(m[2]-m[0])/2,m[1]+(m[3]-m[1])/2];else if(l.geometry?.type==="Point"&&Array.isArray(l.geometry.coordinates))b=[Number(l.geometry.coordinates[0]),Number(l.geometry.coordinates[1])];else{const g=[],re=r=>{r&&(r.type==="Point"?g.push([+r.coordinates[0],+r.coordinates[1]]):r.type==="LineString"||r.type==="MultiPoint"?r.coordinates.forEach(c=>g.push([+c[0],+c[1]])):r.type==="Polygon"||r.type==="MultiLineString"?r.coordinates.flat(1).forEach(c=>g.push([+c[0],+c[1]])):r.type==="MultiPolygon"?r.coordinates.flat(2).forEach(c=>g.push([+c[0],+c[1]])):r.type==="GeometryCollection"&&(r.geometries||[]).forEach(re))};if(re(l.geometry),g.length){const r=g.map(H=>H[0]),c=g.map(H=>H[1]),v=[Math.min(...r),Math.min(...c),Math.max(...r),Math.max(...c)];b=[v[0]+(v[2]-v[0])/2,v[1]+(v[3]-v[1])/2]}else b=[4.3517,50.8503]}o.push({type:"Feature",geometry:{type:"Point",coordinates:b},place_name:l.properties?.display_name,properties:{...l.properties,bbox:m},text:l.properties?.display_name,place_type:["place"],center:b,bbox:m})}}catch(u){console.error("forwardGeocode error:",u)}const n={type:"FeatureCollection",features:o};if(y.size>=50){const u=y.keys().next().value;u!==void 0&&y.delete(u)}return y.set(e,n),n}},C=new ae(Q,{maplibregl:h,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});s.addControl(C,"top-left");const A=new ae(Q,{maplibregl:h,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});i.addControl(A,"top-left");const X=t=>{const e=t.bbox??t.properties?.bbox;e&&Array.isArray(e)&&e.length===4?s.fitBounds([[e[0],e[1]],[e[2],e[3]]],{padding:50,maxZoom:16,duration:1200}):s.flyTo({center:t.center,zoom:15,duration:1200})};let z=[],d=0;const J=t=>{z=t.features||[],d=0,setTimeout(()=>{const e=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");e.length>0&&(e.forEach(o=>o.classList.remove("active")),e[0].classList.add("active"))},50)};C.on("results",J),A.on("results",J),setTimeout(()=>{const t=document.querySelector(".maplibregl-ctrl-geocoder input");t&&t.addEventListener("keydown",e=>{const o=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(e.key==="Enter"&&z.length>0){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const n=z[d];n&&(X(n),e.target.value="",C.clear(),z=[])}else e.key==="ArrowDown"&&o.length>0?(e.preventDefault(),d=Math.min(d+1,z.length-1),o.forEach(n=>n.classList.remove("active")),o[d]&&o[d].classList.add("active")):e.key==="ArrowUp"&&o.length>0&&(e.preventDefault(),d=Math.max(d-1,0),o.forEach(n=>n.classList.remove("active")),o[d]&&o[d].classList.add("active"))},!0)},100);const ee=t=>{const e=t.result;X(e),setTimeout(()=>{C.clear(),A.clear(),document.querySelectorAll(".maplibregl-ctrl-geocoder input").forEach(n=>n.value="")},100)};C.on("result",ee),A.on("result",ee);const te=(t,e)=>{S||(S=!0,e.jumpTo({center:t.getCenter(),zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch()}),requestAnimationFrame(()=>{S=!1}))};s.on("move",()=>{S||te(s,i);const t=s.getCenter();B(N,{lng:t.lng,lat:t.lat}),B(P,s.getZoom()),typeof window<"u"&&(window.location.hash=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${p(P).toFixed(2)}z`)}),i.on("move",()=>{if(S||te(i,s),typeof window<"u"){const t=i.getCenter(),e=i.getZoom();window.location.hash=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${e.toFixed(2)}z`}});let O=null;const $=()=>{O||(O=window.setTimeout(()=>{i&&i.resize(),s&&s.resize(),O=null},250))};return setTimeout($,100),window.addEventListener("resize",$),()=>{window.removeEventListener("resize",$),i.remove(),s.remove()}}),xe();var F=Ce(),I=ce(F);let W;ne(I,a=>B(L,a),()=>p(L));var q=Z(I,2);let V;ne(q,a=>B(x,a),()=>p(x));var Y=Z(q,4),me=Z(Y,2);Se(me,{get lat(){return p(N).lat},get lng(){return p(N).lng},get zoom(){return p(P)},yearBefore:"ortho-1971",yearAfter:"ortho-2024"}),pe(F),ye((a,f)=>{W=se(I,1,"map-container after svelte-lapvzq",null,W,a),V=se(q,1,"map-container before svelte-lapvzq",null,V,f)},[()=>({lens:p(E)}),()=>({lens:!p(E)})]),we("click",Y,ue),le(k,F),be()}var Me=ie('<div class="page-container svelte-44n6ux"><!></div>');function Ie(k){var w=Me(),x=ce(w);ze(x,{}),pe(w),le(k,w)}export{Ie as component};
