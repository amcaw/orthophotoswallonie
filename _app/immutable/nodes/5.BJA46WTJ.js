import"../chunks/DsnmJJEf.js";import"../chunks/T5vn-GjU.js";import{I as et,K as L,A as ze,B as tt,C as ke,J as ot,F as te,D as $,w as a,M as y,G as oe}from"../chunks/HUyCGl9y.js";import{o as rt,e as ee}from"../chunks/Ba58zEHK.js";import{s as $e}from"../chunks/_YLpWADv.js";import{b as G}from"../chunks/BIZiTCpg.js";import{i as nt}from"../chunks/7nCQ08Wj.js";import{m as Y,M as st}from"../chunks/DvzMNcMn.js";import{o as Ne}from"../chunks/C4AmPXCP.js";import{Y as Fe}from"../chunks/BkavPja8.js";var at=ze('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="geocoder-overlay svelte-1awtn06"></div> <div class="navigation-overlay svelte-1awtn06"></div> <div class="attribution-overlay svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div></div> <!> <!></div>');function it(re,H){et(H,!1);let O=L(),ne=L(),D=L(),W=L(),U=L(),Z=L(),l,m,se=L(50),j=!1,V=null,ae=null;function Ge(e){y(se,e),ae&&cancelAnimationFrame(ae),ae=requestAnimationFrame(()=>{m&&m.triggerRepaint()})}function He(e,n=512){const c=Ne;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${c.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${n}&HEIGHT=${n}&BBOX={bbox-epsg-3857}`:`${c.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${n}&HEIGHT=${n}&BBOX={bbox-epsg-3857}`}const be=new WeakMap;function Oe(e){let n=be.get(e);return n||(n=new Set,be.set(e,n)),n}let Ce=new Set;function qe(e,n,c=3e3){return new Promise(p=>{let g=!1;const E=()=>{g||(g=!0,M(),Ce.delete(S),p())},S=()=>{g||(console.log("Tile wait cancelled - user is interacting"),E())};Ce.add(S);const i=()=>{n.every(K=>{const pe=K.replace(/-layer$/,"");return!!e.getSource(pe)&&e.isSourceLoaded(pe)})&&e.areTilesLoaded()&&E()},x=()=>{console.log("Map movement detected - finishing tile wait early"),E()},P=setTimeout(E,c),M=()=>{e.off("idle",i),e.off("movestart",x),clearTimeout(P)};e.on("idle",i),e.on("movestart",x),i()})}function Ye(e,n,c=512){const p=n.id,g=`${n.id}-layer`;return e.getSource(p)||e.addSource(p,{type:"raster",tiles:[He(n,c)],tileSize:c,maxzoom:20}),e.getLayer(g)||e.addLayer({id:g,type:"raster",source:p,layout:{visibility:"visible"},paint:{"raster-opacity":0,"raster-fade-duration":300,"raster-resampling":"nearest"}}),g}const v=Ne.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let B=L(v[0].id),R=L(v[v.length-1].id);function De(e){e.currentTarget.setPointerCapture(e.pointerId),V=e.pointerId,j=!0}function We(e){if(!j||V!==e.pointerId||!a(D))return;const n=a(D).getBoundingClientRect(),c=e.clientX-n.left;Ge(Math.max(0,Math.min(100,c/n.width*100)))}function Ee(e){if(V===e.pointerId){const n=e.currentTarget;try{n.releasePointerCapture(e.pointerId)}catch{}j=!1,V=null}}const ie=new WeakMap;async function N(e,n){const c=ie.get(e);c&&(console.log("Waiting for previous layer change to complete..."),await c);const p=(async()=>{const g=Oe(e),E=[...g],S=n.layers.map(i=>Ye(e,i,512));requestAnimationFrame(()=>{S.forEach(i=>{e.getLayer(i)&&e.moveLayer(i)})}),await qe(e,S,1500),requestAnimationFrame(()=>{S.forEach(i=>{e.getLayer(i)&&e.setPaintProperty(i,"raster-opacity",1)}),E.forEach(i=>{e.getLayer(i)&&e.setPaintProperty(i,"raster-opacity",0)})}),setTimeout(()=>{E.forEach(i=>{if(!S.includes(i)){const x=i.replace(/-layer$/,"");e.getLayer(i)&&e.removeLayer(i),e.getSource(x)&&e.removeSource(x),g.delete(i)}}),S.forEach(i=>g.add(i))},400)})();ie.set(e,p),await p,ie.delete(e)}let q=null;function Ue(e){if(!l)return;const n=v.find(c=>c.id===e);n&&(N(l,n),y(B,e),q&&q(!0))}function Ze(e){if(!m)return;const n=v.find(c=>c.id===e);n&&(N(m,n),y(R,e),q&&q(!0))}rt(()=>{let e=null;(()=>{if(typeof window>"u")return!1;const o=window.location.hash.slice(1);if(!o)return!1;const t=o.split(",");if(t.length>=3){const r=parseFloat(t[0]),s=parseFloat(t[1]),d=parseFloat(t[2].replace("z",""));if(!isNaN(r)&&!isNaN(s)&&!isNaN(d)){if(e={center:[s,r],zoom:d},t.length>=5){const w=t[3],h=t[4];v.find(b=>b.id===w)&&y(B,w),v.find(b=>b.id===h)&&y(R,h)}return!0}}return!1})();let c=!1;const p=new Map,g=[[4.243,50.764],[4.482,50.913]],E=[[4.05,50.65],[4.68,51.05]],S=v.find(o=>o.id===a(B)),i=v.find(o=>o.id===a(R)),x={version:8,sources:{positron:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://b.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://c.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> © <a href="https://carto.com/attributions">CARTO</a>'}},layers:[{id:"positron-layer",type:"raster",source:"positron",paint:{"raster-opacity":1}}]},P={container:a(O),style:x,minZoom:10,maxZoom:20,maxBounds:E,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(P.center=e.center,P.zoom=e.zoom):(P.bounds=g,P.fitBoundsOptions={padding:0}),l=new Y.Map(P);const M={container:a(ne),style:JSON.parse(JSON.stringify(x)),minZoom:10,maxZoom:20,maxBounds:E,interactive:!1,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(M.center=e.center,M.zoom=e.zoom):(M.bounds=g,M.fitBoundsOptions={padding:0}),m=new Y.Map(M);const ue=new Map,K=o=>t=>{if(console.warn("Map error:",t?.error?.status,t?.sourceId),t.sourceId&&t.error?.status>=500){const r=ue.get(t.sourceId)||0;r<2&&(ue.set(t.sourceId,r+1),setTimeout(()=>{const s=o.getSource(t.sourceId);s&&"reload"in s&&s.reload()},1e3*(r+1)))}};l.on("error",K(l)),m.on("error",K(m)),l.once("load",()=>N(l,S)),m.once("load",()=>N(m,i));const Ae=new Y.NavigationControl().onAdd(l);a(U)&&a(U).appendChild(Ae);const Ve=new Y.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}).onAdd(l);a(Z)&&a(Z).appendChild(Ve);const Je={forwardGeocode:async o=>{const t=(o.query??"").trim().toLowerCase();if(p.has(t))return p.get(t);const r=[];try{const d=encodeURIComponent(t);if(!d)return{type:"FeatureCollection",features:r};const w=`https://nominatim.openstreetmap.org/search?q=${d}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,b=await(await fetch(w,{headers:{"Accept-Language":"fr"}})).json();for(const f of b.features??[]){const Me=f.properties?.address?.region,Q=f.properties?.address?.state;if(!(Me?.includes("Bruxelles")||Me?.includes("Brussels")||Q==="Bruxelles-Capitale"||Q==="Brussels Hoofdstedelijk Gewest"||Q==="Région de Bruxelles-Capitale"||Q==="Brussels-Capital"))continue;const ye=f.bbox,I=Array.isArray(ye)&&ye.length===4?ye.map(Number):void 0;let z;if(I)z=[I[0]+(I[2]-I[0])/2,I[1]+(I[3]-I[1])/2];else if(f.geometry?.type==="Point"&&Array.isArray(f.geometry.coordinates))z=[Number(f.geometry.coordinates[0]),Number(f.geometry.coordinates[1])];else{const _=[],_e=u=>{u&&(u.type==="Point"?_.push([+u.coordinates[0],+u.coordinates[1]]):u.type==="LineString"||u.type==="MultiPoint"?u.coordinates.forEach(C=>_.push([+C[0],+C[1]])):u.type==="Polygon"||u.type==="MultiLineString"?u.coordinates.flat(1).forEach(C=>_.push([+C[0],+C[1]])):u.type==="MultiPolygon"?u.coordinates.flat(2).forEach(C=>_.push([+C[0],+C[1]])):u.type==="GeometryCollection"&&(u.geometries||[]).forEach(_e))};if(_e(f.geometry),_.length){const u=_.map(we=>we[0]),C=_.map(we=>we[1]),k=[Math.min(...u),Math.min(...C),Math.max(...u),Math.max(...C)];z=[k[0]+(k[2]-k[0])/2,k[1]+(k[3]-k[1])/2]}else z=[4.3517,50.8503]}r.push({type:"Feature",geometry:{type:"Point",coordinates:z},place_name:f.properties?.display_name,properties:{...f.properties,bbox:I},text:f.properties?.display_name,place_type:["place"],center:z,bbox:I})}}catch(d){console.error("forwardGeocode error:",d)}const s={type:"FeatureCollection",features:r};if(p.size>=50){const d=p.keys().next().value;d!==void 0&&p.delete(d)}return p.set(t,s),s}},F=new st(Je,{maplibregl:Y,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1}),Xe=F.onAdd(l);a(W)&&a(W).appendChild(Xe);const fe=o=>{const t=o.bbox??o.properties?.bbox;t&&Array.isArray(t)&&t.length===4?l.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):l.flyTo({center:o.center,zoom:15,duration:1200})};let A=[],T=0;F.on("results",o=>{A=o.features||[],T=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(r=>r.classList.remove("active")),t[0].classList.add("active"),t.forEach((r,s)=>{const d=w=>{if(w.preventDefault(),w.stopPropagation(),A[s]){const h=document.querySelector(".maplibregl-ctrl-geocoder input");h&&h.blur(),fe(A[s]),setTimeout(()=>{h&&(h.value=""),F.clear(),A=[]},100)}};r.removeEventListener("touchend",d),r.removeEventListener("click",d),r.addEventListener("touchend",d,{passive:!1}),r.addEventListener("click",d)}))},50)}),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&o.addEventListener("keydown",t=>{const r=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&A.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const s=A[T];s&&(fe(s),t.target.value="",F.clear(),A=[])}else t.key==="ArrowDown"&&r.length>0?(t.preventDefault(),T=Math.min(T+1,A.length-1),r.forEach(s=>s.classList.remove("active")),r[T]&&r[T].classList.add("active")):t.key==="ArrowUp"&&r.length>0&&(t.preventDefault(),T=Math.max(T-1,0),r.forEach(s=>s.classList.remove("active")),r[T]&&r[T].classList.add("active"))},!0)},100),F.on("result",o=>{const t=o.result;fe(t),setTimeout(()=>{const r=document.querySelector(".maplibregl-ctrl-geocoder input");r&&(r.value=""),F.clear()},100)});const Ke=(o,t)=>{c||(c=!0,t.jumpTo({center:o.getCenter(),zoom:o.getZoom(),bearing:o.getBearing(),pitch:o.getPitch()}),requestAnimationFrame(()=>{c=!1}))};let me=null,Be="";const ge=(o=!1)=>{if(typeof window>"u"||!l)return;const t=l.getCenter(),r=l.getZoom(),s=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${r.toFixed(2)}z,${a(B)},${a(R)}`;s!==Be&&(Be=s,o?window.location.hash=s:history.replaceState(null,"",`#${s}`))};q=ge;let Re=0;l.on("move",()=>{!j&&!c&&Ke(l,m);const o=performance.now();o-Re>120&&(ge(!1),Re=o),me&&clearTimeout(me),me=window.setTimeout(()=>{ge(!0)},800)});let ve=null;const he=()=>{ve||(ve=window.setTimeout(()=>{l&&l.resize(),m&&m.resize(),ve=null},250))};setTimeout(he,100),window.addEventListener("resize",he);const Pe=()=>{if(typeof window>"u")return;const o=window.location.hash.slice(1);if(!o)return;const t=o.split(",");if(t.length>=3){const r=parseFloat(t[0]),s=parseFloat(t[1]),d=parseFloat(t[2].replace("z",""));if(!isNaN(r)&&!isNaN(s)&&!isNaN(d)&&(l&&l.flyTo({center:[s,r],zoom:d,duration:1e3}),t.length>=5)){const w=t[3],h=t[4];if(w&&w!==a(B)){const b=v.find(f=>f.id===w);b&&(y(B,w),N(l,b))}if(h&&h!==a(R)){const b=v.find(f=>f.id===h);b&&(y(R,h),N(m,b))}}}};window.addEventListener("hashchange",Pe);const Qe=setInterval(()=>{c&&(console.warn("isSyncing stuck - forcing reset"),c=!1)},5e3);return()=>{window.removeEventListener("resize",he),window.removeEventListener("hashchange",Pe),clearInterval(Qe),l.remove(),m.remove()}}),nt();var le=at(),J=te(le),Se=te(J);G(Se,e=>y(O,e),()=>a(O));var ce=$(Se,2);G(ce,e=>y(ne,e),()=>a(ne));var Te=$(ce,2);G(Te,e=>y(W,e),()=>a(W));var Ie=$(Te,2);G(Ie,e=>y(U,e),()=>a(U));var Le=$(Ie,2);G(Le,e=>y(Z,e),()=>a(Z));var de=$(Le,2),X=te(de);oe(de),oe(J),G(J,e=>y(D,e),()=>a(D));var xe=$(J,2);Fe(xe,{side:"left",get groups(){return v},get selectedId(){return a(B)},$$events:{select:e=>Ue(e.detail.id)}});var je=$(xe,2);Fe(je,{side:"right",get groups(){return v},get selectedId(){return a(R)},$$events:{select:e=>Ze(e.detail.id)}}),oe(le),tt(()=>{$e(ce,`clip-path: inset(0 0 0 calc(${a(se)??""}% - 0.5px))`),$e(de,`left: ${a(se)??""}%`)}),ee("pointerdown",X,De),ee("pointermove",X,We),ee("pointerup",X,Ee),ee("pointercancel",X,Ee),ke(re,le),ot()}var lt=ze('<div class="page-container svelte-1ewpa8p"><!></div>');function Ct(re){var H=lt(),O=te(H);it(O,{}),oe(H),ke(re,H)}export{Ct as component};
