import"../chunks/DsnmJJEf.js";import"../chunks/Cflq-a96.js";import{as as ne,D as V,F as ae,G as Y,at as ie,z as m,a6 as P,J as Q,R as q,I as O,K as X}from"../chunks/Dlg-gMpp.js";import{o as le,e as ce}from"../chunks/COQ8bC4V.js";import{s as H,o as U,m as f,M as J}from"../chunks/B22aiAXe.js";import{b as K}from"../chunks/5YV8zeCu.js";import{i as pe}from"../chunks/DMWEl-21.js";var de=V('<div class="map-lens-wrapper svelte-1kjt96t"><div></div> <div></div> <div class="lens-border svelte-1kjt96t"></div> <button class="swap-button svelte-1kjt96t" title="Inverser les couches"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1kjt96t"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg></button></div>');function ue(L,b){ne(b,!1);let v=P(),S=P(),d,r,C=P(!1);const B=[[2.75,49.45],[6.5,50.85]];function ee(){q(C,!m(C))}le(()=>{let n=!1;const h=U.orthophotos.find(t=>t.id==="ortho-1971"),M=U.orthophotos.find(t=>t.id==="ortho-2023-ete");r=new f.Map({container:m(S),style:{version:8,sources:{[M.id]:{type:"raster",tiles:[`${M.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&f=image`],tileSize:256}},layers:[{id:`${M.id}-layer`,type:"raster",source:M.id,paint:{}}]},bounds:B,fitBoundsOptions:{padding:20},minZoom:8,maxZoom:17,attributionControl:!1}),d=new f.Map({container:m(v),style:{version:8,sources:{[h.id]:{type:"raster",tiles:[`${h.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&f=image`],tileSize:256}},layers:[{id:`${h.id}-layer`,type:"raster",source:h.id,paint:{}}]},bounds:B,fitBoundsOptions:{padding:20},minZoom:8,maxZoom:17,attributionControl:!1}),r.addControl(new f.NavigationControl,"bottom-left"),d.addControl(new f.NavigationControl,"bottom-left"),r.addControl(new f.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const N={forwardGeocode:async t=>{const e=[];try{const s=encodeURIComponent((t.query??"").trim());if(!s)return{type:"FeatureCollection",features:e};const c=`https://nominatim.openstreetmap.org/search?q=${s}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,oe=await(await fetch(c,{headers:{"Accept-Language":"fr"}})).json(),se=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const a of oe.features??[]){const j=a.properties?.address?.state,re=a.properties?.address?.county;if(!(j==="Wallonie"||j==="Région wallonne"||se.some(p=>re?.includes(p)||j?.includes(p))))continue;const E=a.bbox,u=Array.isArray(E)&&E.length===4?E.map(Number):void 0;let g;if(u)g=[u[0]+(u[2]-u[0])/2,u[1]+(u[3]-u[1])/2];else if(a.geometry?.type==="Point"&&Array.isArray(a.geometry.coordinates))g=[Number(a.geometry.coordinates[0]),Number(a.geometry.coordinates[1])];else{const p=[],G=o=>{o&&(o.type==="Point"?p.push([+o.coordinates[0],+o.coordinates[1]]):o.type==="LineString"||o.type==="MultiPoint"?o.coordinates.forEach(i=>p.push([+i[0],+i[1]])):o.type==="Polygon"||o.type==="MultiLineString"?o.coordinates.flat(1).forEach(i=>p.push([+i[0],+i[1]])):o.type==="MultiPolygon"?o.coordinates.flat(2).forEach(i=>p.push([+i[0],+i[1]])):o.type==="GeometryCollection"&&(o.geometries||[]).forEach(G))};if(G(a.geometry),p.length){const o=p.map(T=>T[0]),i=p.map(T=>T[1]),y=[Math.min(...o),Math.min(...i),Math.max(...o),Math.max(...i)];g=[y[0]+(y[2]-y[0])/2,y[1]+(y[3]-y[1])/2]}else g=[4.4699,50.5039]}e.push({type:"Feature",geometry:{type:"Point",coordinates:g},place_name:a.properties?.display_name,properties:{...a.properties,bbox:u},text:a.properties?.display_name,place_type:["place"],center:g,bbox:u})}}catch(s){console.error("forwardGeocode error:",s)}return{type:"FeatureCollection",features:e}}},w=new J(N,{maplibregl:f,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:200,minLength:2,showResultMarkers:!1});r.addControl(w,"top-left");const k=new J(N,{maplibregl:f,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:200,minLength:2,showResultMarkers:!1});d.addControl(k,"top-left");const Z=t=>{const e=t.bbox??t.properties?.bbox;e&&Array.isArray(e)&&e.length===4?r.fitBounds([[e[0],e[1]],[e[2],e[3]]],{padding:50,maxZoom:16,duration:1200}):r.flyTo({center:t.center,zoom:15,duration:1200})};let x=[],l=0;const $=t=>{x=t.features||[],l=0,setTimeout(()=>{const e=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");e.length>0&&(e.forEach(s=>s.classList.remove("active")),e[0].classList.add("active"))},50)};w.on("results",$),k.on("results",$),setTimeout(()=>{const t=document.querySelector(".maplibregl-ctrl-geocoder input");t&&t.addEventListener("keydown",e=>{const s=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(e.key==="Enter"&&x.length>0){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const c=x[l];c&&(Z(c),e.target.value="",w.clear(),x=[])}else e.key==="ArrowDown"&&s.length>0?(e.preventDefault(),l=Math.min(l+1,x.length-1),s.forEach(c=>c.classList.remove("active")),s[l]&&s[l].classList.add("active")):e.key==="ArrowUp"&&s.length>0&&(e.preventDefault(),l=Math.max(l-1,0),s.forEach(c=>c.classList.remove("active")),s[l]&&s[l].classList.add("active"))},!0)},100);const D=t=>{const e=t.result;Z(e),setTimeout(()=>{w.clear(),k.clear(),document.querySelectorAll(".maplibregl-ctrl-geocoder input").forEach(c=>c.value="")},100)};w.on("result",D),k.on("result",D);const F=(t,e)=>{n||(n=!0,e.jumpTo({center:t.getCenter(),zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch()}),requestAnimationFrame(()=>{n=!1}))};r.on("move",()=>{n||F(r,d)}),d.on("move",()=>{n||F(d,r)});const _=()=>{d&&d.resize(),r&&r.resize()};return setTimeout(_,100),window.addEventListener("resize",_),()=>{window.removeEventListener("resize",_),d.remove(),r.remove()}}),pe();var R=de(),A=Q(R);let W;K(A,n=>q(S,n),()=>m(S));var z=O(A,2);let I;K(z,n=>q(v,n),()=>m(v));var te=O(z,4);X(R),ae((n,h)=>{W=H(A,1,"map-container after svelte-1kjt96t",null,W,n),I=H(z,1,"map-container before svelte-1kjt96t",null,I,h)},[()=>({lens:m(C)}),()=>({lens:!m(C)})]),ce("click",te,ee),Y(L,R),ie()}var me=V('<div class="map-container svelte-1mf7qal"><!></div>');function Me(L){var b=me(),v=Q(b);ue(v,{}),X(b),Y(L,b)}export{Me as component};
