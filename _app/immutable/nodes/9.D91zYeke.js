import"../chunks/DsnmJJEf.js";import"../chunks/C1X7ZH2G.js";import{I as Se,A as Q,B as ie,C as W,J as Pe,F as g,w as o,D as j,M as u,K as P,G as y,av as de,P as Le,aw as $e}from"../chunks/sZzwH-X8.js";import{h as Ce}from"../chunks/Xjmt66yp.js";import{o as Ie,e as ne,s as le}from"../chunks/DPlkaXRH.js";import{i as je}from"../chunks/BI816FXH.js";import{e as We,i as Fe,s as ce}from"../chunks/B_ypSufT.js";import{S as Te,m as A,M as Me,s as Ee}from"../chunks/vupgCqCY.js";import{b as Re}from"../chunks/DlGDAnrT.js";import{i as Ae}from"../chunks/B2bDIl6U.js";import{o as ke}from"../chunks/CUZUMNKG.js";var Ge=de('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),Ne=de('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),Be=Q('<button><span class="year-label svelte-wish1j"> </span></button>'),qe=Q('<div class="travel-container svelte-wish1j"><div class="map-container svelte-wish1j"></div> <div class="year-overlay svelte-wish1j"> </div> <div class="share-wrapper-traveltime svelte-wish1j"><!></div> <div class="playbar svelte-wish1j"><div class="playbar-controls svelte-wish1j"><button class="playbar-btn svelte-wish1j"><!></button></div> <div class="timeline svelte-wish1j"><div class="timeline-track svelte-wish1j"><div class="timeline-progress svelte-wish1j"></div></div> <div class="timeline-years svelte-wish1j"></div></div></div></div>');function He(k,L){Se(L,!1);let m=P(),t,z=P(!1),f=P(0),$=null,x=P(0),G=P({lng:4.5,lat:50.5}),F=P(8);const pe=[[2.75,49.45],[6.5,50.85]];function ue(r){const i=r.clientWidth||window.innerWidth,s=r.clientHeight||window.innerHeight,a=Math.round(Math.max(12,Math.min(i,s)*.03)),e=i<768,p=e?120:80;return{top:a+(e?30:40),right:a+10,bottom:a+p,left:a+10}}function V(r){if(!t||!o(m))return;const i=ue(o(m));t.resize();const s=o(m).clientWidth||window.innerWidth,a=s<640?6.5:s<1024?7:s<1300?7.5:8;t.setMinZoom(a),t.fitBounds(pe,{padding:i,duration:r?.animate?400:0})}const n=ke.orthophotos.reduce((r,i)=>{const s=i.year.split(" ")[0],a=r.find(e=>e.year===s);return a?a.layers.push(i):r.push({year:s,displayYear:s,layers:[i]}),r},[]).map(r=>({...r,layers:r.layers.slice().sort((i,s)=>{const a=e=>/Printemps/i.test(e)?0:/Été|Ete/i.test(e)?1:2;return a(i.year)-a(s.year)})}));function X(){if(!t)return;const r=(o(f)+1)%n.length;n[r].layers.forEach(e=>{t.getSource(e.id)||t.addSource(e.id,{type:"raster",tiles:[`${e.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),t.getLayer(`${e.id}-layer`)||t.addLayer({id:`${e.id}-layer`,type:"raster",source:e.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})});const s=(o(f)-1+n.length)%n.length;n[s].layers.forEach(e=>{t.getSource(e.id)||t.addSource(e.id,{type:"raster",tiles:[`${e.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),t.getLayer(`${e.id}-layer`)||t.addLayer({id:`${e.id}-layer`,type:"raster",source:e.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function me(){o(z)?T():fe()}function fe(){if(!t)return;u(z,!0),X();const r=Date.now(),i=o(x)/100*(n.length-1),s=2500,a=1300,e=()=>{if(!o(z))return;const d=(Date.now()-r)/s,v=i+d;if(v>=n.length-1){u(f,n.length-1),u(x,100),T();return}const h=Math.floor(v);u(x,v/(n.length-1)*100),h!==o(f)&&(u(f,h),ee(a),X()),$=window.requestAnimationFrame(e)};$=window.requestAnimationFrame(e)}function T(){u(z,!1),$&&(cancelAnimationFrame($),$=null);const r=Math.floor(o(x)/100*(n.length-1));r>=0&&r<n.length&&u(f,r)}function ye(r){o(z)&&T();const s=r/(n.length-1)*100,a=o(x),e=Date.now(),p=300,d=()=>{const v=Date.now()-e,h=Math.min(v/p,1),M=1-Math.pow(1-h,3);u(x,a+(s-a)*M),h<1?requestAnimationFrame(d):u(x,s)};u(f,r),ee(),d()}function ee(r=0){if(!t)return;const i=n[o(f)],s=t.getStyle();if(s?.layers)for(const a of s.layers){if(!a.id.endsWith("-layer"))continue;!i.layers.some(p=>`${p.id}-layer`===a.id)&&t.getLayer(a.id)&&(t.setPaintProperty(a.id,"raster-opacity-transition",{duration:r,delay:0}),t.setPaintProperty(a.id,"raster-opacity",0))}i.layers.forEach(a=>{const e=a.id,p=`${a.id}-layer`;t.getSource(e)||t.addSource(e,{type:"raster",tiles:[`${a.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),t.getLayer(p)||t.addLayer({id:p,type:"raster",source:e,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),i.layers.forEach(a=>{const e=`${a.id}-layer`;t.getLayer(e)&&t.moveLayer(e)}),i.layers.forEach(a=>{const e=`${a.id}-layer`;t.getLayer(e)&&(t.setPaintProperty(e,"raster-opacity-transition",{duration:r,delay:0}),t.setPaintProperty(e,"raster-opacity",1))}),r>0&&setTimeout(()=>{const a=t?.getStyle();if(a?.layers)for(const e of a.layers){if(!e.id.endsWith("-layer"))continue;if(!i.layers.some(d=>`${d.id}-layer`===e.id)){t.getLayer(e.id)&&t.removeLayer(e.id);const d=e.source;d&&t.getSource(d)&&t.removeSource(d)}}},r+100)}Ie(()=>{const r=new Map,i=n[0];let s=null;if(typeof window<"u"&&window.location.hash){const c=window.location.hash.slice(1).split(",");if(c.length>=3){const S=parseFloat(c[0]),C=parseFloat(c[1]),w=parseFloat(c[2].replace("z",""));if(!isNaN(S)&&!isNaN(C)&&!isNaN(w)&&(s={center:[C,S],zoom:w}),c.length>=4){const O=c[3],R=n.findIndex(K=>K.id===O);R!==-1&&(u(f,R),u(x,R/(n.length-1)*100))}}}const a={},e=[];i.layers.forEach(l=>{a[l.id]={type:"raster",tiles:[`${l.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}}),i.layers.forEach(l=>{e.push({id:`${l.id}-layer`,type:"raster",source:l.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),t=new A.Map({container:o(m),style:{version:8,sources:a,layers:e},...s?{center:s.center,zoom:s.zoom}:{},maxZoom:16,minZoom:6,preserveDrawingBuffer:!0,attributionControl:!1}),t.addControl(new A.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const p={forwardGeocode:async l=>{const c=(l.query??"").trim().toLowerCase();if(r.has(c))return r.get(c);const S=[];try{const w=encodeURIComponent(c);if(!w)return{type:"FeatureCollection",features:S};const O=`https://nominatim.openstreetmap.org/search?q=${w}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,K=await(await fetch(O,{headers:{"Accept-Language":"fr"}})).json(),_e=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const b of K.features??[]){const J=b.properties?.address?.state,ze=b.properties?.address?.county;if(!(J==="Wallonie"||J==="Région wallonne"||_e.some(se=>ze?.includes(se)||J?.includes(se))))continue;const U=b.bbox,_=Array.isArray(U)&&U.length===4?U.map(Number):void 0;let I;_?I=[_[0]+(_[2]-_[0])/2,_[1]+(_[3]-_[1])/2]:b.geometry?.type==="Point"&&Array.isArray(b.geometry.coordinates)?I=[Number(b.geometry.coordinates[0]),Number(b.geometry.coordinates[1])]:I=[4.4699,50.5039],S.push({type:"Feature",geometry:{type:"Point",coordinates:I},place_name:b.properties?.display_name,properties:{...b.properties,bbox:_},text:b.properties?.display_name,place_type:["place"],center:I,bbox:_})}}catch(w){console.error("forwardGeocode error:",w)}const C={type:"FeatureCollection",features:S};if(r.size>=50){const w=r.keys().next().value;w!==void 0&&r.delete(w)}return r.set(c,C),C}},d=new Me(p,{maplibregl:A,placeholder:"Cherchez une adresse en Wallonie",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});t.addControl(d,"top-left"),t.addControl(new A.NavigationControl,"top-left"),t.on("move",()=>{const l=t.getCenter();if(u(G,{lng:l.lng,lat:l.lat}),u(F,t.getZoom()),typeof window<"u"){const c=n[o(f)]?.id;c?window.location.hash=`${l.lat.toFixed(6)},${l.lng.toFixed(6)},${o(F).toFixed(2)}z,${c}`:window.location.hash=`${l.lat.toFixed(6)},${l.lng.toFixed(6)},${o(F).toFixed(2)}z`}}),t.once("idle",()=>{s||V({animate:!1})});let v=o(m).clientWidth,h=o(m).clientHeight;const M=new ResizeObserver(()=>{const l=o(m).clientWidth,c=o(m).clientHeight;(l!==v||c!==h)&&(v=l,h=c,V({animate:!1}))});M.observe(o(m));let Z=null;const E=()=>{Z||(Z=window.setTimeout(()=>{t&&t.resize(),Z=null},250))};return setTimeout(()=>t.resize(),100),window.addEventListener("resize",E),window.addEventListener("orientationchange",E),()=>{T(),M.disconnect(),window.removeEventListener("resize",E),window.removeEventListener("orientationchange",E),t.remove()}}),Ae();var N=qe(),te=g(N);Re(te,r=>u(m,r),()=>o(m));var B=j(te,2),ge=g(B,!0);y(B);var q=j(B,2),ve=g(q);Te(ve,{get lat(){return o(G).lat},get lng(){return o(G).lng},get zoom(){return o(F)}}),y(q);var re=j(q,2),H=g(re),D=g(H),he=g(D);{var we=r=>{var i=Ge();W(r,i)},be=r=>{var i=Ne();W(r,i)};je(he,r=>{o(z)?r(we):r(be,!1)})}y(D),y(H);var ae=j(H,2),Y=g(ae),xe=g(Y);y(Y);var oe=j(Y,2);We(oe,5,()=>n,Fe,(r,i,s)=>{const a=Le(()=>s/(n.length-1)*100);var e=Be();let p;var d=g(e),v=g(d,!0);y(d),y(e),ie(h=>{p=Ee(e,1,"year-marker svelte-wish1j",null,p,h),ce(e,`left: ${o(a)??""}%`),le(v,o(i).displayYear)},[()=>({active:s===o(f)})]),ne("click",e,()=>ye(s)),W(r,e)}),y(oe),y(ae),y(re),y(N),ie(()=>{le(ge,n[o(f)].displayYear),ce(xe,`width: ${o(x)??""}%`)}),ne("click",D,me),W(k,N),Pe()}var De=Q('<div class="page-container svelte-lwifl2"><!></div>');function at(k){var L=De();Ce(t=>{$e.title="Travel in Time - Orthophotos Wallonie"});var m=g(L);He(m,{}),y(L),W(k,L)}export{at as component};
