import"../chunks/DsnmJJEf.js";import"../chunks/C1X7ZH2G.js";import{I as _e,A as X,B as ne,C as L,J as Ee,F as y,w as a,D as I,M as p,K as E,G as f,av as pe,P as Ce}from"../chunks/sZzwH-X8.js";import{o as Pe,e as le,s as ce}from"../chunks/DPlkaXRH.js";import{i as Te}from"../chunks/BI816FXH.js";import{e as Be,i as Ie,s as de}from"../chunks/B_ypSufT.js";import{S as Le,m as N,M as ze,s as Ae}from"../chunks/vupgCqCY.js";import{b as Re}from"../chunks/DlGDAnrT.js";import{i as $e}from"../chunks/B2bDIl6U.js";import{o as ue}from"../chunks/C4AmPXCP.js";var Me=pe('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),Fe=pe('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),Ge=X('<button><span class="year-label svelte-hmkkg"> </span></button>'),Ne=X('<div class="travel-container svelte-hmkkg"><div class="map-container svelte-hmkkg"></div> <div class="year-overlay svelte-hmkkg"> </div> <div class="share-wrapper-traveltime svelte-hmkkg"><!></div> <div class="playbar svelte-hmkkg"><div class="playbar-controls svelte-hmkkg"><button class="playbar-btn svelte-hmkkg"><!></button></div> <div class="timeline svelte-hmkkg"><div class="timeline-track svelte-hmkkg"><div class="timeline-progress svelte-hmkkg"></div></div> <div class="timeline-years svelte-hmkkg"></div></div></div></div>');function We(W,C){_e(C,!1);let g=E(),r,S=E(!1),m=E(0),P=null,x=E(0),H=E({lng:4.35,lat:50.85}),z=E(11);const ge=[[4.243,50.764],[4.482,50.913]];function A(t){const o=ue;return t.service==="urban-brussels"&&t.crs==="EPSG:31370"?`${o.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${t.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${o.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${t.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}function me(t){const o=t.clientWidth||window.innerWidth,i=t.clientHeight||window.innerHeight,s=Math.round(Math.max(12,Math.min(o,i)*.03)),e=o<768,u=e?120:80;return{top:s+(e?30:40),right:s+10,bottom:s+u,left:s+10}}function J(t){if(!r||!a(g))return;const o=me(a(g));r.resize();const i=a(g).clientWidth||window.innerWidth,s=i<640?9:i<1024?9.5:(i<1300,10);r.setMinZoom(s),r.fitBounds(ge,{padding:o,duration:t?.animate?400:0})}const n=ue.orthophotos.map(t=>({id:t.id,year:t.year,displayYear:t.year,layers:[t]}));function ee(){if(!r)return;const t=(a(m)+1)%n.length;n[t].layers.forEach(e=>{r.getSource(e.id)||r.addSource(e.id,{type:"raster",tiles:[A(e)],tileSize:256,maxzoom:20}),r.getLayer(`${e.id}-layer`)||r.addLayer({id:`${e.id}-layer`,type:"raster",source:e.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})});const i=(a(m)-1+n.length)%n.length;n[i].layers.forEach(e=>{r.getSource(e.id)||r.addSource(e.id,{type:"raster",tiles:[A(e)],tileSize:256,maxzoom:20}),r.getLayer(`${e.id}-layer`)||r.addLayer({id:`${e.id}-layer`,type:"raster",source:e.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function fe(){a(S)?R():ye()}function ye(){if(!r)return;p(S,!0),ee();const t=Date.now(),o=a(x)/100*(n.length-1),i=2500,s=1300,e=()=>{if(!a(S))return;const d=(Date.now()-t)/i,v=o+d;if(v>=n.length-1){p(m,n.length-1),p(x,100),R();return}const h=Math.floor(v);p(x,v/(n.length-1)*100),h!==a(m)&&(p(m,h),te(s),ee()),P=window.requestAnimationFrame(e)};P=window.requestAnimationFrame(e)}function R(){p(S,!1),P&&(cancelAnimationFrame(P),P=null);const t=Math.floor(a(x)/100*(n.length-1));t>=0&&t<n.length&&p(m,t)}function ve(t){a(S)&&R();const i=t/(n.length-1)*100,s=a(x),e=Date.now(),u=300,d=()=>{const v=Date.now()-e,h=Math.min(v/u,1),$=1-Math.pow(1-h,3);p(x,s+(i-s)*$),h<1?requestAnimationFrame(d):p(x,i)};p(m,t),te(),d()}function te(t=0){if(!r)return;const o=n[a(m)],i=r.getStyle();if(i?.layers)for(const s of i.layers){if(!s.id.endsWith("-layer"))continue;!o.layers.some(u=>`${u.id}-layer`===s.id)&&r.getLayer(s.id)&&(r.setPaintProperty(s.id,"raster-opacity-transition",{duration:t,delay:0}),r.setPaintProperty(s.id,"raster-opacity",0))}o.layers.forEach(s=>{const e=s.id,u=`${s.id}-layer`;r.getSource(e)||r.addSource(e,{type:"raster",tiles:[A(s)],tileSize:256,maxzoom:20}),r.getLayer(u)||r.addLayer({id:u,type:"raster",source:e,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),o.layers.forEach(s=>{const e=`${s.id}-layer`;r.getLayer(e)&&r.moveLayer(e)}),o.layers.forEach(s=>{const e=`${s.id}-layer`;r.getLayer(e)&&(r.setPaintProperty(e,"raster-opacity-transition",{duration:t,delay:0}),r.setPaintProperty(e,"raster-opacity",1))}),t>0&&setTimeout(()=>{const s=r?.getStyle();if(s?.layers)for(const e of s.layers){if(!e.id.endsWith("-layer"))continue;if(!o.layers.some(d=>`${d.id}-layer`===e.id)){r.getLayer(e.id)&&r.removeLayer(e.id);const d=e.source;d&&r.getSource(d)&&r.removeSource(d)}}},t+100)}Pe(()=>{let t=null;if(typeof window<"u"&&window.location.hash){const c=window.location.hash.slice(1).split(",");if(c.length>=3){const _=parseFloat(c[0]),T=parseFloat(c[1]),w=parseFloat(c[2].replace("z",""));if(!isNaN(_)&&!isNaN(T)&&!isNaN(w)&&(t={center:[T,_],zoom:w}),c.length>=4){const V=c[3],F=n.findIndex(K=>K.id===V);F!==-1&&(p(m,F),p(x,F/(n.length-1)*100))}}}const o=new Map,i=n[0],s={},e=[];i.layers.forEach(l=>{s[l.id]={type:"raster",tiles:[A(l)],tileSize:256,maxzoom:20}}),i.layers.forEach(l=>{e.push({id:`${l.id}-layer`,type:"raster",source:l.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),r=new N.Map({container:a(g),style:{version:8,sources:s,layers:e},...t?{center:t.center,zoom:t.zoom}:{},maxZoom:20,minZoom:9,preserveDrawingBuffer:!0,attributionControl:!1}),r.addControl(new N.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const u={forwardGeocode:async l=>{const c=(l.query??"").trim().toLowerCase();if(o.has(c))return o.get(c);const _=[];try{const w=encodeURIComponent(c);if(!w)return{type:"FeatureCollection",features:_};const V=`https://nominatim.openstreetmap.org/search?q=${w}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,K=await(await fetch(V,{headers:{"Accept-Language":"fr"}})).json();for(const b of K.features??[]){const ie=b.properties?.address?.region,G=b.properties?.address?.state;if(!(ie?.includes("Bruxelles")||ie?.includes("Brussels")||G==="Bruxelles-Capitale"||G==="Brussels Hoofdstedelijk Gewest"||G==="Région de Bruxelles-Capitale"||G==="Brussels-Capital"))continue;const Q=b.bbox,k=Array.isArray(Q)&&Q.length===4?Q.map(Number):void 0;let B;k?B=[k[0]+(k[2]-k[0])/2,k[1]+(k[3]-k[1])/2]:b.geometry?.type==="Point"&&Array.isArray(b.geometry.coordinates)?B=[Number(b.geometry.coordinates[0]),Number(b.geometry.coordinates[1])]:B=[4.3517,50.8503],_.push({type:"Feature",geometry:{type:"Point",coordinates:B},place_name:b.properties?.display_name,properties:{...b.properties,bbox:k},text:b.properties?.display_name,place_type:["place"],center:B,bbox:k})}}catch(w){console.error("forwardGeocode error:",w)}const T={type:"FeatureCollection",features:_};if(o.size>=50){const w=o.keys().next().value;w!==void 0&&o.delete(w)}return o.set(c,T),T}},d=new ze(u,{maplibregl:N,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});r.addControl(d,"top-left"),r.addControl(new N.NavigationControl,"top-left"),r.on("move",()=>{const l=r.getCenter();if(p(H,{lng:l.lng,lat:l.lat}),p(z,r.getZoom()),typeof window<"u"){const c=n[a(m)]?.id;c?window.location.hash=`${l.lat.toFixed(6)},${l.lng.toFixed(6)},${a(z).toFixed(2)}z,${c}`:window.location.hash=`${l.lat.toFixed(6)},${l.lng.toFixed(6)},${a(z).toFixed(2)}z`}}),t||r.once("idle",()=>J({animate:!1}));let v=a(g).clientWidth,h=a(g).clientHeight;const $=new ResizeObserver(()=>{const l=a(g).clientWidth,c=a(g).clientHeight;(l!==v||c!==h)&&(v=l,h=c,J({animate:!1}))});$.observe(a(g));let Z=null;const M=()=>{Z||(Z=window.setTimeout(()=>{r&&r.resize(),Z=null},250))};return setTimeout(()=>r.resize(),100),window.addEventListener("resize",M),window.addEventListener("orientationchange",M),()=>{R(),$.disconnect(),window.removeEventListener("resize",M),window.removeEventListener("orientationchange",M),r.remove()}}),$e();var Y=Ne(),re=y(Y);Re(re,t=>p(g,t),()=>a(g));var q=I(re,2),he=y(q,!0);f(q);var D=I(q,2),we=y(D);Le(we,{get lat(){return a(H).lat},get lng(){return a(H).lng},get zoom(){return a(z)}}),f(D);var se=I(D,2),O=y(se),j=y(O),be=y(j);{var xe=t=>{var o=Me();L(t,o)},ke=t=>{var o=Fe();L(t,o)};Te(be,t=>{a(S)?t(xe):t(ke,!1)})}f(j),f(O);var ae=I(O,2),U=y(ae),Se=y(U);f(U);var oe=I(U,2);Be(oe,5,()=>n,Ie,(t,o,i)=>{const s=Ce(()=>i/(n.length-1)*100);var e=Ge();let u;var d=y(e),v=y(d,!0);f(d),f(e),ne(h=>{u=Ae(e,1,"year-marker svelte-hmkkg",null,u,h),de(e,`left: ${a(s)??""}%`),ce(v,a(o).displayYear)},[()=>({active:i===a(m)})]),le("click",e,()=>ve(i)),L(t,e)}),f(oe),f(ae),f(se),f(Y),ne(()=>{ce(he,n[a(m)].displayYear),de(Se,`width: ${a(x)??""}%`)}),le("click",j,fe),L(W,Y),Ee()}var He=X('<div class="page-container svelte-16kfyeo"><!></div>');function Je(W){var C=He(),g=y(C);We(g,{}),f(C),L(W,C)}export{Je as component};
