import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as fe,A as ne,B as he,C as se,J as ge,F as ae,D as Z,w as p,K as k,M as S,G as ie}from"../chunks/Ehb9Q6W5.js";import{o as ye,e as be}from"../chunks/BKIJojkU.js";import{S as ve,s as ee,m as y,M as te}from"../chunks/VYvS0YDk.js";import{b as oe}from"../chunks/m2zDNTuv.js";import{i as we}from"../chunks/D631TkqT.js";import{o as re}from"../chunks/CUZUMNKG.js";var xe=ne('<div class="map-lens-wrapper svelte-1kjt96t"><div></div> <div></div> <div class="lens-border svelte-1kjt96t"></div> <button class="swap-button svelte-1kjt96t" title="Inverser les couches"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1kjt96t"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg></button> <!></div>');function Ce(B,w){fe(w,!1);let x=k(),R=k(),a,n,A=k(!1),_=k({lng:4.5,lat:50.5}),T=k(8);const D=[[2.75,49.45],[6.5,50.85]],G=[[2,49],[7.2,51.3]];function le(){S(A,!p(A))}ye(()=>{let i=!1;const h=new Map;let g=null;(()=>{if(typeof window>"u")return;const t=window.location.hash.slice(1);if(!t)return;const e=t.split(",");if(e.length===3){const o=parseFloat(e[0]),s=parseFloat(e[1]),u=parseFloat(e[2].replace("z",""));!isNaN(o)&&!isNaN(s)&&!isNaN(u)&&(g={center:[s,o],zoom:u})}})();const F=re.orthophotos.find(t=>t.id==="ortho-1971"),C=re.orthophotos.find(t=>t.id==="ortho-2023-ete");n=new y.Map({container:p(R),style:{version:8,sources:{[C.id]:{type:"raster",tiles:[`${C.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&f=image`],tileSize:256}},layers:[{id:`${C.id}-layer`,type:"raster",source:C.id,paint:{}}]},...g?{center:g.center,zoom:g.zoom}:{bounds:D,fitBoundsOptions:{padding:-50}},minZoom:7,maxZoom:17,maxBounds:G,attributionControl:!1}),a=new y.Map({container:p(x),style:{version:8,sources:{[F.id]:{type:"raster",tiles:[`${C.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&f=image`],tileSize:256}},layers:[{id:`${F.id}-layer`,type:"raster",source:F.id,paint:{}}]},...g?{center:g.center,zoom:g.zoom}:{bounds:D,fitBoundsOptions:{padding:-50}},minZoom:7,maxZoom:17,maxBounds:G,attributionControl:!1}),n.once("idle",()=>{}),a.once("idle",()=>{}),n.on("error",t=>{console.warn("AfterMap tile loading error:",t)}),a.on("error",t=>{console.warn("BeforeMap tile loading error:",t)}),n.addControl(new y.NavigationControl,"bottom-left"),a.addControl(new y.NavigationControl,"bottom-left"),n.addControl(new y.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const U={forwardGeocode:async t=>{const e=(t.query??"").trim().toLowerCase();if(h.has(e))return h.get(e);const o=[];try{const u=encodeURIComponent(e);if(!u)return{type:"FeatureCollection",features:o};const pe=`https://nominatim.openstreetmap.org/search?q=${u}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,de=await(await fetch(pe,{headers:{"Accept-Language":"fr"}})).json(),ue=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const l of de.features??[]){const W=l.properties?.address?.state,me=l.properties?.address?.county;if(!(W==="Wallonie"||W==="Région wallonne"||ue.some(m=>me?.includes(m)||W?.includes(m))))continue;const $=l.bbox,f=Array.isArray($)&&$.length===4?$.map(Number):void 0;let b;if(f)b=[f[0]+(f[2]-f[0])/2,f[1]+(f[3]-f[1])/2];else if(l.geometry?.type==="Point"&&Array.isArray(l.geometry.coordinates))b=[Number(l.geometry.coordinates[0]),Number(l.geometry.coordinates[1])];else{const m=[],X=r=>{r&&(r.type==="Point"?m.push([+r.coordinates[0],+r.coordinates[1]]):r.type==="LineString"||r.type==="MultiPoint"?r.coordinates.forEach(c=>m.push([+c[0],+c[1]])):r.type==="Polygon"||r.type==="MultiLineString"?r.coordinates.flat(1).forEach(c=>m.push([+c[0],+c[1]])):r.type==="MultiPolygon"?r.coordinates.flat(2).forEach(c=>m.push([+c[0],+c[1]])):r.type==="GeometryCollection"&&(r.geometries||[]).forEach(X))};if(X(l.geometry),m.length){const r=m.map(I=>I[0]),c=m.map(I=>I[1]),v=[Math.min(...r),Math.min(...c),Math.max(...r),Math.max(...c)];b=[v[0]+(v[2]-v[0])/2,v[1]+(v[3]-v[1])/2]}else b=[4.4699,50.5039]}o.push({type:"Feature",geometry:{type:"Point",coordinates:b},place_name:l.properties?.display_name,properties:{...l.properties,bbox:f},text:l.properties?.display_name,place_type:["place"],center:b,bbox:f})}}catch(u){console.error("forwardGeocode error:",u)}const s={type:"FeatureCollection",features:o};if(h.size>=50){const u=h.keys().next().value;u!==void 0&&h.delete(u)}return h.set(e,s),s}},M=new te(U,{maplibregl:y,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});n.addControl(M,"top-left");const L=new te(U,{maplibregl:y,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});a.addControl(L,"top-left");const J=t=>{const e=t.bbox??t.properties?.bbox;e&&Array.isArray(e)&&e.length===4?n.fitBounds([[e[0],e[1]],[e[2],e[3]]],{padding:50,maxZoom:16,duration:1200}):n.flyTo({center:t.center,zoom:15,duration:1200})};let z=[],d=0;const V=t=>{z=t.features||[],d=0,setTimeout(()=>{const e=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");e.length>0&&(e.forEach(o=>o.classList.remove("active")),e[0].classList.add("active"))},50)};M.on("results",V),L.on("results",V),setTimeout(()=>{const t=document.querySelector(".maplibregl-ctrl-geocoder input");t&&t.addEventListener("keydown",e=>{const o=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(e.key==="Enter"&&z.length>0){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const s=z[d];s&&(J(s),e.target.value="",M.clear(),z=[])}else e.key==="ArrowDown"&&o.length>0?(e.preventDefault(),d=Math.min(d+1,z.length-1),o.forEach(s=>s.classList.remove("active")),o[d]&&o[d].classList.add("active")):e.key==="ArrowUp"&&o.length>0&&(e.preventDefault(),d=Math.max(d-1,0),o.forEach(s=>s.classList.remove("active")),o[d]&&o[d].classList.add("active"))},!0)},100);const Y=t=>{const e=t.result;J(e),setTimeout(()=>{M.clear(),L.clear(),document.querySelectorAll(".maplibregl-ctrl-geocoder input").forEach(s=>s.value="")},100)};M.on("result",Y),L.on("result",Y);const Q=(t,e)=>{i||(i=!0,e.jumpTo({center:t.getCenter(),zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch()}),requestAnimationFrame(()=>{i=!1}))};n.on("move",()=>{i||Q(n,a);const t=n.getCenter();S(_,{lng:t.lng,lat:t.lat}),S(T,n.getZoom()),typeof window<"u"&&(window.location.hash=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${p(T).toFixed(2)}z`)}),a.on("move",()=>{i||Q(a,n)});let P=null;const q=()=>{P||(P=window.setTimeout(()=>{a&&a.resize(),n&&n.resize(),P=null},250))};return setTimeout(q,100),window.addEventListener("resize",q),()=>{window.removeEventListener("resize",q),a.remove(),n.remove()}}),we();var j=xe(),E=ae(j);let H;oe(E,i=>S(R,i),()=>p(R));var N=Z(E,2);let O;oe(N,i=>S(x,i),()=>p(x));var K=Z(N,4),ce=Z(K,2);ve(ce,{get lat(){return p(_).lat},get lng(){return p(_).lng},get zoom(){return p(T)},yearBefore:"ortho-1971",yearAfter:"ortho-2023"}),ie(j),he((i,h)=>{H=ee(E,1,"map-container after svelte-1kjt96t",null,H,i),O=ee(N,1,"map-container before svelte-1kjt96t",null,O,h)},[()=>({lens:p(A)}),()=>({lens:!p(A)})]),be("click",K,le),se(B,j),ge()}var Me=ne('<div class="map-container svelte-1mf7qal"><!></div>');function Ne(B){var w=Me(),x=ae(w);Ce(x,{}),ie(w),se(B,w)}export{Ne as component};
