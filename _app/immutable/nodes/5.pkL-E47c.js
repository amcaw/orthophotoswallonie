import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Pe,K as S,A as ge,B as Me,C as he,J as ze,am as Z,F as W,D as G,w as s,M as y,G as j}from"../chunks/Ehb9Q6W5.js";import{o as Ie,e as R}from"../chunks/BKIJojkU.js";import{s as pe}from"../chunks/yJVuIktW.js";import{b as ie}from"../chunks/m2zDNTuv.js";import{i as _e}from"../chunks/D631TkqT.js";import{S as $e,m as N,M as Ge}from"../chunks/VYvS0YDk.js";import{o as me}from"../chunks/C4AmPXCP.js";import{Y as ye}from"../chunks/Br037vyA.js";var Ne=ge('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div> <!></div> <!> <!></div>');function ke(V,P){Pe(P,!1);let M=S(),X=S(),x=S(),l,b,k=S(50),E=!1,K=S({lng:4.35,lat:50.85}),Q=S(11);function ve(e){const n=me;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${n.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${n.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}const f=me.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let C=S(f[0].id),T=S(f[f.length-1].id);function be(e){e.preventDefault(),e.stopPropagation(),E=!0}function we(e){if(!E||!s(x))return;e.preventDefault();const n=s(x).getBoundingClientRect(),d=e.clientX-n.left;y(k,Math.max(0,Math.min(100,d/n.width*100)))}function Se(){E=!1}function Ee(e){e.preventDefault(),e.stopPropagation(),E=!0}function Be(e){if(!E||!s(x))return;e.preventDefault();const n=s(x).getBoundingClientRect(),d=e.touches[0].clientX-n.left;y(k,Math.max(0,Math.min(100,d/n.width*100)))}function xe(){E=!1}function D(e,n){const d=e.getStyle();if(d?.layers)for(const r of d.layers){if(!r.id.endsWith("-layer"))continue;e.getLayer(r.id)&&e.removeLayer(r.id);const i=r.source;i&&e.getSource(i)&&e.removeSource(i)}n.layers.forEach(r=>{const i=r.id,I=`${r.id}-layer`;e.getSource(i)||e.addSource(i,{type:"raster",tiles:[ve(r)],tileSize:256,maxzoom:20}),e.getLayer(I)||e.addLayer({id:I,type:"raster",source:i,paint:{"raster-opacity":0,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),n.layers.forEach(r=>{const i=`${r.id}-layer`;e.getLayer(i)&&e.moveLayer(i)});const g=n.layers.map(r=>`${r.id}-layer`);let z=0;const Y=g.length,te=()=>{z++,z>=Y&&g.forEach(r=>{e.getLayer(r)&&e.setPaintProperty(r,"raster-opacity",1)})},q=r=>{r.isSourceLoaded&&r.sourceId&&n.layers.some(i=>i.id===r.sourceId)&&te()};e.on("sourcedata",q),setTimeout(()=>{e.off("sourcedata",q),g.forEach(r=>{e.getLayer(r)&&e.getPaintProperty(r,"raster-opacity")===0&&e.setPaintProperty(r,"raster-opacity",1)})},2e3)}function Ce(e){if(!l)return;const n=f.find(d=>d.id===e);n&&(D(l,n),y(C,e))}function Te(e){if(!b)return;const n=f.find(d=>d.id===e);n&&(D(b,n),y(T,e))}Ie(()=>{let e=null;(()=>{if(typeof window>"u")return;const o=window.location.hash.slice(1);if(!o)return;const t=o.split(",");if(t.length>=3){const a=parseFloat(t[0]),u=parseFloat(t[1]),v=parseFloat(t[2].replace("z",""));if(!isNaN(a)&&!isNaN(u)&&!isNaN(v)&&(e={center:[u,a],zoom:v}),t.length>=5){const H=t[3],se=t[4];f.find($=>$.id===H)&&y(C,H),f.find($=>$.id===se)&&y(T,se)}}})();let d=!1;const g=new Map,z=[[4.243,50.764],[4.482,50.913]],Y=[[4.05,50.65],[4.68,51.05]],te=f.find(o=>o.id===s(C)),q=f.find(o=>o.id===s(T));l=new N.Map({container:s(M),style:{version:8,sources:{},layers:[]},...e?{center:e.center,zoom:e.zoom}:{bounds:z,fitBoundsOptions:{padding:0}},minZoom:10,maxZoom:20,maxBounds:Y,attributionControl:!1}),b=new N.Map({container:s(X),style:{version:8,sources:{},layers:[]},...e?{center:e.center,zoom:e.zoom}:{bounds:z,fitBoundsOptions:{padding:0}},minZoom:10,maxZoom:20,maxBounds:Y,interactive:!1,attributionControl:!1}),l.once("load",()=>D(l,te)),b.once("load",()=>D(b,q)),l.addControl(new N.NavigationControl,"bottom-left"),l.addControl(new N.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const r={forwardGeocode:async o=>{const t=(o.query??"").trim().toLowerCase();if(g.has(t))return g.get(t);const a=[];try{const v=encodeURIComponent(t);if(!v)return{type:"FeatureCollection",features:a};const H=`https://nominatim.openstreetmap.org/search?q=${v}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,$=await(await fetch(H,{headers:{"Accept-Language":"fr"}})).json();for(const p of $.features??[]){const ue=p.properties?.address?.region,U=p.properties?.address?.state;if(!(ue?.includes("Bruxelles")||ue?.includes("Brussels")||U==="Bruxelles-Capitale"||U==="Brussels Hoofdstedelijk Gewest"||U==="Région de Bruxelles-Capitale"||U==="Brussels-Capital"))continue;const ne=p.bbox,w=Array.isArray(ne)&&ne.length===4?ne.map(Number):void 0;let L;if(w)L=[w[0]+(w[2]-w[0])/2,w[1]+(w[3]-w[1])/2];else if(p.geometry?.type==="Point"&&Array.isArray(p.geometry.coordinates))L=[Number(p.geometry.coordinates[0]),Number(p.geometry.coordinates[1])];else{const B=[],fe=c=>{c&&(c.type==="Point"?B.push([+c.coordinates[0],+c.coordinates[1]]):c.type==="LineString"||c.type==="MultiPoint"?c.coordinates.forEach(m=>B.push([+m[0],+m[1]])):c.type==="Polygon"||c.type==="MultiLineString"?c.coordinates.flat(1).forEach(m=>B.push([+m[0],+m[1]])):c.type==="MultiPolygon"?c.coordinates.flat(2).forEach(m=>B.push([+m[0],+m[1]])):c.type==="GeometryCollection"&&(c.geometries||[]).forEach(fe))};if(fe(p.geometry),B.length){const c=B.map(ae=>ae[0]),m=B.map(ae=>ae[1]),A=[Math.min(...c),Math.min(...m),Math.max(...c),Math.max(...m)];L=[A[0]+(A[2]-A[0])/2,A[1]+(A[3]-A[1])/2]}else L=[4.3517,50.8503]}a.push({type:"Feature",geometry:{type:"Point",coordinates:L},place_name:p.properties?.display_name,properties:{...p.properties,bbox:w},text:p.properties?.display_name,place_type:["place"],center:L,bbox:w})}}catch(v){console.error("forwardGeocode error:",v)}const u={type:"FeatureCollection",features:a};if(g.size>=50){const v=g.keys().next().value;v!==void 0&&g.delete(v)}return g.set(t,u),u}},i=new Ge(r,{maplibregl:N,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});l.addControl(i,"top-left");const I=o=>{const t=o.bbox??o.properties?.bbox;t&&Array.isArray(t)&&t.length===4?l.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):l.flyTo({center:o.center,zoom:15,duration:1200})};let _=[],h=0;i.on("results",o=>{_=o.features||[],h=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(a=>a.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&o.addEventListener("keydown",t=>{const a=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&_.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const u=_[h];u&&(I(u),t.target.value="",i.clear(),_=[])}else t.key==="ArrowDown"&&a.length>0?(t.preventDefault(),h=Math.min(h+1,_.length-1),a.forEach(u=>u.classList.remove("active")),a[h]&&a[h].classList.add("active")):t.key==="ArrowUp"&&a.length>0&&(t.preventDefault(),h=Math.max(h-1,0),a.forEach(u=>u.classList.remove("active")),a[h]&&a[h].classList.add("active"))},!0)},100),i.on("result",o=>{const t=o.result;I(t),setTimeout(()=>{const a=document.querySelector(".maplibregl-ctrl-geocoder input");a&&(a.value=""),i.clear()},100)});const Re=(o,t)=>{d||(d=!0,t.jumpTo({center:o.getCenter(),zoom:o.getZoom(),bearing:o.getBearing(),pitch:o.getPitch()}),requestAnimationFrame(()=>{d=!1}))};l.on("move",()=>{!E&&!d&&Re(l,b);const o=l.getCenter();y(K,{lng:o.lng,lat:o.lat}),y(Q,l.getZoom()),typeof window<"u"&&(window.location.hash=`${o.lat.toFixed(6)},${o.lng.toFixed(6)},${s(Q).toFixed(2)}z,${s(C)},${s(T)}`)});let oe=null;const re=()=>{oe||(oe=window.setTimeout(()=>{l&&l.resize(),b&&b.resize(),oe=null},250))};return setTimeout(re,100),window.addEventListener("resize",re),()=>{window.removeEventListener("resize",re),l.remove(),b.remove()}}),_e();var J=Ne();R("mousemove",Z,we),R("mouseup",Z,Se),R("touchmove",Z,Be),R("touchend",Z,xe);var F=W(J),le=W(F);ie(le,e=>y(M,e),()=>s(M));var ee=G(le,2);ie(ee,e=>y(X,e),()=>s(X));var O=G(ee,2),ce=W(O);j(O);var Le=G(O,2);$e(Le,{get lat(){return s(K).lat},get lng(){return s(K).lng},get zoom(){return s(Q)},get yearBefore(){return s(C)},get yearAfter(){return s(T)}}),j(F),ie(F,e=>y(x,e),()=>s(x));var de=G(F,2);ye(de,{side:"left",get groups(){return f},get selectedId(){return s(C)},$$events:{select:e=>Ce(e.detail.id)}});var Ae=G(de,2);ye(Ae,{side:"right",get groups(){return f},get selectedId(){return s(T)},$$events:{select:e=>Te(e.detail.id)}}),j(J),Me(()=>{pe(ee,`clip-path: inset(0 0 0 ${s(k)??""}%)`),pe(O,`left: ${s(k)??""}%`)}),R("mousedown",ce,be),R("touchstart",ce,Ee),he(V,J),ze()}var De=ge('<div class="page-container svelte-1ewpa8p"><!></div>');function Ke(V){var P=De(),M=W(P);ke(M,{}),j(P),he(V,P)}export{Ke as component};
