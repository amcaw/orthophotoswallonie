import"../chunks/DsnmJJEf.js";import"../chunks/Cflq-a96.js";import{as as re,D as K,F as ne,G as V,at as ae,z as m,a6 as P,J as Y,R as T,I as G,K as Q}from"../chunks/Dlg-gMpp.js";import{o as ie,e as le}from"../chunks/COQ8bC4V.js";import{s as O,o as H,m as f,M as U}from"../chunks/B22aiAXe.js";import{b as J}from"../chunks/5YV8zeCu.js";import{i as ce}from"../chunks/DMWEl-21.js";var pe=K('<div class="map-lens-wrapper svelte-1kjt96t"><div></div> <div></div> <div class="lens-border svelte-1kjt96t"></div> <button class="swap-button svelte-1kjt96t" title="Inverser les couches"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1kjt96t"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg></button></div>');function de(S,b){re(b,!1);let v=P(),A=P(),u,i,C=P(!1);const q=[[2.75,49.45],[6.5,50.85]];function X(){T(C,!m(C))}ie(()=>{let r=!1;const h=H.orthophotos.find(t=>t.id==="ortho-1971"),M=H.orthophotos.find(t=>t.id==="ortho-2023-ete");i=new f.Map({container:m(A),style:{version:8,sources:{[M.id]:{type:"raster",tiles:[`${M.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&f=image`],tileSize:256}},layers:[{id:`${M.id}-layer`,type:"raster",source:M.id,paint:{}}]},bounds:q,fitBoundsOptions:{padding:20},minZoom:8,maxZoom:17,attributionControl:!1}),u=new f.Map({container:m(v),style:{version:8,sources:{[h.id]:{type:"raster",tiles:[`${h.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&f=image`],tileSize:256}},layers:[{id:`${h.id}-layer`,type:"raster",source:h.id,paint:{}}]},bounds:q,fitBoundsOptions:{padding:20},minZoom:8,maxZoom:17,attributionControl:!1}),i.addControl(new f.NavigationControl,"bottom-left"),u.addControl(new f.NavigationControl,"bottom-left"),i.addControl(new f.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const I={forwardGeocode:async t=>{const e=[];try{const s=encodeURIComponent((t.query??"").trim());if(!s)return{type:"FeatureCollection",features:e};const c=`https://nominatim.openstreetmap.org/search?q=${s}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,te=await(await fetch(c,{headers:{"Accept-Language":"fr"}})).json(),oe=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const n of te.features??[]){const j=n.properties?.address?.state,se=n.properties?.address?.county;if(!(j==="Wallonie"||j==="Région wallonne"||oe.some(p=>se?.includes(p)||j?.includes(p))))continue;const z=n.bbox,d=Array.isArray(z)&&z.length===4?z.map(Number):void 0;let g;if(d)g=[d[0]+(d[2]-d[0])/2,d[1]+(d[3]-d[1])/2];else if(n.geometry?.type==="Point"&&Array.isArray(n.geometry.coordinates))g=[Number(n.geometry.coordinates[0]),Number(n.geometry.coordinates[1])];else{const p=[],F=o=>{o&&(o.type==="Point"?p.push([+o.coordinates[0],+o.coordinates[1]]):o.type==="LineString"||o.type==="MultiPoint"?o.coordinates.forEach(a=>p.push([+a[0],+a[1]])):o.type==="Polygon"||o.type==="MultiLineString"?o.coordinates.flat(1).forEach(a=>p.push([+a[0],+a[1]])):o.type==="MultiPolygon"?o.coordinates.flat(2).forEach(a=>p.push([+a[0],+a[1]])):o.type==="GeometryCollection"&&(o.geometries||[]).forEach(F))};if(F(n.geometry),p.length){const o=p.map(E=>E[0]),a=p.map(E=>E[1]),y=[Math.min(...o),Math.min(...a),Math.max(...o),Math.max(...a)];g=[y[0]+(y[2]-y[0])/2,y[1]+(y[3]-y[1])/2]}else g=[4.4699,50.5039]}e.push({type:"Feature",geometry:{type:"Point",coordinates:g},place_name:n.properties?.display_name,properties:{...n.properties,bbox:d},text:n.properties?.display_name,place_type:["place"],center:g,bbox:d})}}catch(s){console.error("forwardGeocode error:",s)}return{type:"FeatureCollection",features:e}}},w=new U(I,{maplibregl:f,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:200,minLength:2,showResultMarkers:!1});i.addControl(w,"top-left");const k=new U(I,{maplibregl:f,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:200,minLength:2,showResultMarkers:!1});u.addControl(k,"top-left");const N=t=>{const e=t.bbox??t.properties?.bbox;e&&Array.isArray(e)&&e.length===4?i.fitBounds([[e[0],e[1]],[e[2],e[3]]],{padding:50,maxZoom:16,duration:1200}):i.flyTo({center:t.center,zoom:15,duration:1200})};let x=[],l=0;const Z=t=>{x=t.features||[],l=0,setTimeout(()=>{const e=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");e.length>0&&(e.forEach(s=>s.classList.remove("active")),e[0].classList.add("active"))},50)};w.on("results",Z),k.on("results",Z),setTimeout(()=>{const t=document.querySelector(".maplibregl-ctrl-geocoder input");t&&t.addEventListener("keydown",e=>{const s=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(e.key==="Enter"&&x.length>0){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const c=x[l];c&&(N(c),e.target.value="",w.clear(),x=[])}else e.key==="ArrowDown"&&s.length>0?(e.preventDefault(),l=Math.min(l+1,x.length-1),s.forEach(c=>c.classList.remove("active")),s[l]&&s[l].classList.add("active")):e.key==="ArrowUp"&&s.length>0&&(e.preventDefault(),l=Math.max(l-1,0),s.forEach(c=>c.classList.remove("active")),s[l]&&s[l].classList.add("active"))},!0)},100);const $=t=>{const e=t.result;N(e),setTimeout(()=>{w.clear(),k.clear(),document.querySelectorAll(".maplibregl-ctrl-geocoder input").forEach(c=>c.value="")},100)};w.on("result",$),k.on("result",$);const D=(t,e)=>{r||(r=!0,e.jumpTo({center:t.getCenter(),zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch()}),requestAnimationFrame(()=>{r=!1}))};return i.on("move",()=>{r||D(i,u)}),u.on("move",()=>{r||D(u,i)}),()=>{u.remove(),i.remove()}}),ce();var L=pe(),R=Y(L);let B;J(R,r=>T(A,r),()=>m(A));var _=G(R,2);let W;J(_,r=>T(v,r),()=>m(v));var ee=G(_,4);Q(L),ne((r,h)=>{B=O(R,1,"map-container after svelte-1kjt96t",null,B,r),W=O(_,1,"map-container before svelte-1kjt96t",null,W,h)},[()=>({lens:m(C)}),()=>({lens:!m(C)})]),le("click",ee,X),V(S,L),ae()}var ue=K('<div class="map-container svelte-1mf7qal"><!></div>');function Ce(S){var b=ue(),v=Y(b);de(v,{}),Q(b),V(S,b)}export{Ce as component};
