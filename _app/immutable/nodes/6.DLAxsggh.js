import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Ee,A as J,B as le,C as F,J as Te,F as b,w as a,D as A,K as B,M as g,G as w,an as ge,P as Pe}from"../chunks/Ehb9Q6W5.js";import{o as Be,e as ce,s as de}from"../chunks/BKIJojkU.js";import{i as Le}from"../chunks/Im4b7-9j.js";import{e as Ie,i as ze,s as ue}from"../chunks/yJVuIktW.js";import{S as $e,m as H,M as Ae,s as Fe}from"../chunks/VYvS0YDk.js";import{b as Re}from"../chunks/m2zDNTuv.js";import{i as Me}from"../chunks/D631TkqT.js";import{o as pe}from"../chunks/C4AmPXCP.js";var Ge=ge('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),Ne=ge('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),We=J('<button><span class="year-label svelte-hmkkg"> </span></button>'),He=J('<div class="travel-container svelte-hmkkg"><div class="map-container svelte-hmkkg"></div> <div class="year-overlay svelte-hmkkg"> </div> <div class="share-wrapper-traveltime svelte-hmkkg"><!></div> <div class="playbar svelte-hmkkg"><div class="playbar-controls svelte-hmkkg"><button class="playbar-btn svelte-hmkkg"><!></button></div> <div class="timeline svelte-hmkkg"><div class="timeline-track svelte-hmkkg"><div class="timeline-progress svelte-hmkkg"></div></div> <div class="timeline-years svelte-hmkkg"></div></div></div></div>');function De(D,L){Ee(L,!1);let f=B(),e,T=B(!1),v=B(0),I=null,C=B(0),Y=B({lng:4.35,lat:50.85}),R=B(11);const me=[[4.243,50.764],[4.482,50.913]],fe=[[4.05,50.65],[4.68,51.05]];function M(t){const o=pe;return t.service==="urban-brussels"&&t.crs==="EPSG:31370"?`${o.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${t.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${o.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${t.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}function ye(t){const o=t.clientWidth||window.innerWidth,n=t.clientHeight||window.innerHeight,c=Math.round(Math.max(12,Math.min(o,n)*.03)),r=o<768,h=r?120:80;return{top:c+(r?30:40),right:c+10,bottom:c+h,left:c+10}}function ee(t){if(!e||!a(f))return;const o=ye(a(f));e.resize();const n=a(f).clientWidth||window.innerWidth,c=n<640?9:n<1024?9.5:(n<1300,10);e.setMinZoom(c),e.fitBounds(me,{padding:o,duration:t?.animate?400:0})}const l=pe.orthophotos.map(t=>({id:t.id,year:t.year,displayYear:t.year,layers:[t]}));function te(){if(!e)return;const t=(a(v)+1)%l.length;l[t].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[M(r)],tileSize:256,maxzoom:20}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})});const n=(a(v)-1+l.length)%l.length;l[n].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[M(r)],tileSize:256,maxzoom:20}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function ve(){a(T)?G():he()}function he(){if(!e)return;g(T,!0),te();const t=Date.now(),o=a(C)/100*(l.length-1),n=2500,c=1300,r=()=>{if(!a(T))return;const y=(Date.now()-t)/n,m=o+y;if(m>=l.length-1){g(v,l.length-1),g(C,100),G();return}const p=Math.floor(m);g(C,m/(l.length-1)*100),p!==a(v)&&(g(v,p),re(c),te()),I=window.requestAnimationFrame(r)};I=window.requestAnimationFrame(r)}function G(){g(T,!1),I&&(cancelAnimationFrame(I),I=null);const t=Math.floor(a(C)/100*(l.length-1));t>=0&&t<l.length&&g(v,t)}function we(t){a(T)&&G();const n=t/(l.length-1)*100,c=a(C),r=Date.now(),h=300,y=()=>{const m=Date.now()-r,p=Math.min(m/h,1),s=1-Math.pow(1-p,3);g(C,c+(n-c)*s),p<1?requestAnimationFrame(y):g(C,n)};if(g(v,t),re(),y(),typeof window<"u"&&e){const m=e.getCenter(),p=e.getZoom(),s=l[t]?.id;s&&(window.location.hash=`${m.lat.toFixed(6)},${m.lng.toFixed(6)},${p.toFixed(2)}z,${s}`)}}function re(t=0){if(!e)return;const o=l[a(v)],n=e.getStyle();if(n?.layers)for(const s of n.layers){if(!s.id.endsWith("-layer"))continue;!o.layers.some(_=>`${_.id}-layer`===s.id)&&e.getLayer(s.id)&&(e.setPaintProperty(s.id,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(s.id,"raster-opacity",0))}o.layers.forEach(s=>{const d=s.id,_=`${s.id}-layer`;e.getSource(d)||e.addSource(d,{type:"raster",tiles:[M(s)],tileSize:256,maxzoom:20}),e.getLayer(_)||e.addLayer({id:_,type:"raster",source:d,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),o.layers.forEach(s=>{const d=`${s.id}-layer`;e.getLayer(d)&&e.moveLayer(d)});const c=o.layers.map(s=>`${s.id}-layer`);let r=0;const h=c.length,y=()=>{c.forEach(s=>{e.getLayer(s)&&(e.setPaintProperty(s,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(s,"raster-opacity",1))})},m=()=>{r++,r>=h&&y()},p=s=>{s.isSourceLoaded&&s.sourceId&&o.layers.some(d=>d.id===s.sourceId)&&m()};e.on("sourcedata",p),setTimeout(()=>{e.off("sourcedata",p),y()},t>0?t+1e3:1e3),t>0&&setTimeout(()=>{const s=e?.getStyle();if(s?.layers)for(const d of s.layers){if(!d.id.endsWith("-layer"))continue;if(!o.layers.some(x=>`${x.id}-layer`===d.id)){e.getLayer(d.id)&&e.removeLayer(d.id);const x=d.source;x&&e.getSource(x)&&e.removeSource(x)}}},t+100)}Be(async()=>{let t=null;const o=()=>{if(typeof window>"u")return!1;const i=window.location.hash.slice(1);if(!i)return!1;const u=i.split(",");if(u.length>=3){const P=parseFloat(u[0]),z=parseFloat(u[1]),S=parseFloat(u[2].replace("z",""));if(!isNaN(P)&&!isNaN(z)&&!isNaN(S)){if(t={center:[z,P],zoom:S},u.length>=4){const K=u[3],N=l.findIndex(Q=>Q.id===K);N!==-1&&(g(v,N),g(C,N/(l.length-1)*100))}return!0}}return!1};o()||(await new Promise(i=>setTimeout(i,10)),o());const n=new Map,c=l[0],r={},h=[];c.layers.forEach(i=>{r[i.id]={type:"raster",tiles:[M(i)],tileSize:256,maxzoom:20}}),c.layers.forEach(i=>{h.push({id:`${i.id}-layer`,type:"raster",source:i.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),e=new H.Map({container:a(f),style:{version:8,sources:r,layers:h},...t?{center:t.center,zoom:t.zoom}:{},maxZoom:20,minZoom:9,maxBounds:fe,preserveDrawingBuffer:!0,attributionControl:!1}),e.addControl(new H.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const y={forwardGeocode:async i=>{const u=(i.query??"").trim().toLowerCase();if(n.has(u))return n.get(u);const P=[];try{const S=encodeURIComponent(u);if(!S)return{type:"FeatureCollection",features:P};const K=`https://nominatim.openstreetmap.org/search?q=${S}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,Q=await(await fetch(K,{headers:{"Accept-Language":"fr"}})).json();for(const k of Q.features??[]){const ie=k.properties?.address?.region,W=k.properties?.address?.state;if(!(ie?.includes("Bruxelles")||ie?.includes("Brussels")||W==="Bruxelles-Capitale"||W==="Brussels Hoofdstedelijk Gewest"||W==="Région de Bruxelles-Capitale"||W==="Brussels-Capital"))continue;const X=k.bbox,E=Array.isArray(X)&&X.length===4?X.map(Number):void 0;let $;E?$=[E[0]+(E[2]-E[0])/2,E[1]+(E[3]-E[1])/2]:k.geometry?.type==="Point"&&Array.isArray(k.geometry.coordinates)?$=[Number(k.geometry.coordinates[0]),Number(k.geometry.coordinates[1])]:$=[4.3517,50.8503],P.push({type:"Feature",geometry:{type:"Point",coordinates:$},place_name:k.properties?.display_name,properties:{...k.properties,bbox:E},text:k.properties?.display_name,place_type:["place"],center:$,bbox:E})}}catch(S){console.error("forwardGeocode error:",S)}const z={type:"FeatureCollection",features:P};if(n.size>=50){const S=n.keys().next().value;S!==void 0&&n.delete(S)}return n.set(u,z),z}},m=new Ae(y,{maplibregl:H,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});e.addControl(m,"top-left"),e.addControl(new H.NavigationControl,"top-left"),e.on("move",()=>{const i=e.getCenter();if(g(Y,{lng:i.lng,lat:i.lat}),g(R,e.getZoom()),typeof window<"u"){const u=l[a(v)]?.id;u?window.location.hash=`${i.lat.toFixed(6)},${i.lng.toFixed(6)},${a(R).toFixed(2)}z,${u}`:window.location.hash=`${i.lat.toFixed(6)},${i.lng.toFixed(6)},${a(R).toFixed(2)}z`}}),t||e.once("idle",()=>ee({animate:!1}));let p=a(f).clientWidth,s=a(f).clientHeight;const d=new ResizeObserver(()=>{const i=a(f).clientWidth,u=a(f).clientHeight;(i!==p||u!==s)&&(p=i,s=u,ee({animate:!1}))});d.observe(a(f));let _=null;const x=()=>{_||(_=window.setTimeout(()=>{e&&e.resize(),_=null},250))};return setTimeout(()=>e.resize(),100),window.addEventListener("resize",x),window.addEventListener("orientationchange",x),()=>{G(),d.disconnect(),window.removeEventListener("resize",x),window.removeEventListener("orientationchange",x),e.remove()}}),Me();var q=He(),se=b(q);Re(se,t=>g(f,t),()=>a(f));var O=A(se,2),be=b(O,!0);w(O);var j=A(O,2),xe=b(j);$e(xe,{get lat(){return a(Y).lat},get lng(){return a(Y).lng},get zoom(){return a(R)}}),w(j);var ae=A(j,2),U=b(ae),Z=b(U),Se=b(Z);{var ke=t=>{var o=Ge();F(t,o)},Ce=t=>{var o=Ne();F(t,o)};Le(Se,t=>{a(T)?t(ke):t(Ce,!1)})}w(Z),w(U);var oe=A(U,2),V=b(oe),_e=b(V);w(V);var ne=A(V,2);Ie(ne,5,()=>l,ze,(t,o,n)=>{const c=Pe(()=>n/(l.length-1)*100);var r=We();let h;var y=b(r),m=b(y,!0);w(y),w(r),le(p=>{h=Fe(r,1,"year-marker svelte-hmkkg",null,h,p),ue(r,`left: ${a(c)??""}%`),de(m,a(o).displayYear)},[()=>({active:n===a(v)})]),ce("click",r,()=>we(n)),F(t,r)}),w(ne),w(oe),w(ae),w(q),le(()=>{de(be,l[a(v)].displayYear),ue(_e,`width: ${a(C)??""}%`)}),ce("click",Z,ve),F(D,q),Te()}var Ye=J('<div class="page-container svelte-16kfyeo"><!></div>');function tt(D){var L=Ye(),f=b(L);De(f,{}),w(L),F(D,L)}export{tt as component};
