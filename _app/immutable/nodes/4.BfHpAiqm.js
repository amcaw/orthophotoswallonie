import"../chunks/DsnmJJEf.js";import"../chunks/B4sJI0eo.js";import{M as ne,D as J,F as ae,G as K,O as ie,z as f,P as I,J as ee,Q as P,I as V,K as te}from"../chunks/DIJBUjZ_.js";import{o as le,e as ce}from"../chunks/C9FblJra.js";import{s as Y,m as g,M as Q}from"../chunks/vio3IFUB.js";import{b as X}from"../chunks/-Mqpy0Mp.js";import{i as pe}from"../chunks/CyI37tKr.js";import{o as q}from"../chunks/C4AmPXCP.js";var ue=J('<div class="map-lens-wrapper svelte-lapvzq"><div></div> <div></div> <div class="lens-border svelte-lapvzq"></div> <button class="swap-button svelte-lapvzq" title="Inverser les couches"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-lapvzq"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg></button></div>');function de(R,y){ne(y,!1);let b=I(),x=I(),p,n,E=I(!1);const G=[[4.243,50.764],[4.482,50.913]];function N(s){const u=q;return s.service==="urban-brussels"&&s.crs==="EPSG:31370"?`${u.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${s.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${u.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${s.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}function oe(){P(E,!f(E))}le(()=>{let s=!1;const u=q.orthophotos.find(t=>t.id==="ortho-1971"),C=q.orthophotos.find(t=>t.id==="ortho-2024");n=new g.Map({container:f(x),style:{version:8,sources:{[C.id]:{type:"raster",tiles:[N(C)],tileSize:256}},layers:[{id:`${C.id}-layer`,type:"raster",source:C.id,paint:{}}]},bounds:G,fitBoundsOptions:{padding:20},minZoom:10,maxZoom:20,attributionControl:!1}),p=new g.Map({container:f(b),style:{version:8,sources:{[u.id]:{type:"raster",tiles:[N(u)],tileSize:256}},layers:[{id:`${u.id}-layer`,type:"raster",source:u.id,paint:{}}]},bounds:G,fitBoundsOptions:{padding:20},minZoom:10,maxZoom:20,attributionControl:!1}),n.addControl(new g.NavigationControl,"bottom-left"),p.addControl(new g.NavigationControl,"bottom-left"),n.addControl(new g.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const U={forwardGeocode:async t=>{const e=[];try{const r=encodeURIComponent((t.query??"").trim());if(!r)return{type:"FeatureCollection",features:e};const c=`https://nominatim.openstreetmap.org/search?q=${r}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,re=await(await fetch(c,{headers:{"Accept-Language":"fr"}})).json();for(const a of re.features??[]){const W=a.properties?.address?.region,B=a.properties?.address?.state;if(!(W?.includes("Bruxelles")||W?.includes("Brussels")||B==="Bruxelles-Capitale"||B==="Brussels Hoofdstedelijk Gewest"||B==="Région de Bruxelles-Capitale"||B==="Brussels-Capital"))continue;const L=a.bbox,d=Array.isArray(L)&&L.length===4?L.map(Number):void 0;let h;if(d)h=[d[0]+(d[2]-d[0])/2,d[1]+(d[3]-d[1])/2];else if(a.geometry?.type==="Point"&&Array.isArray(a.geometry.coordinates))h=[Number(a.geometry.coordinates[0]),Number(a.geometry.coordinates[1])];else{const m=[],Z=o=>{o&&(o.type==="Point"?m.push([+o.coordinates[0],+o.coordinates[1]]):o.type==="LineString"||o.type==="MultiPoint"?o.coordinates.forEach(i=>m.push([+i[0],+i[1]])):o.type==="Polygon"||o.type==="MultiLineString"?o.coordinates.flat(1).forEach(i=>m.push([+i[0],+i[1]])):o.type==="MultiPolygon"?o.coordinates.flat(2).forEach(i=>m.push([+i[0],+i[1]])):o.type==="GeometryCollection"&&(o.geometries||[]).forEach(Z))};if(Z(a.geometry),m.length){const o=m.map(_=>_[0]),i=m.map(_=>_[1]),v=[Math.min(...o),Math.min(...i),Math.max(...o),Math.max(...i)];h=[v[0]+(v[2]-v[0])/2,v[1]+(v[3]-v[1])/2]}else h=[4.3517,50.8503]}e.push({type:"Feature",geometry:{type:"Point",coordinates:h},place_name:a.properties?.display_name,properties:{...a.properties,bbox:d},text:a.properties?.display_name,place_type:["place"],center:h,bbox:d})}}catch(r){console.error("forwardGeocode error:",r)}return{type:"FeatureCollection",features:e}}},w=new Q(U,{maplibregl:g,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:200,minLength:2,showResultMarkers:!1});n.addControl(w,"top-left");const M=new Q(U,{maplibregl:g,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:200,minLength:2,showResultMarkers:!1});p.addControl(M,"top-left");const $=t=>{const e=t.bbox??t.properties?.bbox;e&&Array.isArray(e)&&e.length===4?n.fitBounds([[e[0],e[1]],[e[2],e[3]]],{padding:50,maxZoom:16,duration:1200}):n.flyTo({center:t.center,zoom:15,duration:1200})};let S=[],l=0;const j=t=>{S=t.features||[],l=0,setTimeout(()=>{const e=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");e.length>0&&(e.forEach(r=>r.classList.remove("active")),e[0].classList.add("active"))},50)};w.on("results",j),M.on("results",j),setTimeout(()=>{const t=document.querySelector(".maplibregl-ctrl-geocoder input");t&&t.addEventListener("keydown",e=>{const r=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(e.key==="Enter"&&S.length>0){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const c=S[l];c&&($(c),e.target.value="",w.clear(),S=[])}else e.key==="ArrowDown"&&r.length>0?(e.preventDefault(),l=Math.min(l+1,S.length-1),r.forEach(c=>c.classList.remove("active")),r[l]&&r[l].classList.add("active")):e.key==="ArrowUp"&&r.length>0&&(e.preventDefault(),l=Math.max(l-1,0),r.forEach(c=>c.classList.remove("active")),r[l]&&r[l].classList.add("active"))},!0)},100);const D=t=>{const e=t.result;$(e),setTimeout(()=>{w.clear(),M.clear(),document.querySelectorAll(".maplibregl-ctrl-geocoder input").forEach(c=>c.value="")},100)};w.on("result",D),M.on("result",D);const F=(t,e)=>{s||(s=!0,e.jumpTo({center:t.getCenter(),zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch()}),requestAnimationFrame(()=>{s=!1}))};n.on("move",()=>{s||F(n,p)}),p.on("move",()=>{s||F(p,n)});const z=()=>{p&&p.resize(),n&&n.resize()};return setTimeout(z,100),window.addEventListener("resize",z),()=>{window.removeEventListener("resize",z),p.remove(),n.remove()}}),pe();var T=ue(),A=ee(T);let O;X(A,s=>P(x,s),()=>f(x));var k=V(A,2);let H;X(k,s=>P(b,s),()=>f(b));var se=V(k,4);te(T),ae((s,u)=>{O=Y(A,1,"map-container after svelte-lapvzq",null,O,s),H=Y(k,1,"map-container before svelte-lapvzq",null,H,u)},[()=>({lens:f(E)}),()=>({lens:!f(E)})]),ce("click",se,oe),K(R,T),ie()}var me=J('<div class="page-container svelte-44n6ux"><!></div>');function Me(R){var y=me(),b=ee(y);de(b,{}),te(y),K(R,y)}export{Me as component};
