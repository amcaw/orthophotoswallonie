import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as _e,K as L,A as Se,B as Ge,C as Ee,J as Fe,am as H,F as V,D as Y,w as n,M as h,G as X}from"../chunks/Ehb9Q6W5.js";import{o as ke,e as R}from"../chunks/BKIJojkU.js";import{s as ve}from"../chunks/yJVuIktW.js";import{b as ce}from"../chunks/m2zDNTuv.js";import{i as He}from"../chunks/D631TkqT.js";import{S as Ye,m as D,M as De}from"../chunks/VYvS0YDk.js";import{o as we}from"../chunks/C4AmPXCP.js";import{Y as be}from"../chunks/Br037vyA.js";var Oe=Se('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div> <!></div> <!> <!></div>');function Ue(K,$){_e($,!1);let I=L(),Q=L(),P=L(),a,v,O=L(50),C=!1,J=L({lng:4.35,lat:50.85}),de=L(11);function Ce(e){const i=we;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${i.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${i.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}const p=we.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let T=L(p[0].id),B=L(p[p.length-1].id);function Te(e){e.preventDefault(),e.stopPropagation(),C=!0}function Be(e){if(!C||!n(P))return;e.preventDefault();const i=n(P).getBoundingClientRect(),u=e.clientX-i.left;h(O,Math.max(0,Math.min(100,u/i.width*100)))}function xe(){C=!1}function Le(e){C=!0}function Ae(e){if(!C||!n(P))return;const i=n(P).getBoundingClientRect(),u=e.touches[0].clientX-i.left;h(O,Math.max(0,Math.min(100,u/i.width*100)))}function Re(){C=!1}function Pe(){C=!1}function z(e,i){const u=e.getStyle();if(u?.layers)for(const r of u.layers){if(!r.id.endsWith("-layer"))continue;e.getLayer(r.id)&&e.removeLayer(r.id);const c=r.source;c&&e.getSource(c)&&e.removeSource(c)}i.layers.forEach(r=>{const c=r.id,F=`${r.id}-layer`;e.getSource(c)||e.addSource(c,{type:"raster",tiles:[Ce(r)],tileSize:256,maxzoom:20}),e.getLayer(F)||e.addLayer({id:F,type:"raster",source:c,paint:{"raster-opacity":0,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),i.layers.forEach(r=>{const c=`${r.id}-layer`;e.getLayer(c)&&e.moveLayer(c)});const w=i.layers.map(r=>`${r.id}-layer`);let G=0;const Z=w.length,oe=()=>{G++,G>=Z&&w.forEach(r=>{e.getLayer(r)&&e.setPaintProperty(r,"raster-opacity",1)})},W=r=>{r.isSourceLoaded&&r.sourceId&&i.layers.some(c=>c.id===r.sourceId)&&oe()};e.on("sourcedata",W),setTimeout(()=>{e.off("sourcedata",W),w.forEach(r=>{e.getLayer(r)&&e.getPaintProperty(r,"raster-opacity")===0&&e.setPaintProperty(r,"raster-opacity",1)})},2e3)}let _=null;function ze(e){if(!a)return;const i=p.find(u=>u.id===e);i&&(z(a,i),h(T,e),_&&_(!0))}function Me(e){if(!v)return;const i=p.find(u=>u.id===e);i&&(z(v,i),h(B,e),_&&_(!0))}ke(async()=>{let e=null;const i=()=>{if(typeof window>"u")return!1;const o=window.location.hash.slice(1);if(!o)return!1;const t=o.split(",");if(t.length>=3){const s=parseFloat(t[0]),l=parseFloat(t[1]),m=parseFloat(t[2].replace("z",""));if(!isNaN(s)&&!isNaN(l)&&!isNaN(m)){if(e={center:[l,s],zoom:m},t.length>=5){const S=t[3],x=t[4];p.find(g=>g.id===S)&&h(T,S),p.find(g=>g.id===x)&&h(B,x)}return!0}}return!1};i()||(await new Promise(o=>setTimeout(o,10)),i());let u=!1;const w=new Map,G=[[4.243,50.764],[4.482,50.913]],Z=[[4.05,50.65],[4.68,51.05]],oe=p.find(o=>o.id===n(T)),W=p.find(o=>o.id===n(B));a=new D.Map({container:n(I),style:{version:8,sources:{},layers:[]},...e?{center:e.center,zoom:e.zoom}:{bounds:G,fitBoundsOptions:{padding:0}},minZoom:10,maxZoom:20,maxBounds:Z,attributionControl:!1}),v=new D.Map({container:n(Q),style:{version:8,sources:{},layers:[]},...e?{center:e.center,zoom:e.zoom}:{bounds:G,fitBoundsOptions:{padding:0}},minZoom:10,maxZoom:20,maxBounds:Z,interactive:!1,attributionControl:!1}),a.once("load",()=>z(a,oe)),v.once("load",()=>z(v,W)),a.addControl(new D.NavigationControl,"bottom-left"),a.addControl(new D.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const r={forwardGeocode:async o=>{const t=(o.query??"").trim().toLowerCase();if(w.has(t))return w.get(t);const s=[];try{const m=encodeURIComponent(t);if(!m)return{type:"FeatureCollection",features:s};const S=`https://nominatim.openstreetmap.org/search?q=${m}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,g=await(await fetch(S,{headers:{"Accept-Language":"fr"}})).json();for(const f of g.features??[]){const ge=f.properties?.address?.region,j=f.properties?.address?.state;if(!(ge?.includes("Bruxelles")||ge?.includes("Brussels")||j==="Bruxelles-Capitale"||j==="Brussels Hoofdstedelijk Gewest"||j==="Région de Bruxelles-Capitale"||j==="Brussels-Capital"))continue;const ie=f.bbox,E=Array.isArray(ie)&&ie.length===4?ie.map(Number):void 0;let M;if(E)M=[E[0]+(E[2]-E[0])/2,E[1]+(E[3]-E[1])/2];else if(f.geometry?.type==="Point"&&Array.isArray(f.geometry.coordinates))M=[Number(f.geometry.coordinates[0]),Number(f.geometry.coordinates[1])];else{const A=[],ye=d=>{d&&(d.type==="Point"?A.push([+d.coordinates[0],+d.coordinates[1]]):d.type==="LineString"||d.type==="MultiPoint"?d.coordinates.forEach(y=>A.push([+y[0],+y[1]])):d.type==="Polygon"||d.type==="MultiLineString"?d.coordinates.flat(1).forEach(y=>A.push([+y[0],+y[1]])):d.type==="MultiPolygon"?d.coordinates.flat(2).forEach(y=>A.push([+y[0],+y[1]])):d.type==="GeometryCollection"&&(d.geometries||[]).forEach(ye))};if(ye(f.geometry),A.length){const d=A.map(le=>le[0]),y=A.map(le=>le[1]),N=[Math.min(...d),Math.min(...y),Math.max(...d),Math.max(...y)];M=[N[0]+(N[2]-N[0])/2,N[1]+(N[3]-N[1])/2]}else M=[4.3517,50.8503]}s.push({type:"Feature",geometry:{type:"Point",coordinates:M},place_name:f.properties?.display_name,properties:{...f.properties,bbox:E},text:f.properties?.display_name,place_type:["place"],center:M,bbox:E})}}catch(m){console.error("forwardGeocode error:",m)}const l={type:"FeatureCollection",features:s};if(w.size>=50){const m=w.keys().next().value;m!==void 0&&w.delete(m)}return w.set(t,l),l}},c=new De(r,{maplibregl:D,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});a.addControl(c,"top-left");const F=o=>{const t=o.bbox??o.properties?.bbox;t&&Array.isArray(t)&&t.length===4?a.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):a.flyTo({center:o.center,zoom:15,duration:1200})};let k=[],b=0;c.on("results",o=>{k=o.features||[],b=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(s=>s.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&o.addEventListener("keydown",t=>{const s=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&k.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const l=k[b];l&&(F(l),t.target.value="",c.clear(),k=[])}else t.key==="ArrowDown"&&s.length>0?(t.preventDefault(),b=Math.min(b+1,k.length-1),s.forEach(l=>l.classList.remove("active")),s[b]&&s[b].classList.add("active")):t.key==="ArrowUp"&&s.length>0&&(t.preventDefault(),b=Math.max(b-1,0),s.forEach(l=>l.classList.remove("active")),s[b]&&s[b].classList.add("active"))},!0)},100),c.on("result",o=>{const t=o.result;F(t),setTimeout(()=>{const s=document.querySelector(".maplibregl-ctrl-geocoder input");s&&(s.value=""),c.clear()},100)});const Ie=(o,t)=>{u||(u=!0,t.jumpTo({center:o.getCenter(),zoom:o.getZoom(),bearing:o.getBearing(),pitch:o.getPitch()}),requestAnimationFrame(()=>{u=!1}))};let re=null,me="";const se=(o=!1)=>{if(typeof window>"u"||!a)return;const t=a.getCenter(),s=a.getZoom(),l=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${s.toFixed(2)}z,${n(T)},${n(B)}`;l!==me&&(me=l,o?window.location.hash=l:history.replaceState(null,"",`#${l}`))};_=se,a.on("move",()=>{!C&&!u&&Ie(a,v);const o=a.getCenter();h(J,{lng:o.lng,lat:o.lat}),h(de,a.getZoom()),se(!1),re&&clearTimeout(re),re=window.setTimeout(()=>{se(!0)},1e3)});let ne=null;const ae=()=>{ne||(ne=window.setTimeout(()=>{a&&a.resize(),v&&v.resize(),ne=null},250))};setTimeout(ae,100),window.addEventListener("resize",ae);const he=()=>{if(typeof window>"u")return;const o=window.location.hash.slice(1);if(!o)return;const t=o.split(",");if(t.length>=3){const s=parseFloat(t[0]),l=parseFloat(t[1]),m=parseFloat(t[2].replace("z",""));if(!isNaN(s)&&!isNaN(l)&&!isNaN(m)&&(a&&a.flyTo({center:[l,s],zoom:m,duration:1e3}),t.length>=5)){const S=t[3],x=t[4];if(S&&S!==n(T)){const g=p.find(f=>f.id===S);g&&(h(T,S),z(a,g))}if(x&&x!==n(B)){const g=p.find(f=>f.id===x);g&&(h(B,x),z(v,g))}}}};return window.addEventListener("hashchange",he),()=>{window.removeEventListener("resize",ae),window.removeEventListener("hashchange",he),a.remove(),v.remove()}}),He();var ee=Oe();R("mousemove",H,Be),R("mouseup",H,xe),R("touchmove",H,Ae),R("touchend",H,Re),R("touchcancel",H,Pe);var U=V(ee),ue=V(U);ce(ue,e=>h(I,e),()=>n(I));var te=Y(ue,2);ce(te,e=>h(Q,e),()=>n(Q));var q=Y(te,2),fe=V(q);X(q);var Ne=Y(q,2);Ye(Ne,{get lat(){return n(J).lat},get lng(){return n(J).lng},get zoom(){return n(de)},get yearBefore(){return n(T)},get yearAfter(){return n(B)}}),X(U),ce(U,e=>h(P,e),()=>n(P));var pe=Y(U,2);be(pe,{side:"left",get groups(){return p},get selectedId(){return n(T)},$$events:{select:e=>ze(e.detail.id)}});var $e=Y(pe,2);be($e,{side:"right",get groups(){return p},get selectedId(){return n(B)},$$events:{select:e=>Me(e.detail.id)}}),X(ee),Ge(()=>{ve(te,`clip-path: inset(0 0 0 ${n(O)??""}%)`),ve(q,`left: ${n(O)??""}%`)}),R("mousedown",fe,Te),R("touchstart",fe,Le),Ee(K,ee),Fe()}var qe=Se('<div class="page-container svelte-1ewpa8p"><!></div>');function rt(K){var $=qe(),I=V($);Ue(I,{}),X($),Ee(K,$)}export{rt as component};
