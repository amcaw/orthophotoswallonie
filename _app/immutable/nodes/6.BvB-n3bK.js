import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Ee,A as J,B as le,C as $,J as Te,F as b,w as s,D as R,K as P,M as p,G as h,an as ge,P as Be}from"../chunks/Ehb9Q6W5.js";import{o as Pe,e as ce,s as de}from"../chunks/BKIJojkU.js";import{i as Le}from"../chunks/Im4b7-9j.js";import{e as Ie,i as ze,s as ue}from"../chunks/yJVuIktW.js";import{S as Ae,m as W,M as Re,s as $e}from"../chunks/VYvS0YDk.js";import{b as Me}from"../chunks/m2zDNTuv.js";import{i as Fe}from"../chunks/D631TkqT.js";import{o as pe}from"../chunks/C4AmPXCP.js";var Ge=ge('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),Ne=ge('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),He=J('<button><span class="year-label svelte-hmkkg"> </span></button>'),We=J('<div class="travel-container svelte-hmkkg"><div class="map-container svelte-hmkkg"></div> <div class="year-overlay svelte-hmkkg"> </div> <div class="share-wrapper-traveltime svelte-hmkkg"><!></div> <div class="playbar svelte-hmkkg"><div class="playbar-controls svelte-hmkkg"><button class="playbar-btn svelte-hmkkg"><!></button></div> <div class="timeline svelte-hmkkg"><div class="timeline-track svelte-hmkkg"><div class="timeline-progress svelte-hmkkg"></div></div> <div class="timeline-years svelte-hmkkg"></div></div></div></div>');function De(D,L){Ee(L,!1);let g=P(),t,T=P(!1),y=P(0),I=null,_=P(0),Y=P({lng:4.35,lat:50.85}),M=P(11);const me=[[4.243,50.764],[4.482,50.913]],fe=[[4.05,50.65],[4.68,51.05]];function F(e){const n=pe;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${n.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${n.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}function ye(e){const n=e.clientWidth||window.innerWidth,o=e.clientHeight||window.innerHeight,l=Math.round(Math.max(12,Math.min(n,o)*.03)),r=n<768,v=r?120:80;return{top:l+(r?30:40),right:l+10,bottom:l+v,left:l+10}}function ee(e){if(!t||!s(g))return;const n=ye(s(g));t.resize();const o=s(g).clientWidth||window.innerWidth,l=o<640?9:o<1024?9.5:(o<1300,10);t.setMinZoom(l),t.fitBounds(me,{padding:n,duration:e?.animate?400:0})}const i=pe.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));function te(){if(!t)return;const e=(s(y)+1)%i.length;i[e].layers.forEach(r=>{t.getSource(r.id)||t.addSource(r.id,{type:"raster",tiles:[F(r)],tileSize:256,maxzoom:20}),t.getLayer(`${r.id}-layer`)||t.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})});const o=(s(y)-1+i.length)%i.length;i[o].layers.forEach(r=>{t.getSource(r.id)||t.addSource(r.id,{type:"raster",tiles:[F(r)],tileSize:256,maxzoom:20}),t.getLayer(`${r.id}-layer`)||t.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function ve(){s(T)?G():he()}function he(){if(!t)return;p(T,!0),te();const e=Date.now(),n=s(_)/100*(i.length-1),o=2500,l=1300,r=()=>{if(!s(T))return;const m=(Date.now()-e)/o,w=n+m;if(w>=i.length-1){p(y,i.length-1),p(_,100),G();return}const f=Math.floor(w);p(_,w/(i.length-1)*100),f!==s(y)&&(p(y,f),re(l),te()),I=window.requestAnimationFrame(r)};I=window.requestAnimationFrame(r)}function G(){p(T,!1),I&&(cancelAnimationFrame(I),I=null);const e=Math.floor(s(_)/100*(i.length-1));e>=0&&e<i.length&&p(y,e)}function we(e){s(T)&&G();const o=e/(i.length-1)*100,l=s(_),r=Date.now(),v=300,m=()=>{const w=Date.now()-r,f=Math.min(w/v,1),a=1-Math.pow(1-f,3);p(_,l+(o-l)*a),f<1?requestAnimationFrame(m):p(_,o)};p(y,e),re(),m()}function re(e=0){if(!t)return;const n=i[s(y)],o=t.getStyle();if(o?.layers)for(const a of o.layers){if(!a.id.endsWith("-layer"))continue;!n.layers.some(C=>`${C.id}-layer`===a.id)&&t.getLayer(a.id)&&(t.setPaintProperty(a.id,"raster-opacity-transition",{duration:e,delay:0}),t.setPaintProperty(a.id,"raster-opacity",0))}n.layers.forEach(a=>{const d=a.id,C=`${a.id}-layer`;t.getSource(d)||t.addSource(d,{type:"raster",tiles:[F(a)],tileSize:256,maxzoom:20}),t.getLayer(C)||t.addLayer({id:C,type:"raster",source:d,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),n.layers.forEach(a=>{const d=`${a.id}-layer`;t.getLayer(d)&&t.moveLayer(d)});const l=n.layers.map(a=>`${a.id}-layer`);let r=0;const v=l.length,m=()=>{l.forEach(a=>{t.getLayer(a)&&(t.setPaintProperty(a,"raster-opacity-transition",{duration:e,delay:0}),t.setPaintProperty(a,"raster-opacity",1))})},w=()=>{r++,r>=v&&m()},f=a=>{a.isSourceLoaded&&a.sourceId&&n.layers.some(d=>d.id===a.sourceId)&&w()};t.on("sourcedata",f),setTimeout(()=>{t.off("sourcedata",f),m()},e>0?e+1e3:1e3),e>0&&setTimeout(()=>{const a=t?.getStyle();if(a?.layers)for(const d of a.layers){if(!d.id.endsWith("-layer"))continue;if(!n.layers.some(x=>`${x.id}-layer`===d.id)){t.getLayer(d.id)&&t.removeLayer(d.id);const x=d.source;x&&t.getSource(x)&&t.removeSource(x)}}},e+100)}Pe(()=>{let e=null;(()=>{if(typeof window>"u")return;const c=window.location.hash.slice(1);if(!c)return;const u=c.split(",");if(u.length>=3){const B=parseFloat(u[0]),z=parseFloat(u[1]),S=parseFloat(u[2].replace("z",""));if(!isNaN(B)&&!isNaN(z)&&!isNaN(S)&&(e={center:[z,B],zoom:S}),u.length>=4){const K=u[3],N=i.findIndex(Q=>Q.id===K);N!==-1&&(p(y,N),p(_,N/(i.length-1)*100))}}})();const o=new Map,l=i[0],r={},v=[];l.layers.forEach(c=>{r[c.id]={type:"raster",tiles:[F(c)],tileSize:256,maxzoom:20}}),l.layers.forEach(c=>{v.push({id:`${c.id}-layer`,type:"raster",source:c.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),t=new W.Map({container:s(g),style:{version:8,sources:r,layers:v},...e?{center:e.center,zoom:e.zoom}:{},maxZoom:20,minZoom:9,maxBounds:fe,preserveDrawingBuffer:!0,attributionControl:!1}),t.addControl(new W.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const m={forwardGeocode:async c=>{const u=(c.query??"").trim().toLowerCase();if(o.has(u))return o.get(u);const B=[];try{const S=encodeURIComponent(u);if(!S)return{type:"FeatureCollection",features:B};const K=`https://nominatim.openstreetmap.org/search?q=${S}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,Q=await(await fetch(K,{headers:{"Accept-Language":"fr"}})).json();for(const k of Q.features??[]){const ie=k.properties?.address?.region,H=k.properties?.address?.state;if(!(ie?.includes("Bruxelles")||ie?.includes("Brussels")||H==="Bruxelles-Capitale"||H==="Brussels Hoofdstedelijk Gewest"||H==="Région de Bruxelles-Capitale"||H==="Brussels-Capital"))continue;const X=k.bbox,E=Array.isArray(X)&&X.length===4?X.map(Number):void 0;let A;E?A=[E[0]+(E[2]-E[0])/2,E[1]+(E[3]-E[1])/2]:k.geometry?.type==="Point"&&Array.isArray(k.geometry.coordinates)?A=[Number(k.geometry.coordinates[0]),Number(k.geometry.coordinates[1])]:A=[4.3517,50.8503],B.push({type:"Feature",geometry:{type:"Point",coordinates:A},place_name:k.properties?.display_name,properties:{...k.properties,bbox:E},text:k.properties?.display_name,place_type:["place"],center:A,bbox:E})}}catch(S){console.error("forwardGeocode error:",S)}const z={type:"FeatureCollection",features:B};if(o.size>=50){const S=o.keys().next().value;S!==void 0&&o.delete(S)}return o.set(u,z),z}},w=new Re(m,{maplibregl:W,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});t.addControl(w,"top-left"),t.addControl(new W.NavigationControl,"top-left"),t.on("move",()=>{const c=t.getCenter();if(p(Y,{lng:c.lng,lat:c.lat}),p(M,t.getZoom()),typeof window<"u"){const u=i[s(y)]?.id;u?window.location.hash=`${c.lat.toFixed(6)},${c.lng.toFixed(6)},${s(M).toFixed(2)}z,${u}`:window.location.hash=`${c.lat.toFixed(6)},${c.lng.toFixed(6)},${s(M).toFixed(2)}z`}}),e||t.once("idle",()=>ee({animate:!1}));let f=s(g).clientWidth,a=s(g).clientHeight;const d=new ResizeObserver(()=>{const c=s(g).clientWidth,u=s(g).clientHeight;(c!==f||u!==a)&&(f=c,a=u,ee({animate:!1}))});d.observe(s(g));let C=null;const x=()=>{C||(C=window.setTimeout(()=>{t&&t.resize(),C=null},250))};return setTimeout(()=>t.resize(),100),window.addEventListener("resize",x),window.addEventListener("orientationchange",x),()=>{G(),d.disconnect(),window.removeEventListener("resize",x),window.removeEventListener("orientationchange",x),t.remove()}}),Fe();var q=We(),se=b(q);Me(se,e=>p(g,e),()=>s(g));var O=R(se,2),be=b(O,!0);h(O);var j=R(O,2),xe=b(j);Ae(xe,{get lat(){return s(Y).lat},get lng(){return s(Y).lng},get zoom(){return s(M)}}),h(j);var ae=R(j,2),U=b(ae),Z=b(U),Se=b(Z);{var ke=e=>{var n=Ge();$(e,n)},_e=e=>{var n=Ne();$(e,n)};Le(Se,e=>{s(T)?e(ke):e(_e,!1)})}h(Z),h(U);var oe=R(U,2),V=b(oe),Ce=b(V);h(V);var ne=R(V,2);Ie(ne,5,()=>i,ze,(e,n,o)=>{const l=Be(()=>o/(i.length-1)*100);var r=He();let v;var m=b(r),w=b(m,!0);h(m),h(r),le(f=>{v=$e(r,1,"year-marker svelte-hmkkg",null,v,f),ue(r,`left: ${s(l)??""}%`),de(w,s(n).displayYear)},[()=>({active:o===s(y)})]),ce("click",r,()=>we(o)),$(e,r)}),h(ne),h(oe),h(ae),h(q),le(()=>{de(be,i[s(y)].displayYear),ue(Ce,`width: ${s(_)??""}%`)}),ce("click",Z,ve),$(D,q),Te()}var Ye=J('<div class="page-container svelte-16kfyeo"><!></div>');function tt(D){var L=Ye(),g=b(L);De(g,{}),h(L),$(D,L)}export{tt as component};
