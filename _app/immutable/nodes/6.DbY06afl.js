import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Ee,A as J,B as le,C as $,J as Te,F as b,w as s,D as R,K as B,M as p,G as h,an as me,P as Pe}from"../chunks/Ehb9Q6W5.js";import{o as Be,e as ce,s as de}from"../chunks/BKIJojkU.js";import{i as Le}from"../chunks/Im4b7-9j.js";import{e as Ie,i as ze,s as ue}from"../chunks/yJVuIktW.js";import{S as Ae,m as H,M as Re,s as $e}from"../chunks/VYvS0YDk.js";import{b as Me}from"../chunks/m2zDNTuv.js";import{i as Fe}from"../chunks/D631TkqT.js";import{o as pe}from"../chunks/C4AmPXCP.js";var Ge=me('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),Ne=me('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),We=J('<button><span class="year-label svelte-hmkkg"> </span></button>'),He=J('<div class="travel-container svelte-hmkkg"><div class="map-container svelte-hmkkg"></div> <div class="year-overlay svelte-hmkkg"> </div> <div class="share-wrapper-traveltime svelte-hmkkg"><!></div> <div class="playbar svelte-hmkkg"><div class="playbar-controls svelte-hmkkg"><button class="playbar-btn svelte-hmkkg"><!></button></div> <div class="timeline svelte-hmkkg"><div class="timeline-track svelte-hmkkg"><div class="timeline-progress svelte-hmkkg"></div></div> <div class="timeline-years svelte-hmkkg"></div></div></div></div>');function De(D,L){Ee(L,!1);let m=B(),t,T=B(!1),y=B(0),I=null,_=B(0),Y=B({lng:4.35,lat:50.85}),M=B(11);const ge=[[4.243,50.764],[4.482,50.913]],fe=[[4.05,50.65],[4.68,51.05]];function F(e){const o=pe;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${o.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${o.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}function ye(e){const o=e.clientWidth||window.innerWidth,n=e.clientHeight||window.innerHeight,c=Math.round(Math.max(12,Math.min(o,n)*.03)),r=o<768,v=r?120:80;return{top:c+(r?30:40),right:c+10,bottom:c+v,left:c+10}}function ee(e){if(!t||!s(m))return;const o=ye(s(m));t.resize();const n=s(m).clientWidth||window.innerWidth,c=n<640?9:n<1024?9.5:(n<1300,10);t.setMinZoom(c),t.fitBounds(ge,{padding:o,duration:e?.animate?400:0})}const l=pe.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));function te(){if(!t)return;const e=(s(y)+1)%l.length;l[e].layers.forEach(r=>{t.getSource(r.id)||t.addSource(r.id,{type:"raster",tiles:[F(r)],tileSize:256,maxzoom:20}),t.getLayer(`${r.id}-layer`)||t.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})});const n=(s(y)-1+l.length)%l.length;l[n].layers.forEach(r=>{t.getSource(r.id)||t.addSource(r.id,{type:"raster",tiles:[F(r)],tileSize:256,maxzoom:20}),t.getLayer(`${r.id}-layer`)||t.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function ve(){s(T)?G():he()}function he(){if(!t)return;p(T,!0),te();const e=Date.now(),o=s(_)/100*(l.length-1),n=2500,c=1300,r=()=>{if(!s(T))return;const g=(Date.now()-e)/n,w=o+g;if(w>=l.length-1){p(y,l.length-1),p(_,100),G();return}const f=Math.floor(w);p(_,w/(l.length-1)*100),f!==s(y)&&(p(y,f),re(c),te()),I=window.requestAnimationFrame(r)};I=window.requestAnimationFrame(r)}function G(){p(T,!1),I&&(cancelAnimationFrame(I),I=null);const e=Math.floor(s(_)/100*(l.length-1));e>=0&&e<l.length&&p(y,e)}function we(e){s(T)&&G();const n=e/(l.length-1)*100,c=s(_),r=Date.now(),v=300,g=()=>{const w=Date.now()-r,f=Math.min(w/v,1),a=1-Math.pow(1-f,3);p(_,c+(n-c)*a),f<1?requestAnimationFrame(g):p(_,n)};p(y,e),re(),g()}function re(e=0){if(!t)return;const o=l[s(y)],n=t.getStyle();if(n?.layers)for(const a of n.layers){if(!a.id.endsWith("-layer"))continue;!o.layers.some(C=>`${C.id}-layer`===a.id)&&t.getLayer(a.id)&&(t.setPaintProperty(a.id,"raster-opacity-transition",{duration:e,delay:0}),t.setPaintProperty(a.id,"raster-opacity",0))}o.layers.forEach(a=>{const d=a.id,C=`${a.id}-layer`;t.getSource(d)||t.addSource(d,{type:"raster",tiles:[F(a)],tileSize:256,maxzoom:20}),t.getLayer(C)||t.addLayer({id:C,type:"raster",source:d,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),o.layers.forEach(a=>{const d=`${a.id}-layer`;t.getLayer(d)&&t.moveLayer(d)});const c=o.layers.map(a=>`${a.id}-layer`);let r=0;const v=c.length,g=()=>{c.forEach(a=>{t.getLayer(a)&&(t.setPaintProperty(a,"raster-opacity-transition",{duration:e,delay:0}),t.setPaintProperty(a,"raster-opacity",1))})},w=()=>{r++,r>=v&&g()},f=a=>{a.isSourceLoaded&&a.sourceId&&o.layers.some(d=>d.id===a.sourceId)&&w()};t.on("sourcedata",f),setTimeout(()=>{t.off("sourcedata",f),g()},e>0?e+1e3:1e3),e>0&&setTimeout(()=>{const a=t?.getStyle();if(a?.layers)for(const d of a.layers){if(!d.id.endsWith("-layer"))continue;if(!o.layers.some(x=>`${x.id}-layer`===d.id)){t.getLayer(d.id)&&t.removeLayer(d.id);const x=d.source;x&&t.getSource(x)&&t.removeSource(x)}}},e+100)}Be(async()=>{let e=null;const o=()=>{if(typeof window>"u")return!1;const i=window.location.hash.slice(1);if(!i)return!1;const u=i.split(",");if(u.length>=3){const P=parseFloat(u[0]),z=parseFloat(u[1]),S=parseFloat(u[2].replace("z",""));if(!isNaN(P)&&!isNaN(z)&&!isNaN(S)){if(e={center:[z,P],zoom:S},u.length>=4){const K=u[3],N=l.findIndex(Q=>Q.id===K);N!==-1&&(p(y,N),p(_,N/(l.length-1)*100))}return!0}}return!1};o()||(await new Promise(i=>setTimeout(i,10)),o());const n=new Map,c=l[0],r={},v=[];c.layers.forEach(i=>{r[i.id]={type:"raster",tiles:[F(i)],tileSize:256,maxzoom:20}}),c.layers.forEach(i=>{v.push({id:`${i.id}-layer`,type:"raster",source:i.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),t=new H.Map({container:s(m),style:{version:8,sources:r,layers:v},...e?{center:e.center,zoom:e.zoom}:{},maxZoom:20,minZoom:9,maxBounds:fe,preserveDrawingBuffer:!0,attributionControl:!1}),t.addControl(new H.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const g={forwardGeocode:async i=>{const u=(i.query??"").trim().toLowerCase();if(n.has(u))return n.get(u);const P=[];try{const S=encodeURIComponent(u);if(!S)return{type:"FeatureCollection",features:P};const K=`https://nominatim.openstreetmap.org/search?q=${S}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,Q=await(await fetch(K,{headers:{"Accept-Language":"fr"}})).json();for(const k of Q.features??[]){const ie=k.properties?.address?.region,W=k.properties?.address?.state;if(!(ie?.includes("Bruxelles")||ie?.includes("Brussels")||W==="Bruxelles-Capitale"||W==="Brussels Hoofdstedelijk Gewest"||W==="Région de Bruxelles-Capitale"||W==="Brussels-Capital"))continue;const X=k.bbox,E=Array.isArray(X)&&X.length===4?X.map(Number):void 0;let A;E?A=[E[0]+(E[2]-E[0])/2,E[1]+(E[3]-E[1])/2]:k.geometry?.type==="Point"&&Array.isArray(k.geometry.coordinates)?A=[Number(k.geometry.coordinates[0]),Number(k.geometry.coordinates[1])]:A=[4.3517,50.8503],P.push({type:"Feature",geometry:{type:"Point",coordinates:A},place_name:k.properties?.display_name,properties:{...k.properties,bbox:E},text:k.properties?.display_name,place_type:["place"],center:A,bbox:E})}}catch(S){console.error("forwardGeocode error:",S)}const z={type:"FeatureCollection",features:P};if(n.size>=50){const S=n.keys().next().value;S!==void 0&&n.delete(S)}return n.set(u,z),z}},w=new Re(g,{maplibregl:H,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});t.addControl(w,"top-left"),t.addControl(new H.NavigationControl,"top-left"),t.on("move",()=>{const i=t.getCenter();if(p(Y,{lng:i.lng,lat:i.lat}),p(M,t.getZoom()),typeof window<"u"){const u=l[s(y)]?.id;u?window.location.hash=`${i.lat.toFixed(6)},${i.lng.toFixed(6)},${s(M).toFixed(2)}z,${u}`:window.location.hash=`${i.lat.toFixed(6)},${i.lng.toFixed(6)},${s(M).toFixed(2)}z`}}),e||t.once("idle",()=>ee({animate:!1}));let f=s(m).clientWidth,a=s(m).clientHeight;const d=new ResizeObserver(()=>{const i=s(m).clientWidth,u=s(m).clientHeight;(i!==f||u!==a)&&(f=i,a=u,ee({animate:!1}))});d.observe(s(m));let C=null;const x=()=>{C||(C=window.setTimeout(()=>{t&&t.resize(),C=null},250))};return setTimeout(()=>t.resize(),100),window.addEventListener("resize",x),window.addEventListener("orientationchange",x),()=>{G(),d.disconnect(),window.removeEventListener("resize",x),window.removeEventListener("orientationchange",x),t.remove()}}),Fe();var q=He(),se=b(q);Me(se,e=>p(m,e),()=>s(m));var O=R(se,2),be=b(O,!0);h(O);var j=R(O,2),xe=b(j);Ae(xe,{get lat(){return s(Y).lat},get lng(){return s(Y).lng},get zoom(){return s(M)}}),h(j);var ae=R(j,2),U=b(ae),Z=b(U),Se=b(Z);{var ke=e=>{var o=Ge();$(e,o)},_e=e=>{var o=Ne();$(e,o)};Le(Se,e=>{s(T)?e(ke):e(_e,!1)})}h(Z),h(U);var oe=R(U,2),V=b(oe),Ce=b(V);h(V);var ne=R(V,2);Ie(ne,5,()=>l,ze,(e,o,n)=>{const c=Pe(()=>n/(l.length-1)*100);var r=We();let v;var g=b(r),w=b(g,!0);h(g),h(r),le(f=>{v=$e(r,1,"year-marker svelte-hmkkg",null,v,f),ue(r,`left: ${s(c)??""}%`),de(w,s(o).displayYear)},[()=>({active:n===s(y)})]),ce("click",r,()=>we(n)),$(e,r)}),h(ne),h(oe),h(ae),h(q),le(()=>{de(be,l[s(y)].displayYear),ue(Ce,`width: ${s(_)??""}%`)}),ce("click",Z,ve),$(D,q),Te()}var Ye=J('<div class="page-container svelte-16kfyeo"><!></div>');function tt(D){var L=Ye(),m=b(L);De(m,{}),h(L),$(D,L)}export{tt as component};
