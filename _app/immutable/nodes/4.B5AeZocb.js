import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as ge,A as ie,B as he,C as le,J as ye,w as u,K as M,M as E,F as ce,D as Z,G as ue}from"../chunks/Ehb9Q6W5.js";import{o as ve,e as be}from"../chunks/BKIJojkU.js";import{S as we,s as re,m as h,M as ne}from"../chunks/VYvS0YDk.js";import{b as ae}from"../chunks/m2zDNTuv.js";import{i as Ce}from"../chunks/D631TkqT.js";import{o as U}from"../chunks/C4AmPXCP.js";var xe=ie('<div class="map-lens-wrapper svelte-lapvzq"><div></div> <div></div> <div class="lens-border svelte-lapvzq"></div> <button class="swap-button svelte-lapvzq" title="Inverser les couches"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-lapvzq"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg></button> <!></div>');function Se(L,w){ge(w,!1);let C=M(),N=M(),i,n,z=M(!1),P=M({lng:4.35,lat:50.85}),_=M(11);const j=[[4.243,50.764],[4.482,50.913]],D=[[4.05,50.65],[4.68,51.05]];function W(o){const m=U;return o.service==="urban-brussels"&&o.crs==="EPSG:31370"?`${m.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${o.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${m.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${o.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}function pe(){E(z,!u(z))}ve(async()=>{let o=null;const m=()=>{if(typeof window>"u")return!1;const e=window.location.hash.slice(1);if(!e)return!1;const t=e.split(",");if(t.length===3){const s=parseFloat(t[0]),a=parseFloat(t[1]),d=parseFloat(t[2].replace("z",""));if(!isNaN(s)&&!isNaN(a)&&!isNaN(d))return o={center:[a,s],zoom:d},!0}return!1};m()||(await new Promise(e=>setTimeout(e,10)),m());let x=!1;const y=new Map,T=U.orthophotos.find(e=>e.id==="ortho-1971"),A=U.orthophotos.find(e=>e.id==="ortho-2024");n=new h.Map({container:u(N),style:{version:8,sources:{[A.id]:{type:"raster",tiles:[W(A)],tileSize:256}},layers:[{id:`${A.id}-layer`,type:"raster",source:A.id,paint:{}}]},...o?{center:o.center,zoom:o.zoom}:{bounds:j,fitBoundsOptions:{padding:20}},minZoom:10,maxZoom:20,maxBounds:D,attributionControl:!1}),i=new h.Map({container:u(C),style:{version:8,sources:{[T.id]:{type:"raster",tiles:[W(T)],tileSize:256}},layers:[{id:`${T.id}-layer`,type:"raster",source:T.id,paint:{}}]},...o?{center:o.center,zoom:o.zoom}:{bounds:j,fitBoundsOptions:{padding:20}},minZoom:10,maxZoom:20,maxBounds:D,attributionControl:!1}),n.once("idle",()=>{}),i.once("idle",()=>{}),n.on("error",e=>{console.warn("AfterMap tile loading error:",e)}),i.on("error",e=>{console.warn("BeforeMap tile loading error:",e)}),n.addControl(new h.NavigationControl,"bottom-left"),i.addControl(new h.NavigationControl,"bottom-left"),n.addControl(new h.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const Q={forwardGeocode:async e=>{const t=(e.query??"").trim().toLowerCase();if(y.has(t))return y.get(t);const s=[];try{const d=encodeURIComponent(t);if(!d)return{type:"FeatureCollection",features:s};const fe=`https://nominatim.openstreetmap.org/search?q=${d}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,me=await(await fetch(fe,{headers:{"Accept-Language":"fr"}})).json();for(const l of me.features??[]){const oe=l.properties?.address?.region,k=l.properties?.address?.state;if(!(oe?.includes("Bruxelles")||oe?.includes("Brussels")||k==="Bruxelles-Capitale"||k==="Brussels Hoofdstedelijk Gewest"||k==="Région de Bruxelles-Capitale"||k==="Brussels-Capital"))continue;const O=l.bbox,f=Array.isArray(O)&&O.length===4?O.map(Number):void 0;let v;if(f)v=[f[0]+(f[2]-f[0])/2,f[1]+(f[3]-f[1])/2];else if(l.geometry?.type==="Point"&&Array.isArray(l.geometry.coordinates))v=[Number(l.geometry.coordinates[0]),Number(l.geometry.coordinates[1])];else{const g=[],se=r=>{r&&(r.type==="Point"?g.push([+r.coordinates[0],+r.coordinates[1]]):r.type==="LineString"||r.type==="MultiPoint"?r.coordinates.forEach(c=>g.push([+c[0],+c[1]])):r.type==="Polygon"||r.type==="MultiLineString"?r.coordinates.flat(1).forEach(c=>g.push([+c[0],+c[1]])):r.type==="MultiPolygon"?r.coordinates.flat(2).forEach(c=>g.push([+c[0],+c[1]])):r.type==="GeometryCollection"&&(r.geometries||[]).forEach(se))};if(se(l.geometry),g.length){const r=g.map(H=>H[0]),c=g.map(H=>H[1]),b=[Math.min(...r),Math.min(...c),Math.max(...r),Math.max(...c)];v=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2]}else v=[4.3517,50.8503]}s.push({type:"Feature",geometry:{type:"Point",coordinates:v},place_name:l.properties?.display_name,properties:{...l.properties,bbox:f},text:l.properties?.display_name,place_type:["place"],center:v,bbox:f})}}catch(d){console.error("forwardGeocode error:",d)}const a={type:"FeatureCollection",features:s};if(y.size>=50){const d=y.keys().next().value;d!==void 0&&y.delete(d)}return y.set(t,a),a}},S=new ne(Q,{maplibregl:h,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});n.addControl(S,"top-left");const R=new ne(Q,{maplibregl:h,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});i.addControl(R,"top-left");const X=e=>{const t=e.bbox??e.properties?.bbox;t&&Array.isArray(t)&&t.length===4?n.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):n.flyTo({center:e.center,zoom:15,duration:1200})};let B=[],p=0;const J=e=>{B=e.features||[],p=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(s=>s.classList.remove("active")),t[0].classList.add("active"))},50)};S.on("results",J),R.on("results",J),setTimeout(()=>{const e=document.querySelector(".maplibregl-ctrl-geocoder input");e&&e.addEventListener("keydown",t=>{const s=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&B.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const a=B[p];a&&(X(a),t.target.value="",S.clear(),B=[])}else t.key==="ArrowDown"&&s.length>0?(t.preventDefault(),p=Math.min(p+1,B.length-1),s.forEach(a=>a.classList.remove("active")),s[p]&&s[p].classList.add("active")):t.key==="ArrowUp"&&s.length>0&&(t.preventDefault(),p=Math.max(p-1,0),s.forEach(a=>a.classList.remove("active")),s[p]&&s[p].classList.add("active"))},!0)},100);const ee=e=>{const t=e.result;X(t),setTimeout(()=>{S.clear(),R.clear(),document.querySelectorAll(".maplibregl-ctrl-geocoder input").forEach(a=>a.value="")},100)};S.on("result",ee),R.on("result",ee);const te=(e,t)=>{x||(x=!0,t.jumpTo({center:e.getCenter(),zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()}),requestAnimationFrame(()=>{x=!1}))};n.on("move",()=>{x||te(n,i);const e=n.getCenter();E(P,{lng:e.lng,lat:e.lat}),E(_,n.getZoom()),typeof window<"u"&&(window.location.hash=`${e.lat.toFixed(6)},${e.lng.toFixed(6)},${u(_).toFixed(2)}z`)}),i.on("move",()=>{if(x||te(i,n),typeof window<"u"){const e=i.getCenter(),t=i.getZoom();window.location.hash=`${e.lat.toFixed(6)},${e.lng.toFixed(6)},${t.toFixed(2)}z`}});let $=null;const G=()=>{$||($=window.setTimeout(()=>{i&&i.resize(),n&&n.resize(),$=null},250))};return setTimeout(G,100),window.addEventListener("resize",G),()=>{window.removeEventListener("resize",G),i.remove(),n.remove()}}),Ce();var F=xe(),I=ce(F);let V;ae(I,o=>E(N,o),()=>u(N));var q=Z(I,2);let Y;ae(q,o=>E(C,o),()=>u(C));var K=Z(q,4),de=Z(K,2);we(de,{get lat(){return u(P).lat},get lng(){return u(P).lng},get zoom(){return u(_)},yearBefore:"ortho-1971",yearAfter:"ortho-2024"}),ue(F),he((o,m)=>{V=re(I,1,"map-container after svelte-lapvzq",null,V,o),Y=re(q,1,"map-container before svelte-lapvzq",null,Y,m)},[()=>({lens:u(z)}),()=>({lens:!u(z)})]),be("click",K,pe),le(L,F),ye()}var Be=ie('<div class="page-container svelte-44n6ux"><!></div>');function _e(L){var w=Be(),C=ce(w);Se(C,{}),ue(w),le(L,w)}export{_e as component};
