import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Je,K as I,A as Re,B as Ke,C as $e,J as Qe,am as q,F as K,D as W,w as l,M as y,G as Q}from"../chunks/Ehb9Q6W5.js";import{o as et,e as _}from"../chunks/BKIJojkU.js";import{s as Le}from"../chunks/yJVuIktW.js";import{b as ge}from"../chunks/m2zDNTuv.js";import{i as tt}from"../chunks/D631TkqT.js";import{S as ot,m as Z,M as rt}from"../chunks/VYvS0YDk.js";import{o as Ie}from"../chunks/C4AmPXCP.js";import{Y as Ae}from"../chunks/Br037vyA.js";var nt=Re('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div> <!></div> <!> <!></div>');function st(ee,k){Je(k,!1);let D=I(),te=I(),N=I(),a,m,oe=I(50),A=!1,T=null,re=null;function he(e){y(oe,e),re&&cancelAnimationFrame(re),re=requestAnimationFrame(()=>{m&&m.triggerRepaint()})}let ne=I({lng:4.35,lat:50.85}),ye=I(11);function _e(e,r=512){const s=Ie;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${s.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${r}&HEIGHT=${r}&BBOX={bbox-epsg-3857}`:`${s.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${r}&HEIGHT=${r}&BBOX={bbox-epsg-3857}`}const ve=new WeakMap;function Ne(e){let r=ve.get(e);return r||(r=new Set,ve.set(e,r)),r}function Pe(e,r,s=3e3){return new Promise(d=>{let f=!1;const c=()=>{f||(f=!0,X(),d())},M=()=>{r.every(R=>{const H=R.replace(/-layer$/,"");return!!e.getSource(H)&&e.isSourceLoaded(H)})&&e.areTilesLoaded()&&c()},ie=setTimeout(c,s),X=()=>{e.off("idle",M),clearTimeout(ie)};e.on("idle",M),M()})}function ze(e,r,s=512){const d=r.id,f=`${r.id}-layer`;return e.getSource(d)||e.addSource(d,{type:"raster",tiles:[_e(r,s)],tileSize:s,maxzoom:20}),e.getLayer(f)||e.addLayer({id:f,type:"raster",source:d,layout:{visibility:"visible"},paint:{"raster-opacity":0,"raster-fade-duration":300,"raster-resampling":"nearest"}}),f}const g=Ie.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let E=I(g[0].id),x=I(g[g.length-1].id);function B(){A=!1,T!==null&&(clearTimeout(T),T=null)}function Fe(e){e.preventDefault(),e.stopPropagation(),A=!0,T!==null&&clearTimeout(T),T=window.setTimeout(()=>{console.warn("Drag timeout - forcing reset"),B()},1e4)}function Ge(e){if(!A||!l(N))return;e.preventDefault();const r=l(N).getBoundingClientRect(),s=e.clientX-r.left;he(Math.max(0,Math.min(100,s/r.width*100)))}function ke(){B()}function De(e){A=!0,T!==null&&clearTimeout(T),T=window.setTimeout(()=>{console.warn("Touch timeout - forcing reset"),B()},1e4)}function Oe(e){if(!A||!l(N))return;if(!e.touches||e.touches.length===0){B();return}const r=l(N).getBoundingClientRect(),s=e.touches[0].clientX-r.left;he(Math.max(0,Math.min(100,s/r.width*100)))}function He(){B()}function Ye(){B()}function we(){document.hidden&&A&&(console.log("Page hidden - resetting drag state"),B())}async function P(e,r){const s=Ne(e),d=[...s],f=r.layers.map(c=>ze(e,c,512));f.forEach(c=>e.moveLayer(c)),await Pe(e,f,3e3),f.forEach(c=>{e.getLayer(c)&&e.setPaintProperty(c,"raster-opacity",1)}),d.forEach(c=>{e.getLayer(c)&&e.setPaintProperty(c,"raster-opacity",0)}),setTimeout(()=>{d.forEach(c=>{if(!f.includes(c)){const M=c.replace(/-layer$/,"");e.getLayer(c)&&e.removeLayer(c),e.getSource(M)&&e.removeSource(M),s.delete(c)}}),f.forEach(c=>s.add(c))},400)}let O=null;function Ue(e){if(!a)return;const r=g.find(s=>s.id===e);r&&(P(a,r),y(E,e),O&&O(!0))}function qe(e){if(!m)return;const r=g.find(s=>s.id===e);r&&(P(m,r),y(x,e),O&&O(!0))}et(()=>{let e=null;(()=>{if(typeof window>"u")return!1;const o=window.location.hash.slice(1);if(!o)return!1;const t=o.split(",");if(t.length>=3){const n=parseFloat(t[0]),i=parseFloat(t[1]),h=parseFloat(t[2].replace("z",""));if(!isNaN(n)&&!isNaN(i)&&!isNaN(h)){if(e={center:[i,n],zoom:h},t.length>=5){const S=t[3],L=t[4];g.find(v=>v.id===S)&&y(E,S),g.find(v=>v.id===L)&&y(x,L)}return!0}}return!1})();let s=!1;const d=new Map,f=[[4.243,50.764],[4.482,50.913]],c=[[4.05,50.65],[4.68,51.05]],M=g.find(o=>o.id===l(E)),ie=g.find(o=>o.id===l(x)),X={version:8,sources:{positron:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://b.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://c.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> © <a href="https://carto.com/attributions">CARTO</a>'}},layers:[{id:"positron-layer",type:"raster",source:"positron",paint:{"raster-opacity":1}}]},z={container:l(D),style:X,minZoom:10,maxZoom:20,maxBounds:c,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(z.center=e.center,z.zoom=e.zoom):(z.bounds=f,z.fitBoundsOptions={padding:0}),a=new Z.Map(z);const R={container:l(te),style:JSON.parse(JSON.stringify(X)),minZoom:10,maxZoom:20,maxBounds:c,interactive:!1,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(R.center=e.center,R.zoom=e.zoom):(R.bounds=f,R.fitBoundsOptions={padding:0}),m=new Z.Map(R);const H=new Map,le=o=>t=>{if(console.warn("Map error:",t?.error?.status,t?.sourceId),t.sourceId&&t.error?.status>=500){const n=H.get(t.sourceId)||0;n<2&&(H.set(t.sourceId,n+1),setTimeout(()=>{const i=o.getSource(t.sourceId);i&&"reload"in i&&i.reload()},1e3*(n+1)))}};a.on("error",le(a)),m.on("error",le(m)),a.once("load",()=>P(a,M)),m.once("load",()=>P(m,ie)),a.addControl(new Z.NavigationControl,"bottom-left"),a.addControl(new Z.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const Ve={forwardGeocode:async o=>{const t=(o.query??"").trim().toLowerCase();if(d.has(t))return d.get(t);const n=[];try{const h=encodeURIComponent(t);if(!h)return{type:"FeatureCollection",features:n};const S=`https://nominatim.openstreetmap.org/search?q=${h}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,v=await(await fetch(S,{headers:{"Accept-Language":"fr"}})).json();for(const p of v.features??[]){const Be=p.properties?.address?.region,J=p.properties?.address?.state;if(!(Be?.includes("Bruxelles")||Be?.includes("Brussels")||J==="Bruxelles-Capitale"||J==="Brussels Hoofdstedelijk Gewest"||J==="Région de Bruxelles-Capitale"||J==="Brussels-Capital"))continue;const pe=p.bbox,C=Array.isArray(pe)&&pe.length===4?pe.map(Number):void 0;let F;if(C)F=[C[0]+(C[2]-C[0])/2,C[1]+(C[3]-C[1])/2];else if(p.geometry?.type==="Point"&&Array.isArray(p.geometry.coordinates))F=[Number(p.geometry.coordinates[0]),Number(p.geometry.coordinates[1])];else{const $=[],Me=u=>{u&&(u.type==="Point"?$.push([+u.coordinates[0],+u.coordinates[1]]):u.type==="LineString"||u.type==="MultiPoint"?u.coordinates.forEach(w=>$.push([+w[0],+w[1]])):u.type==="Polygon"||u.type==="MultiLineString"?u.coordinates.flat(1).forEach(w=>$.push([+w[0],+w[1]])):u.type==="MultiPolygon"?u.coordinates.flat(2).forEach(w=>$.push([+w[0],+w[1]])):u.type==="GeometryCollection"&&(u.geometries||[]).forEach(Me))};if(Me(p.geometry),$.length){const u=$.map(me=>me[0]),w=$.map(me=>me[1]),G=[Math.min(...u),Math.min(...w),Math.max(...u),Math.max(...w)];F=[G[0]+(G[2]-G[0])/2,G[1]+(G[3]-G[1])/2]}else F=[4.3517,50.8503]}n.push({type:"Feature",geometry:{type:"Point",coordinates:F},place_name:p.properties?.display_name,properties:{...p.properties,bbox:C},text:p.properties?.display_name,place_type:["place"],center:F,bbox:C})}}catch(h){console.error("forwardGeocode error:",h)}const i={type:"FeatureCollection",features:n};if(d.size>=50){const h=d.keys().next().value;h!==void 0&&d.delete(h)}return d.set(t,i),i}},Y=new rt(Ve,{maplibregl:Z,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});a.addControl(Y,"top-left");const Ce=o=>{const t=o.bbox??o.properties?.bbox;t&&Array.isArray(t)&&t.length===4?a.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):a.flyTo({center:o.center,zoom:15,duration:1200})};let U=[],b=0;Y.on("results",o=>{U=o.features||[],b=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(n=>n.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&o.addEventListener("keydown",t=>{const n=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&U.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const i=U[b];i&&(Ce(i),t.target.value="",Y.clear(),U=[])}else t.key==="ArrowDown"&&n.length>0?(t.preventDefault(),b=Math.min(b+1,U.length-1),n.forEach(i=>i.classList.remove("active")),n[b]&&n[b].classList.add("active")):t.key==="ArrowUp"&&n.length>0&&(t.preventDefault(),b=Math.max(b-1,0),n.forEach(i=>i.classList.remove("active")),n[b]&&n[b].classList.add("active"))},!0)},100),Y.on("result",o=>{const t=o.result;Ce(t),setTimeout(()=>{const n=document.querySelector(".maplibregl-ctrl-geocoder input");n&&(n.value=""),Y.clear()},100)});const je=(o,t)=>{s||(s=!0,t.jumpTo({center:o.getCenter(),zoom:o.getZoom(),bearing:o.getBearing(),pitch:o.getPitch()}),requestAnimationFrame(()=>{s=!1}))};let ce=null,Ee="";const ue=(o=!1)=>{if(typeof window>"u"||!a)return;const t=a.getCenter(),n=a.getZoom(),i=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${n.toFixed(2)}z,${l(E)},${l(x)}`;i!==Ee&&(Ee=i,o?window.location.hash=i:history.replaceState(null,"",`#${i}`))};O=ue,a.on("move",()=>{!A&&!s&&je(a,m);const o=a.getCenter();y(ne,{lng:o.lng,lat:o.lat}),y(ye,a.getZoom()),ue(!1),ce&&clearTimeout(ce),ce=window.setTimeout(()=>{ue(!0)},1e3)});let de=null;const fe=()=>{de||(de=window.setTimeout(()=>{a&&a.resize(),m&&m.resize(),de=null},250))};setTimeout(fe,100),window.addEventListener("resize",fe);const xe=()=>{if(typeof window>"u")return;const o=window.location.hash.slice(1);if(!o)return;const t=o.split(",");if(t.length>=3){const n=parseFloat(t[0]),i=parseFloat(t[1]),h=parseFloat(t[2].replace("z",""));if(!isNaN(n)&&!isNaN(i)&&!isNaN(h)&&(a&&a.flyTo({center:[i,n],zoom:h,duration:1e3}),t.length>=5)){const S=t[3],L=t[4];if(S&&S!==l(E)){const v=g.find(p=>p.id===S);v&&(y(E,S),P(a,v))}if(L&&L!==l(x)){const v=g.find(p=>p.id===L);v&&(y(x,L),P(m,v))}}}};window.addEventListener("hashchange",xe),document.addEventListener("visibilitychange",we);const Xe=setInterval(()=>{s&&(console.warn("isSyncing stuck - forcing reset"),s=!1)},5e3);return()=>{window.removeEventListener("resize",fe),window.removeEventListener("hashchange",xe),document.removeEventListener("visibilitychange",we),clearInterval(Xe),B(),a.remove(),m.remove()}}),tt();var se=nt();_("mousemove",q,Ge),_("mouseup",q,ke),_("touchmove",q,Oe),_("touchend",q,He),_("touchcancel",q,Ye);var V=K(se),be=K(V);ge(be,e=>y(D,e),()=>l(D));var ae=W(be,2);ge(ae,e=>y(te,e),()=>l(te));var j=W(ae,2),Te=K(j);Q(j);var We=W(j,2);ot(We,{get lat(){return l(ne).lat},get lng(){return l(ne).lng},get zoom(){return l(ye)},get yearBefore(){return l(E)},get yearAfter(){return l(x)}}),Q(V),ge(V,e=>y(N,e),()=>l(N));var Se=W(V,2);Ae(Se,{side:"left",get groups(){return g},get selectedId(){return l(E)},$$events:{select:e=>Ue(e.detail.id)}});var Ze=W(Se,2);Ae(Ze,{side:"right",get groups(){return g},get selectedId(){return l(x)},$$events:{select:e=>qe(e.detail.id)}}),Q(se),Ke(()=>{Le(ae,`clip-path: inset(0 0 0 calc(${l(oe)??""}% - 0.5px))`),Le(j,`left: ${l(oe)??""}%`)}),_("mousedown",Te,Fe),_("touchstart",Te,De),$e(ee,se),Qe()}var at=Re('<div class="page-container svelte-1ewpa8p"><!></div>');function vt(ee){var k=at(),D=K(k);st(D,{}),Q(k),$e(ee,k)}export{vt as component};
