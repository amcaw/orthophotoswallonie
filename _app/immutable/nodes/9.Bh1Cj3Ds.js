import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Pe,A as V,B as ie,C as E,J as Ce,F as b,w as a,D as A,K as j,M as u,G as h,an as pe,P as $e,ao as je}from"../chunks/Ehb9Q6W5.js";import{o as Ie,e as le,s as ce,h as Te}from"../chunks/BKIJojkU.js";import{i as We}from"../chunks/Im4b7-9j.js";import{e as Fe,i as Ae,s as de}from"../chunks/yJVuIktW.js";import{S as Ee,m as B,M as Me,s as Re}from"../chunks/VYvS0YDk.js";import{b as ke}from"../chunks/m2zDNTuv.js";import{i as Be}from"../chunks/D631TkqT.js";import{o as Ge}from"../chunks/CUZUMNKG.js";var Ne=pe('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),qe=pe('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),He=V('<button><span class="year-label svelte-wish1j"> </span></button>'),De=V('<div class="travel-container svelte-wish1j"><div class="map-container svelte-wish1j"></div> <div class="year-overlay svelte-wish1j"> </div> <div class="share-wrapper-traveltime svelte-wish1j"><!></div> <div class="playbar svelte-wish1j"><div class="playbar-controls svelte-wish1j"><button class="playbar-btn svelte-wish1j"><!></button></div> <div class="timeline svelte-wish1j"><div class="timeline-track svelte-wish1j"><div class="timeline-progress svelte-wish1j"></div></div> <div class="timeline-years svelte-wish1j"></div></div></div></div>');function Ye(G,I){Pe(I,!1);let f=j(),e,C=j(!1),g=j(0),T=null,z=j(0),N=j({lng:4.5,lat:50.5}),M=j(8);const ue=[[2.75,49.45],[6.5,50.85]],fe=[[2,49],[7.2,51.3]];function me(t){const o=t.clientWidth||window.innerWidth,s=t.clientHeight||window.innerHeight,i=Math.round(Math.max(12,Math.min(o,s)*.03)),r=o<768,v=r?120:80;return{top:i+(r?30:40),right:i+10,bottom:i+v,left:i+10}}function X(t){if(!e||!a(f))return;const o=me(a(f));e.resize();const s=a(f).clientWidth||window.innerWidth,i=s<640?5.5:s<1024?6:s<1300?6.5:7;e.setMinZoom(i);const r={top:o.top-50,right:o.right-50,bottom:o.bottom-50,left:o.left-50};e.fitBounds(ue,{padding:r,duration:t?.animate?400:0})}const c=Ge.orthophotos.reduce((t,o)=>{const s=o.year.split(" ")[0],i=t.find(r=>r.year===s);return i?i.layers.push(o):t.push({year:s,displayYear:s,layers:[o]}),t},[]).map(t=>({...t,layers:t.layers.slice().sort((o,s)=>{const i=r=>/Printemps/i.test(r)?0:/Été|Ete/i.test(r)?1:2;return i(o.year)-i(s.year)})}));function ee(){if(!e)return;const t=(a(g)+1)%c.length;c[t].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[`${r.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})});const s=(a(g)-1+c.length)%c.length;c[s].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[`${r.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function ye(){a(C)?R():ge()}function ge(){if(!e)return;u(C,!0),ee();const t=Date.now(),o=a(z)/100*(c.length-1),s=2500,i=1300,r=()=>{if(!a(C))return;const m=(Date.now()-t)/s,w=o+m;if(w>=c.length-1){u(g,c.length-1),u(z,100),R();return}const y=Math.floor(w);u(z,w/(c.length-1)*100),y!==a(g)&&(u(g,y),te(i),ee()),T=window.requestAnimationFrame(r)};T=window.requestAnimationFrame(r)}function R(){u(C,!1),T&&(cancelAnimationFrame(T),T=null);const t=Math.floor(a(z)/100*(c.length-1));t>=0&&t<c.length&&u(g,t)}function ve(t){a(C)&&R();const s=t/(c.length-1)*100,i=a(z),r=Date.now(),v=300,m=()=>{const w=Date.now()-r,y=Math.min(w/v,1),n=1-Math.pow(1-y,3);u(z,i+(s-i)*n),y<1?requestAnimationFrame(m):u(z,s)};u(g,t),te(),m()}function te(t=0){if(!e)return;const o=c[a(g)],s=e.getStyle();if(s?.layers)for(const n of s.layers){if(!n.id.endsWith("-layer"))continue;!o.layers.some(L=>`${L.id}-layer`===n.id)&&e.getLayer(n.id)&&(e.setPaintProperty(n.id,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(n.id,"raster-opacity",0))}o.layers.forEach(n=>{const d=n.id,L=`${n.id}-layer`;e.getSource(d)||e.addSource(d,{type:"raster",tiles:[`${n.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(L)||e.addLayer({id:L,type:"raster",source:d,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),o.layers.forEach(n=>{const d=`${n.id}-layer`;e.getLayer(d)&&e.moveLayer(d)});const i=o.layers.map(n=>`${n.id}-layer`);let r=0;const v=i.length,m=()=>{i.forEach(n=>{e.getLayer(n)&&(e.setPaintProperty(n,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(n,"raster-opacity",1))})},w=()=>{r++,r>=v&&m()},y=n=>{n.isSourceLoaded&&n.sourceId&&o.layers.some(d=>d.id===n.sourceId)&&w()};e.on("sourcedata",y),setTimeout(()=>{e.off("sourcedata",y),m()},t>0?t+1e3:1e3),t>0&&setTimeout(()=>{const n=e?.getStyle();if(n?.layers)for(const d of n.layers){if(!d.id.endsWith("-layer"))continue;if(!o.layers.some(x=>`${x.id}-layer`===d.id)){e.getLayer(d.id)&&e.removeLayer(d.id);const x=d.source;x&&e.getSource(x)&&e.removeSource(x)}}},t+100)}Ie(async()=>{const t=new Map,o=c[0];let s=null;const i=()=>{if(typeof window>"u")return!1;const l=window.location.hash.slice(1);if(!l)return!1;const p=l.split(",");if(p.length>=3){const $=parseFloat(p[0]),W=parseFloat(p[1]),_=parseFloat(p[2].replace("z",""));if(!isNaN($)&&!isNaN(W)&&!isNaN(_)){if(s={center:[W,$],zoom:_},p.length>=4){const K=p[3],k=c.findIndex(J=>J.id===K);k!==-1&&(u(g,k),u(z,k/(c.length-1)*100))}return!0}}return!1};i()||(await new Promise(l=>setTimeout(l,10)),i());const r={},v=[];o.layers.forEach(l=>{r[l.id]={type:"raster",tiles:[`${l.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}}),o.layers.forEach(l=>{v.push({id:`${l.id}-layer`,type:"raster",source:l.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),e=new B.Map({container:a(f),style:{version:8,sources:r,layers:v},...s?{center:s.center,zoom:s.zoom}:{},maxZoom:16,minZoom:5,maxBounds:fe,preserveDrawingBuffer:!0,attributionControl:!1}),e.addControl(new B.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const m={forwardGeocode:async l=>{const p=(l.query??"").trim().toLowerCase();if(t.has(p))return t.get(p);const $=[];try{const _=encodeURIComponent(p);if(!_)return{type:"FeatureCollection",features:$};const K=`https://nominatim.openstreetmap.org/search?q=${_}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,J=await(await fetch(K,{headers:{"Accept-Language":"fr"}})).json(),ze=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const S of J.features??[]){const U=S.properties?.address?.state,Le=S.properties?.address?.county;if(!(U==="Wallonie"||U==="Région wallonne"||ze.some(ne=>Le?.includes(ne)||U?.includes(ne))))continue;const Q=S.bbox,P=Array.isArray(Q)&&Q.length===4?Q.map(Number):void 0;let F;P?F=[P[0]+(P[2]-P[0])/2,P[1]+(P[3]-P[1])/2]:S.geometry?.type==="Point"&&Array.isArray(S.geometry.coordinates)?F=[Number(S.geometry.coordinates[0]),Number(S.geometry.coordinates[1])]:F=[4.4699,50.5039],$.push({type:"Feature",geometry:{type:"Point",coordinates:F},place_name:S.properties?.display_name,properties:{...S.properties,bbox:P},text:S.properties?.display_name,place_type:["place"],center:F,bbox:P})}}catch(_){console.error("forwardGeocode error:",_)}const W={type:"FeatureCollection",features:$};if(t.size>=50){const _=t.keys().next().value;_!==void 0&&t.delete(_)}return t.set(p,W),W}},w=new Me(m,{maplibregl:B,placeholder:"Cherchez une adresse en Wallonie",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});e.addControl(w,"top-left"),e.addControl(new B.NavigationControl,"top-left"),e.on("move",()=>{const l=e.getCenter();if(u(N,{lng:l.lng,lat:l.lat}),u(M,e.getZoom()),typeof window<"u"){const p=c[a(g)]?.id;p?window.location.hash=`${l.lat.toFixed(6)},${l.lng.toFixed(6)},${a(M).toFixed(2)}z,${p}`:window.location.hash=`${l.lat.toFixed(6)},${l.lng.toFixed(6)},${a(M).toFixed(2)}z`}}),e.once("idle",()=>{s||X({animate:!1})});let y=a(f).clientWidth,n=a(f).clientHeight;const d=new ResizeObserver(()=>{const l=a(f).clientWidth,p=a(f).clientHeight;(l!==y||p!==n)&&(y=l,n=p,X({animate:!1}))});d.observe(a(f));let L=null;const x=()=>{L||(L=window.setTimeout(()=>{e&&e.resize(),L=null},250))};return setTimeout(()=>e.resize(),100),window.addEventListener("resize",x),window.addEventListener("orientationchange",x),()=>{R(),d.disconnect(),window.removeEventListener("resize",x),window.removeEventListener("orientationchange",x),e.remove()}}),Be();var q=De(),re=b(q);ke(re,t=>u(f,t),()=>a(f));var H=A(re,2),he=b(H,!0);h(H);var D=A(H,2),we=b(D);Ee(we,{get lat(){return a(N).lat},get lng(){return a(N).lng},get zoom(){return a(M)}}),h(D);var oe=A(D,2),Y=b(oe),Z=b(Y),be=b(Z);{var xe=t=>{var o=Ne();E(t,o)},_e=t=>{var o=qe();E(t,o)};We(be,t=>{a(C)?t(xe):t(_e,!1)})}h(Z),h(Y);var ae=A(Y,2),O=b(ae),Se=b(O);h(O);var se=A(O,2);Fe(se,5,()=>c,Ae,(t,o,s)=>{const i=$e(()=>s/(c.length-1)*100);var r=He();let v;var m=b(r),w=b(m,!0);h(m),h(r),ie(y=>{v=Re(r,1,"year-marker svelte-wish1j",null,v,y),de(r,`left: ${a(i)??""}%`),ce(w,a(o).displayYear)},[()=>({active:s===a(g)})]),le("click",r,()=>ve(s)),E(t,r)}),h(se),h(ae),h(oe),h(q),ie(()=>{ce(he,c[a(g)].displayYear),de(Se,`width: ${a(z)??""}%`)}),le("click",Z,ye),E(G,q),Ce()}var Ze=V('<div class="page-container svelte-lwifl2"><!></div>');function at(G){var I=Ze();Te(e=>{je.title="Travel in Time - Orthophotos Wallonie"});var f=b(I);Ye(f,{}),h(I),E(G,I)}export{at as component};
