import"../chunks/DsnmJJEf.js";import"../chunks/B4sJI0eo.js";import{M as Ce,P as x,D as ue,F as Be,G as pe,O as Me,au as D,J as N,I as O,z as c,Q as C,K as j}from"../chunks/DIJBUjZ_.js";import{o as Te,e as A}from"../chunks/C9FblJra.js";import{s as le}from"../chunks/BjALARFq.js";import{b as ee}from"../chunks/-Mqpy0Mp.js";import{i as Ie}from"../chunks/CyI37tKr.js";import{m as B,M as Le}from"../chunks/vio3IFUB.js";import{o as ce}from"../chunks/C4AmPXCP.js";import{Y as de}from"../chunks/DXKsAlnK.js";var xe=ue('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div></div> <!> <!></div>');function Ae(U,R){Ce(R,!1);let $=x(),Y=x(),M=x(),s,m,_=x(50),w=!1;function Z(e){const a=ce;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${a.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${a.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}const g=ce.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let q=x(g[0].id),F=x(g[g.length-1].id),T={};function fe(e){e.preventDefault(),e.stopPropagation(),w=!0}function me(e){if(!w||!c(M))return;e.preventDefault();const a=c(M).getBoundingClientRect(),f=e.clientX-a.left;C(_,Math.max(0,Math.min(100,f/a.width*100)))}function ye(){w=!1}function ge(e){e.preventDefault(),e.stopPropagation(),w=!0}function ve(e){if(!w||!c(M))return;e.preventDefault();const a=c(M).getBoundingClientRect(),f=e.touches[0].clientX-a.left;C(_,Math.max(0,Math.min(100,f/a.width*100)))}function he(){w=!1}function z(e,a){const f=e.getStyle();if(f?.layers)for(const d of f.layers){if(!d.id.endsWith("-layer"))continue;e.getLayer(d.id)&&e.removeLayer(d.id);const u=d.source;u&&e.getSource(u)&&e.removeSource(u)}a.layers.forEach(d=>{const u=d.id,b=`${d.id}-layer`;e.getSource(u)||e.addSource(u,{type:"raster",tiles:[Z(d)],tileSize:256,maxzoom:20}),e.getLayer(b)||e.addLayer({id:b,type:"raster",source:u,paint:{"raster-opacity":0,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),a.layers.forEach(d=>{const u=`${d.id}-layer`;e.getLayer(u)&&e.moveLayer(u)}),a.layers.forEach(d=>{const u=`${d.id}-layer`;e.setPaintProperty(u,"raster-opacity",1)})}function be(e){if(!s)return;const a=g.find(f=>f.id===e);a&&(z(s,a),C(q,e))}function Ee(e){if(!m)return;const a=g.find(f=>f.id===e);a&&(z(m,a),C(F,e))}Te(()=>{let e=!1;const a=[[4.243,50.764],[4.482,50.913]],f=g.find(r=>r.id===c(q)),d=g.find(r=>r.id===c(F));s=new B.Map({container:c($),style:{version:8,sources:{},layers:[]},bounds:a,fitBoundsOptions:{padding:0},minZoom:10,maxZoom:20,attributionControl:!1}),m=new B.Map({container:c(Y),style:{version:8,sources:{},layers:[]},bounds:a,fitBoundsOptions:{padding:0},minZoom:10,maxZoom:20,interactive:!1,attributionControl:!1}),s.once("load",()=>z(s,f)),m.once("load",()=>z(m,d)),s.addControl(new B.NavigationControl,"bottom-left"),s.addControl(new B.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const u={forwardGeocode:async r=>{const t=[];try{const n=encodeURIComponent((r.query??"").trim());if(!n)return{type:"FeatureCollection",features:t};const p=`https://nominatim.openstreetmap.org/search?q=${n}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,i=await(await fetch(p,{headers:{"Accept-Language":"fr"}})).json();for(const o of i.features??[]){const E=o.properties?.address?.region,k=o.properties?.address?.state;if(!(E?.includes("Bruxelles")||E?.includes("Brussels")||k==="Bruxelles-Capitale"||k==="Brussels Hoofdstedelijk Gewest"||k==="Région de Bruxelles-Capitale"||k==="Brussels-Capital"))continue;const J=o.bbox,h=Array.isArray(J)&&J.length===4?J.map(Number):void 0;let I;if(h)I=[h[0]+(h[2]-h[0])/2,h[1]+(h[3]-h[1])/2];else if(o.geometry?.type==="Point"&&Array.isArray(o.geometry.coordinates))I=[Number(o.geometry.coordinates[0]),Number(o.geometry.coordinates[1])];else{const S=[],ie=l=>{l&&(l.type==="Point"?S.push([+l.coordinates[0],+l.coordinates[1]]):l.type==="LineString"||l.type==="MultiPoint"?l.coordinates.forEach(y=>S.push([+y[0],+y[1]])):l.type==="Polygon"||l.type==="MultiLineString"?l.coordinates.flat(1).forEach(y=>S.push([+y[0],+y[1]])):l.type==="MultiPolygon"?l.coordinates.flat(2).forEach(y=>S.push([+y[0],+y[1]])):l.type==="GeometryCollection"&&(l.geometries||[]).forEach(ie))};if(ie(o.geometry),S.length){const l=S.map(K=>K[0]),y=S.map(K=>K[1]),L=[Math.min(...l),Math.min(...y),Math.max(...l),Math.max(...y)];I=[L[0]+(L[2]-L[0])/2,L[1]+(L[3]-L[1])/2]}else I=[4.3517,50.8503]}t.push({type:"Feature",geometry:{type:"Point",coordinates:I},place_name:o.properties?.display_name,properties:{...o.properties,bbox:h},text:o.properties?.display_name,place_type:["place"],center:I,bbox:h})}}catch(n){console.error("forwardGeocode error:",n)}return{type:"FeatureCollection",features:t}}},b=new Le(u,{maplibregl:B,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:200,minLength:2,showResultMarkers:!1});s.addControl(b,"top-left");const se=r=>{const t=r.bbox??r.properties?.bbox;t&&Array.isArray(t)&&t.length===4?s.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):s.flyTo({center:r.center,zoom:15,duration:1200})};let P=[],v=0;b.on("results",r=>{P=r.features||[],v=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(n=>n.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const r=document.querySelector(".maplibregl-ctrl-geocoder input");r&&r.addEventListener("keydown",t=>{const n=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&P.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const p=P[v];p&&(se(p),t.target.value="",b.clear(),P=[])}else t.key==="ArrowDown"&&n.length>0?(t.preventDefault(),v=Math.min(v+1,P.length-1),n.forEach(p=>p.classList.remove("active")),n[v]&&n[v].classList.add("active")):t.key==="ArrowUp"&&n.length>0&&(t.preventDefault(),v=Math.max(v-1,0),n.forEach(p=>p.classList.remove("active")),n[v]&&n[v].classList.add("active"))},!0)},100),b.on("result",r=>{const t=r.result;se(t),setTimeout(()=>{const n=document.querySelector(".maplibregl-ctrl-geocoder input");n&&(n.value=""),b.clear()},100)});const Se=(r,t)=>{e||(e=!0,t.jumpTo({center:r.getCenter(),zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch()}),requestAnimationFrame(()=>{e=!1}))};s.on("move",()=>{!w&&!e&&(Se(s,m),Object.values(T).forEach(r=>{r.jumpTo({center:s.getCenter(),zoom:s.getZoom(),bearing:s.getBearing(),pitch:s.getPitch()})}))});const ae=()=>{g.forEach(r=>{const t=`before-${r.id}`,n=document.getElementById(`mini-${t}`);if(n&&!T[t])try{const i=new B.Map({container:n,style:{version:8,sources:{},layers:[]},center:s.getCenter(),zoom:s.getZoom(),interactive:!1,attributionControl:!1});i.once("load",()=>{r.layers.forEach(o=>{i.addSource(o.id,{type:"raster",tiles:[Z(o)],tileSize:256,maxzoom:20}),i.addLayer({id:`${o.id}-layer`,type:"raster",source:o.id,paint:{"raster-opacity":1,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),r.layers.forEach(o=>{const E=`${o.id}-layer`;i.getLayer(E)&&i.moveLayer(E)})}),T[t]=i}catch(i){console.error("Error creating before minimap:",t,i)}const p=`after-${r.id}`,Q=document.getElementById(`mini-${p}`);if(Q&&!T[p])try{const i=new B.Map({container:Q,style:{version:8,sources:{},layers:[]},center:m.getCenter(),zoom:m.getZoom(),interactive:!1,attributionControl:!1});i.once("load",()=>{r.layers.forEach(o=>{i.addSource(o.id,{type:"raster",tiles:[Z(o)],tileSize:256,maxzoom:20}),i.addLayer({id:`${o.id}-layer`,type:"raster",source:o.id,paint:{"raster-opacity":1,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),r.layers.forEach(o=>{const E=`${o.id}-layer`;i.getLayer(E)&&i.moveLayer(E)})}),T[p]=i}catch(i){console.error("Error creating after minimap:",p,i)}})};setTimeout(ae,500);const ne=setInterval(()=>{ae()},1e3);setTimeout(()=>clearInterval(ne),1e4);const X=()=>{s&&s.resize(),m&&m.resize()};return setTimeout(X,100),window.addEventListener("resize",X),()=>{clearInterval(ne),window.removeEventListener("resize",X),s.remove(),m.remove(),Object.values(T).forEach(r=>r.remove())}}),Ie();var H=xe();A("mousemove",D,me),A("mouseup",D,ye),A("touchmove",D,ve),A("touchend",D,he);var G=N(H),te=N(G);ee(te,e=>C($,e),()=>c($));var W=O(te,2);ee(W,e=>C(Y,e),()=>c(Y));var V=O(W,2),re=N(V);j(V),j(G),ee(G,e=>C(M,e),()=>c(M));var oe=O(G,2);de(oe,{side:"left",get groups(){return g},get selectedId(){return c(q)},$$events:{select:e=>be(e.detail.id)}});var we=O(oe,2);de(we,{side:"right",get groups(){return g},get selectedId(){return c(F)},$$events:{select:e=>Ee(e.detail.id)}}),j(H),Be(()=>{le(W,`clip-path: inset(0 0 0 ${c(_)??""}%)`),le(V,`left: ${c(_)??""}%`)}),A("mousedown",re,fe),A("touchstart",re,ge),pe(U,H),Me()}var Re=ue('<div class="page-container svelte-1ewpa8p"><!></div>');function Ye(U){var R=Re(),$=N(R);Ae($,{}),j(R),pe(U,R)}export{Ye as component};
