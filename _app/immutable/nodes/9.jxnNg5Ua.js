import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as je,A as ee,B as ue,C as E,J as Ie,F as x,w as s,D as A,K as j,M as f,G as w,an as ye,P as Fe,ao as We}from"../chunks/Ehb9Q6W5.js";import{o as Ae,e as pe,s as fe,h as Ee}from"../chunks/BKIJojkU.js";import{i as Me}from"../chunks/Im4b7-9j.js";import{e as Re,i as ke,s as me}from"../chunks/yJVuIktW.js";import{S as Be,m as B,M as He,s as Ge}from"../chunks/VYvS0YDk.js";import{b as Ne}from"../chunks/m2zDNTuv.js";import{i as qe}from"../chunks/D631TkqT.js";import{o as De}from"../chunks/CUZUMNKG.js";var Ze=ye('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),Ye=ye('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),Oe=ee('<button><span class="year-label svelte-wish1j"> </span></button>'),Ue=ee('<div class="travel-container svelte-wish1j"><div class="map-container svelte-wish1j"></div> <div class="year-overlay svelte-wish1j"> </div> <div class="share-wrapper-traveltime svelte-wish1j"><!></div> <div class="playbar svelte-wish1j"><div class="playbar-controls svelte-wish1j"><button class="playbar-btn svelte-wish1j"><!></button></div> <div class="timeline svelte-wish1j"><div class="timeline-track svelte-wish1j"><div class="timeline-progress svelte-wish1j"></div></div> <div class="timeline-years svelte-wish1j"></div></div></div></div>');function Ke(H,I){je(I,!1);let y=j(),e,T=j(!1),h=j(0),F=null,S=j(0),G=j({lng:4.5,lat:50.5}),te=j(8);const ge=[[2.75,49.45],[6.5,50.85]],he=[[2,49],[7.2,51.3]];function ve(t){const o=t.clientWidth||window.innerWidth,a=t.clientHeight||window.innerHeight,i=Math.round(Math.max(12,Math.min(o,a)*.03)),r=o<768,v=r?120:80;return{top:i+(r?30:40),right:i+10,bottom:i+v,left:i+10}}function re(t){if(!e||!s(y))return;const o=ve(s(y));e.resize();const a=s(y).clientWidth||window.innerWidth,i=a<640?5.5:a<1024?6:a<1300?6.5:7;e.setMinZoom(i);const r={top:o.top-50,right:o.right-50,bottom:o.bottom-50,left:o.left-50};e.fitBounds(ge,{padding:r,duration:t?.animate?400:0})}const l=De.orthophotos.reduce((t,o)=>{const a=o.year.split(" ")[0],i=t.find(r=>r.year===a);return i?i.layers.push(o):t.push({year:a,displayYear:a,layers:[o]}),t},[]).map(t=>({...t,layers:t.layers.slice().sort((o,a)=>{const i=r=>/Printemps/i.test(r)?0:/Été|Ete/i.test(r)?1:2;return i(o.year)-i(a.year)})}));function oe(){if(!e)return;const t=(s(h)+1)%l.length;l[t].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[`${r.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})});const a=(s(h)-1+l.length)%l.length;l[a].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[`${r.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function we(){s(T)?M():be()}function be(){if(!e)return;f(T,!0),oe();const t=Date.now(),o=s(S)/100*(l.length-1),a=2500,i=1300,r=()=>{if(!s(T))return;const g=(Date.now()-t)/a,b=o+g;if(b>=l.length-1){f(h,l.length-1),f(S,100),M();return}const m=Math.floor(b);f(S,b/(l.length-1)*100),m!==s(h)&&(f(h,m),ae(i),oe()),F=window.requestAnimationFrame(r)};F=window.requestAnimationFrame(r)}function M(){f(T,!1),F&&(cancelAnimationFrame(F),F=null);const t=Math.floor(s(S)/100*(l.length-1));t>=0&&t<l.length&&f(h,t)}let N=null;function xe(t){s(T)&&M();const a=t/(l.length-1)*100,i=s(S),r=Date.now(),v=300,g=()=>{const b=Date.now()-r,m=Math.min(b/v,1),n=1-Math.pow(1-m,3);f(S,i+(a-i)*n),m<1?requestAnimationFrame(g):f(S,a)};f(h,t),ae(),g(),N&&N(!0)}function ae(t=0){if(!e)return;const o=l[s(h)],a=e.getStyle();if(a?.layers)for(const n of a.layers){if(!n.id.endsWith("-layer"))continue;!o.layers.some(P=>`${P.id}-layer`===n.id)&&e.getLayer(n.id)&&(e.setPaintProperty(n.id,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(n.id,"raster-opacity",0))}o.layers.forEach(n=>{const d=n.id,P=`${n.id}-layer`;e.getSource(d)||e.addSource(d,{type:"raster",tiles:[`${n.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(P)||e.addLayer({id:P,type:"raster",source:d,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),o.layers.forEach(n=>{const d=`${n.id}-layer`;e.getLayer(d)&&e.moveLayer(d)});const i=o.layers.map(n=>`${n.id}-layer`);let r=0;const v=i.length,g=()=>{i.forEach(n=>{e.getLayer(n)&&(e.setPaintProperty(n,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(n,"raster-opacity",1))})},b=()=>{r++,r>=v&&g()},m=n=>{n.isSourceLoaded&&n.sourceId&&o.layers.some(d=>d.id===n.sourceId)&&b()};e.on("sourcedata",m),setTimeout(()=>{e.off("sourcedata",m),g()},t>0?t+1e3:1e3),t>0&&setTimeout(()=>{const n=e?.getStyle();if(n?.layers)for(const d of n.layers){if(!d.id.endsWith("-layer"))continue;if(!o.layers.some(C=>`${C.id}-layer`===d.id)){e.getLayer(d.id)&&e.removeLayer(d.id);const C=d.source;C&&e.getSource(C)&&e.removeSource(C)}}},t+100)}Ae(async()=>{const t=new Map,o=l[0];let a=null;const i=()=>{if(typeof window>"u")return!1;const c=window.location.hash.slice(1);if(!c)return!1;const u=c.split(",");if(u.length>=3){const z=parseFloat(u[0]),$=parseFloat(u[1]),p=parseFloat(u[2].replace("z",""));if(!isNaN(z)&&!isNaN($)&&!isNaN(p)){if(a={center:[$,z],zoom:p},u.length>=4){const J=u[3],k=l.findIndex(Q=>Q.id===J);k!==-1&&(f(h,k),f(S,k/(l.length-1)*100))}return!0}}return!1};i()||(await new Promise(c=>setTimeout(c,10)),i());const r={},v=[];o.layers.forEach(c=>{r[c.id]={type:"raster",tiles:[`${c.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}}),o.layers.forEach(c=>{v.push({id:`${c.id}-layer`,type:"raster",source:c.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),e=new B.Map({container:s(y),style:{version:8,sources:r,layers:v},...a?{center:a.center,zoom:a.zoom}:{},maxZoom:16,minZoom:5,maxBounds:he,preserveDrawingBuffer:!0,attributionControl:!1}),e.addControl(new B.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const g={forwardGeocode:async c=>{const u=(c.query??"").trim().toLowerCase();if(t.has(u))return t.get(u);const z=[];try{const p=encodeURIComponent(u);if(!p)return{type:"FeatureCollection",features:z};const J=`https://nominatim.openstreetmap.org/search?q=${p}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,Q=await(await fetch(J,{headers:{"Accept-Language":"fr"}})).json(),$e=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const _ of Q.features??[]){const V=_.properties?.address?.state,Te=_.properties?.address?.county;if(!(V==="Wallonie"||V==="Région wallonne"||$e.some(de=>Te?.includes(de)||V?.includes(de))))continue;const X=_.bbox,L=Array.isArray(X)&&X.length===4?X.map(Number):void 0;let W;L?W=[L[0]+(L[2]-L[0])/2,L[1]+(L[3]-L[1])/2]:_.geometry?.type==="Point"&&Array.isArray(_.geometry.coordinates)?W=[Number(_.geometry.coordinates[0]),Number(_.geometry.coordinates[1])]:W=[4.4699,50.5039],z.push({type:"Feature",geometry:{type:"Point",coordinates:W},place_name:_.properties?.display_name,properties:{..._.properties,bbox:L},text:_.properties?.display_name,place_type:["place"],center:W,bbox:L})}}catch(p){console.error("forwardGeocode error:",p)}const $={type:"FeatureCollection",features:z};if(t.size>=50){const p=t.keys().next().value;p!==void 0&&t.delete(p)}return t.set(u,$),$}},b=new He(g,{maplibregl:B,placeholder:"Cherchez une adresse en Wallonie",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});e.addControl(b,"top-left"),e.addControl(new B.NavigationControl,"top-left");let m=null,n="";const d=(c=!1)=>{if(typeof window>"u"||!e)return;const u=e.getCenter(),z=e.getZoom(),$=l[s(h)]?.id,p=$?`${u.lat.toFixed(6)},${u.lng.toFixed(6)},${z.toFixed(2)}z,${$}`:`${u.lat.toFixed(6)},${u.lng.toFixed(6)},${z.toFixed(2)}z`;p!==n&&(n=p,c?window.location.hash=p:history.replaceState(null,"",`#${p}`))};N=d,e.on("move",()=>{const c=e.getCenter();f(G,{lng:c.lng,lat:c.lat}),f(te,e.getZoom()),d(!1),m&&clearTimeout(m),m=window.setTimeout(()=>{d(!0)},1e3)}),e.once("idle",()=>{a||re({animate:!1})});let P=s(y).clientWidth,C=s(y).clientHeight;const ce=new ResizeObserver(()=>{const c=s(y).clientWidth,u=s(y).clientHeight;(c!==P||u!==C)&&(P=c,C=u,re({animate:!1}))});ce.observe(s(y));let K=null;const R=()=>{K||(K=window.setTimeout(()=>{e&&e.resize(),K=null},250))};return setTimeout(()=>e.resize(),100),window.addEventListener("resize",R),window.addEventListener("orientationchange",R),()=>{M(),ce.disconnect(),window.removeEventListener("resize",R),window.removeEventListener("orientationchange",R),e.remove()}}),qe();var q=Ue(),se=x(q);Ne(se,t=>f(y,t),()=>s(y));var D=A(se,2),_e=x(D,!0);w(D);var Z=A(D,2),Se=x(Z);Be(Se,{get lat(){return s(G).lat},get lng(){return s(G).lng},get zoom(){return s(te)}}),w(Z);var ne=A(Z,2),Y=x(ne),O=x(Y),ze=x(O);{var Le=t=>{var o=Ze();E(t,o)},Pe=t=>{var o=Ye();E(t,o)};Me(ze,t=>{s(T)?t(Le):t(Pe,!1)})}w(O),w(Y);var ie=A(Y,2),U=x(ie),Ce=x(U);w(U);var le=A(U,2);Re(le,5,()=>l,ke,(t,o,a)=>{const i=Fe(()=>a/(l.length-1)*100);var r=Oe();let v;var g=x(r),b=x(g,!0);w(g),w(r),ue(m=>{v=Ge(r,1,"year-marker svelte-wish1j",null,v,m),me(r,`left: ${s(i)??""}%`),fe(b,s(o).displayYear)},[()=>({active:a===s(h)})]),pe("click",r,()=>xe(a)),E(t,r)}),w(le),w(ie),w(ne),w(q),ue(()=>{fe(_e,l[s(h)].displayYear),me(Ce,`width: ${s(S)??""}%`)}),pe("click",O,we),E(H,q),Ie()}var Je=ee('<div class="page-container svelte-lwifl2"><!></div>');function lt(H){var I=Je();Ee(e=>{We.title="Travel in Time - Orthophotos Wallonie"});var y=x(I);Ke(y,{}),w(I),E(H,I)}export{lt as component};
