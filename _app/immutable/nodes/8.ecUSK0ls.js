import"../chunks/DsnmJJEf.js";import"../chunks/B4sJI0eo.js";import{M as Le,P as z,D as ce,F as Ce,G as de,O as Ee,au as k,J as W,I as G,z as m,Q as C,K as Z,aw as Me}from"../chunks/DIJBUjZ_.js";import{h as Se}from"../chunks/CAC4D6zA.js";import{o as $e,e as P}from"../chunks/C9FblJra.js";import{s as ie}from"../chunks/BjALARFq.js";import{b as V}from"../chunks/-Mqpy0Mp.js";import{i as Ie}from"../chunks/CyI37tKr.js";import{m as E,M as ze}from"../chunks/vio3IFUB.js";import{o as Pe}from"../chunks/CUZUMNKG.js";import{Y as le}from"../chunks/DXKsAlnK.js";var Te=ce('<div class="timelapse-container svelte-qt8w5r"><div class="map-wrapper svelte-qt8w5r"><div class="map-container before svelte-qt8w5r"></div> <div class="map-container after svelte-qt8w5r"></div> <div class="compare-slider svelte-qt8w5r"><div class="slider-handle svelte-qt8w5r" role="button" tabindex="0"><span class="slider-arrows svelte-qt8w5r">◄ ►</span></div></div></div> <!> <!></div>');function _e(j,T){Le(T,!1);let _=z(),A=z(),M=z(),a,y,R=z(50),L=!1;const v=Pe.orthophotos.reduce((e,o)=>{const i=o.year.split(" ")[0],s=e.find(l=>l.year===i);return s?s.layers.push(o):e.push({id:i,year:i,displayYear:i,layers:[o]}),e},[]).map(e=>({...e,layers:e.layers.slice().sort((o,i)=>{const s=l=>/Printemps/i.test(l)?0:/Été|Ete/i.test(l)?1:2;return s(o.year)-s(i.year)})}));let O=z(v[0].id),Y=z(v[v.length-1].id),S={};function ue(e){e.preventDefault(),e.stopPropagation(),L=!0}function pe(e){if(!L||!m(M))return;e.preventDefault();const o=m(M).getBoundingClientRect(),i=e.clientX-o.left;C(R,Math.max(0,Math.min(100,i/o.width*100)))}function me(){L=!1}function fe(e){e.preventDefault(),e.stopPropagation(),L=!0}function ye(e){if(!L||!m(M))return;e.preventDefault();const o=m(M).getBoundingClientRect(),i=e.touches[0].clientX-o.left;C(R,Math.max(0,Math.min(100,i/o.width*100)))}function ge(){L=!1}function B(e,o){const i=e.getStyle();if(i?.layers)for(const s of i.layers){if(!s.id.endsWith("-layer"))continue;e.getLayer(s.id)&&e.removeLayer(s.id);const l=s.source;l&&e.getSource(l)&&e.removeSource(l)}o.layers.forEach(s=>{const l=s.id,x=`${s.id}-layer`;e.getSource(l)||e.addSource(l,{type:"raster",tiles:[`${s.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(x)||e.addLayer({id:x,type:"raster",source:l,paint:{"raster-opacity":0,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),o.layers.forEach(s=>{const l=`${s.id}-layer`;e.getLayer(l)&&e.moveLayer(l)}),o.layers.forEach(s=>{const l=`${s.id}-layer`;e.setPaintProperty(l,"raster-opacity",1)})}function ve(e){if(!a)return;const o=v.find(i=>i.id===e);o&&(B(a,o),C(O,e))}function he(e){if(!y)return;const o=v.find(i=>i.id===e);o&&(B(y,o),C(Y,e))}$e(()=>{let e=!1;const o=[[2.75,49.45],[6.5,50.85]],i=v.find(r=>r.id===m(O)),s=v.find(r=>r.id===m(Y));a=new E.Map({container:m(_),style:{version:8,sources:{},layers:[]},bounds:o,fitBoundsOptions:{padding:0},minZoom:8,maxZoom:17,attributionControl:!1}),y=new E.Map({container:m(A),style:{version:8,sources:{},layers:[]},bounds:o,fitBoundsOptions:{padding:0},minZoom:8,maxZoom:17,interactive:!1,attributionControl:!1}),a.once("load",()=>B(a,i)),y.once("load",()=>B(y,s)),a.addControl(new E.NavigationControl,"bottom-left"),a.addControl(new E.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const l={forwardGeocode:async r=>{const t=[];try{const n=encodeURIComponent((r.query??"").trim());if(!n)return{type:"FeatureCollection",features:t};const f=`https://nominatim.openstreetmap.org/search?q=${n}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,c=await(await fetch(f,{headers:{"Accept-Language":"fr"}})).json(),p=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const d of c.features??[]){const J=d.properties?.address?.state,xe=d.properties?.address?.county;if(!(J==="Wallonie"||J==="Région wallonne"||p.some(b=>xe?.includes(b)||J?.includes(b))))continue;const K=d.bbox,w=Array.isArray(K)&&K.length===4?K.map(Number):void 0;let $;if(w)$=[w[0]+(w[2]-w[0])/2,w[1]+(w[3]-w[1])/2];else if(d.geometry?.type==="Point"&&Array.isArray(d.geometry.coordinates))$=[Number(d.geometry.coordinates[0]),Number(d.geometry.coordinates[1])];else{const b=[],se=u=>{u&&(u.type==="Point"?b.push([+u.coordinates[0],+u.coordinates[1]]):u.type==="LineString"||u.type==="MultiPoint"?u.coordinates.forEach(g=>b.push([+g[0],+g[1]])):u.type==="Polygon"||u.type==="MultiLineString"?u.coordinates.flat(1).forEach(g=>b.push([+g[0],+g[1]])):u.type==="MultiPolygon"?u.coordinates.flat(2).forEach(g=>b.push([+g[0],+g[1]])):u.type==="GeometryCollection"&&(u.geometries||[]).forEach(se))};if(se(d.geometry),b.length){const u=b.map(Q=>Q[0]),g=b.map(Q=>Q[1]),I=[Math.min(...u),Math.min(...g),Math.max(...u),Math.max(...g)];$=[I[0]+(I[2]-I[0])/2,I[1]+(I[3]-I[1])/2]}else $=[4.4699,50.5039]}t.push({type:"Feature",geometry:{type:"Point",coordinates:$},place_name:d.properties?.display_name,properties:{...d.properties,bbox:w},text:d.properties?.display_name,place_type:["place"],center:$,bbox:w})}}catch(n){console.error("forwardGeocode error:",n)}return{type:"FeatureCollection",features:t}}},x=new ze(l,{maplibregl:E,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:200,minLength:2,showResultMarkers:!1});a.addControl(x,"top-left");const oe=r=>{const t=r.bbox??r.properties?.bbox;t&&Array.isArray(t)&&t.length===4?a.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):a.flyTo({center:r.center,zoom:15,duration:1200})};let q=[],h=0;x.on("results",r=>{q=r.features||[],h=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(n=>n.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const r=document.querySelector(".maplibregl-ctrl-geocoder input");r&&r.addEventListener("keydown",t=>{const n=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&q.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const f=q[h];f&&(oe(f),t.target.value="",x.clear(),q=[])}else t.key==="ArrowDown"&&n.length>0?(t.preventDefault(),h=Math.min(h+1,q.length-1),n.forEach(f=>f.classList.remove("active")),n[h]&&n[h].classList.add("active")):t.key==="ArrowUp"&&n.length>0&&(t.preventDefault(),h=Math.max(h-1,0),n.forEach(f=>f.classList.remove("active")),n[h]&&n[h].classList.add("active"))},!0)},100),x.on("result",r=>{const t=r.result;oe(t),setTimeout(()=>{const n=document.querySelector(".maplibregl-ctrl-geocoder input");n&&(n.value=""),x.clear()},100)});const we=(r,t)=>{e||(e=!0,t.jumpTo({center:r.getCenter(),zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch()}),requestAnimationFrame(()=>{e=!1}))};a.on("move",()=>{!L&&!e&&(we(a,y),Object.values(S).forEach(r=>{r.jumpTo({center:a.getCenter(),zoom:a.getZoom(),bearing:a.getBearing(),pitch:a.getPitch()})}))});const ae=()=>{v.forEach(r=>{const t=`before-${r.id}`,n=document.getElementById(`mini-${t}`);if(n&&!S[t])try{const c=new E.Map({container:n,style:{version:8,sources:{},layers:[]},center:a.getCenter(),zoom:a.getZoom(),interactive:!1,attributionControl:!1});c.once("load",()=>{r.layers.forEach(p=>{c.addSource(p.id,{type:"raster",tiles:[`${p.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),c.addLayer({id:`${p.id}-layer`,type:"raster",source:p.id,paint:{"raster-opacity":1,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),r.layers.forEach(p=>{const d=`${p.id}-layer`;c.getLayer(d)&&c.moveLayer(d)})}),S[t]=c}catch(c){console.error("Error creating before minimap:",t,c)}const f=`after-${r.id}`,H=document.getElementById(`mini-${f}`);if(H&&!S[f])try{const c=new E.Map({container:H,style:{version:8,sources:{},layers:[]},center:y.getCenter(),zoom:y.getZoom(),interactive:!1,attributionControl:!1});c.once("load",()=>{r.layers.forEach(p=>{c.addSource(p.id,{type:"raster",tiles:[`${p.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),c.addLayer({id:`${p.id}-layer`,type:"raster",source:p.id,paint:{"raster-opacity":1,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),r.layers.forEach(p=>{const d=`${p.id}-layer`;c.getLayer(d)&&c.moveLayer(d)})}),S[f]=c}catch(c){console.error("Error creating after minimap:",f,c)}})};setTimeout(ae,500);const ne=setInterval(()=>{ae()},1e3);setTimeout(()=>clearInterval(ne),1e4);const X=()=>{a&&a.resize(),y&&y.resize()};return setTimeout(X,100),window.addEventListener("resize",X),()=>{clearInterval(ne),window.removeEventListener("resize",X),a.remove(),y.remove(),Object.values(S).forEach(r=>r.remove())}}),Ie();var F=Te();P("mousemove",k,pe),P("mouseup",k,me),P("touchmove",k,ye),P("touchend",k,ge);var D=W(F),ee=W(D);V(ee,e=>C(_,e),()=>m(_));var N=G(ee,2);V(N,e=>C(A,e),()=>m(A));var U=G(N,2),te=W(U);Z(U),Z(D),V(D,e=>C(M,e),()=>m(M));var re=G(D,2);le(re,{side:"left",get groups(){return v},get selectedId(){return m(O)},$$events:{select:e=>ve(e.detail.id)}});var be=G(re,2);le(be,{side:"right",get groups(){return v},get selectedId(){return m(Y)},$$events:{select:e=>he(e.detail.id)}}),Z(F),Ce(()=>{ie(N,`clip-path: inset(0 0 0 ${m(R)??""}%)`),ie(U,`left: ${m(R)??""}%`)}),P("mousedown",te,ue),P("touchstart",te,fe),de(j,F),Ee()}var qe=ce('<div class="page-container svelte-q4ucql"><!></div>');function Ne(j){var T=qe();Se(A=>{Me.title="Timelapse - Comparaison d'orthophotos"});var _=W(T);_e(_,{}),Z(T),de(j,T)}export{Ne as component};
