import"../chunks/DsnmJJEf.js";import"../chunks/C1X7ZH2G.js";import{I as Me,K as w,A as pe,B as Le,C as me,J as Re,au as O,F as U,D as _,w as s,M as g,G as Z}from"../chunks/sZzwH-X8.js";import{o as Ie,e as M}from"../chunks/DPlkaXRH.js";import{s as de}from"../chunks/B_ypSufT.js";import{b as re}from"../chunks/DlGDAnrT.js";import{i as ze}from"../chunks/B2bDIl6U.js";import{S as Pe,m as $,M as _e}from"../chunks/vupgCqCY.js";import{o as ue}from"../chunks/C4AmPXCP.js";import{Y as fe}from"../chunks/BeJWcgwJ.js";var $e=pe('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div> <!></div> <!> <!></div>');function Ge(H,L){Me(L,!1);let R=w(),W=w(),C=w(),a,v,G=w(50),S=!1,j=w({lng:4.35,lat:50.85}),V=w(11);function ge(e){const r=ue;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${r.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${r.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}const f=ue.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let B=w(f[0].id),x=w(f[f.length-1].id);function ye(e){e.preventDefault(),e.stopPropagation(),S=!0}function he(e){if(!S||!s(C))return;e.preventDefault();const r=s(C).getBoundingClientRect(),i=e.clientX-r.left;g(G,Math.max(0,Math.min(100,i/r.width*100)))}function ve(){S=!1}function be(e){e.preventDefault(),e.stopPropagation(),S=!0}function we(e){if(!S||!s(C))return;e.preventDefault();const r=s(C).getBoundingClientRect(),i=e.touches[0].clientX-r.left;g(G,Math.max(0,Math.min(100,i/r.width*100)))}function Se(){S=!1}function N(e,r){const i=e.getStyle();if(i?.layers)for(const c of i.layers){if(!c.id.endsWith("-layer"))continue;e.getLayer(c.id)&&e.removeLayer(c.id);const d=c.source;d&&e.getSource(d)&&e.removeSource(d)}r.layers.forEach(c=>{const d=c.id,F=`${c.id}-layer`;e.getSource(d)||e.addSource(d,{type:"raster",tiles:[ge(c)],tileSize:256,maxzoom:20}),e.getLayer(F)||e.addLayer({id:F,type:"raster",source:d,paint:{"raster-opacity":0,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),r.layers.forEach(c=>{const d=`${c.id}-layer`;e.getLayer(d)&&e.moveLayer(d)}),r.layers.forEach(c=>{const d=`${c.id}-layer`;e.setPaintProperty(d,"raster-opacity",1)})}function Ee(e){if(!a)return;const r=f.find(i=>i.id===e);r&&(N(a,r),g(B,e))}function Ce(e){if(!v)return;const r=f.find(i=>i.id===e);r&&(N(v,r),g(x,e))}Ie(()=>{let e=null;if(typeof window<"u"&&window.location.hash){const t=window.location.hash.slice(1).split(",");if(t.length>=3){const n=parseFloat(t[0]),u=parseFloat(t[1]),h=parseFloat(t[2].replace("z",""));if(!isNaN(n)&&!isNaN(u)&&!isNaN(h)&&(e={center:[u,n],zoom:h}),t.length>=5){const Y=t[3],ee=t[4];f.find(P=>P.id===Y)&&g(B,Y),f.find(P=>P.id===ee)&&g(x,ee)}}}let r=!1;const i=new Map,c=[[4.243,50.764],[4.482,50.913]],d=f.find(o=>o.id===s(B)),F=f.find(o=>o.id===s(x));a=new $.Map({container:s(R),style:{version:8,sources:{},layers:[]},...e?{center:e.center,zoom:e.zoom}:{bounds:c,fitBoundsOptions:{padding:0}},minZoom:10,maxZoom:20,attributionControl:!1}),v=new $.Map({container:s(W),style:{version:8,sources:{},layers:[]},...e?{center:e.center,zoom:e.zoom}:{bounds:c,fitBoundsOptions:{padding:0}},minZoom:10,maxZoom:20,interactive:!1,attributionControl:!1}),a.once("load",()=>N(a,d)),v.once("load",()=>N(v,F)),a.addControl(new $.NavigationControl,"bottom-left"),a.addControl(new $.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const Te={forwardGeocode:async o=>{const t=(o.query??"").trim().toLowerCase();if(i.has(t))return i.get(t);const n=[];try{const h=encodeURIComponent(t);if(!h)return{type:"FeatureCollection",features:n};const Y=`https://nominatim.openstreetmap.org/search?q=${h}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,P=await(await fetch(Y,{headers:{"Accept-Language":"fr"}})).json();for(const p of P.features??[]){const le=p.properties?.address?.region,q=p.properties?.address?.state;if(!(le?.includes("Bruxelles")||le?.includes("Brussels")||q==="Bruxelles-Capitale"||q==="Brussels Hoofdstedelijk Gewest"||q==="Région de Bruxelles-Capitale"||q==="Brussels-Capital"))continue;const te=p.bbox,b=Array.isArray(te)&&te.length===4?te.map(Number):void 0;let T;if(b)T=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2];else if(p.geometry?.type==="Point"&&Array.isArray(p.geometry.coordinates))T=[Number(p.geometry.coordinates[0]),Number(p.geometry.coordinates[1])];else{const E=[],ce=l=>{l&&(l.type==="Point"?E.push([+l.coordinates[0],+l.coordinates[1]]):l.type==="LineString"||l.type==="MultiPoint"?l.coordinates.forEach(m=>E.push([+m[0],+m[1]])):l.type==="Polygon"||l.type==="MultiLineString"?l.coordinates.flat(1).forEach(m=>E.push([+m[0],+m[1]])):l.type==="MultiPolygon"?l.coordinates.flat(2).forEach(m=>E.push([+m[0],+m[1]])):l.type==="GeometryCollection"&&(l.geometries||[]).forEach(ce))};if(ce(p.geometry),E.length){const l=E.map(oe=>oe[0]),m=E.map(oe=>oe[1]),A=[Math.min(...l),Math.min(...m),Math.max(...l),Math.max(...m)];T=[A[0]+(A[2]-A[0])/2,A[1]+(A[3]-A[1])/2]}else T=[4.3517,50.8503]}n.push({type:"Feature",geometry:{type:"Point",coordinates:T},place_name:p.properties?.display_name,properties:{...p.properties,bbox:b},text:p.properties?.display_name,place_type:["place"],center:T,bbox:b})}}catch(h){console.error("forwardGeocode error:",h)}const u={type:"FeatureCollection",features:n};if(i.size>=50){const h=i.keys().next().value;h!==void 0&&i.delete(h)}return i.set(t,u),u}},I=new _e(Te,{maplibregl:$,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});a.addControl(I,"top-left");const ie=o=>{const t=o.bbox??o.properties?.bbox;t&&Array.isArray(t)&&t.length===4?a.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):a.flyTo({center:o.center,zoom:15,duration:1200})};let z=[],y=0;I.on("results",o=>{z=o.features||[],y=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(n=>n.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&o.addEventListener("keydown",t=>{const n=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&z.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const u=z[y];u&&(ie(u),t.target.value="",I.clear(),z=[])}else t.key==="ArrowDown"&&n.length>0?(t.preventDefault(),y=Math.min(y+1,z.length-1),n.forEach(u=>u.classList.remove("active")),n[y]&&n[y].classList.add("active")):t.key==="ArrowUp"&&n.length>0&&(t.preventDefault(),y=Math.max(y-1,0),n.forEach(u=>u.classList.remove("active")),n[y]&&n[y].classList.add("active"))},!0)},100),I.on("result",o=>{const t=o.result;ie(t),setTimeout(()=>{const n=document.querySelector(".maplibregl-ctrl-geocoder input");n&&(n.value=""),I.clear()},100)});const Ae=(o,t)=>{r||(r=!0,t.jumpTo({center:o.getCenter(),zoom:o.getZoom(),bearing:o.getBearing(),pitch:o.getPitch()}),requestAnimationFrame(()=>{r=!1}))};a.on("move",()=>{!S&&!r&&Ae(a,v);const o=a.getCenter();g(j,{lng:o.lng,lat:o.lat}),g(V,a.getZoom()),typeof window<"u"&&(window.location.hash=`${o.lat.toFixed(6)},${o.lng.toFixed(6)},${s(V).toFixed(2)}z,${s(B)},${s(x)}`)});let Q=null;const J=()=>{Q||(Q=window.setTimeout(()=>{a&&a.resize(),v&&v.resize(),Q=null},250))};return setTimeout(J,100),window.addEventListener("resize",J),()=>{window.removeEventListener("resize",J),a.remove(),v.remove()}}),ze();var X=$e();M("mousemove",O,he),M("mouseup",O,ve),M("touchmove",O,we),M("touchend",O,Se);var k=U(X),se=U(k);re(se,e=>g(R,e),()=>s(R));var K=_(se,2);re(K,e=>g(W,e),()=>s(W));var D=_(K,2),ne=U(D);Z(D);var Be=_(D,2);Pe(Be,{get lat(){return s(j).lat},get lng(){return s(j).lng},get zoom(){return s(V)},get yearBefore(){return s(B)},get yearAfter(){return s(x)}}),Z(k),re(k,e=>g(C,e),()=>s(C));var ae=_(k,2);fe(ae,{side:"left",get groups(){return f},get selectedId(){return s(B)},$$events:{select:e=>Ee(e.detail.id)}});var xe=_(ae,2);fe(xe,{side:"right",get groups(){return f},get selectedId(){return s(x)},$$events:{select:e=>Ce(e.detail.id)}}),Z(X),Le(()=>{de(K,`clip-path: inset(0 0 0 ${s(G)??""}%)`),de(D,`left: ${s(G)??""}%`)}),M("mousedown",ne,ye),M("touchstart",ne,be),me(H,X),Re()}var Ne=pe('<div class="page-container svelte-1ewpa8p"><!></div>');function Ve(H){var L=Ne(),R=U(L);Ge(R,{}),Z(L),me(H,L)}export{Ve as component};
