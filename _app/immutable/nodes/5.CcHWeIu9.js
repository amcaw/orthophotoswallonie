import"../chunks/DsnmJJEf.js";import"../chunks/Cflq-a96.js";import{as as ye,D as B,F as K,G as S,at as fe,J as v,I as z,z as i,a6 as $,R as m,K as y,au as X,W as ge,av as ve}from"../chunks/Dlg-gMpp.js";import{h as he}from"../chunks/IuQqTbrd.js";import{o as we,e as U,s as Q}from"../chunks/COQ8bC4V.js";import{i as be}from"../chunks/B6TdcFSY.js";import{e as xe,i as _e,s as V}from"../chunks/DXLIkSof.js";import{o as Pe,m as I,M as Le,s as We}from"../chunks/B22aiAXe.js";import{b as Se}from"../chunks/5YV8zeCu.js";import{i as Ce}from"../chunks/DMWEl-21.js";var je=X('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),ze=X('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),$e=B('<button><span class="year-label svelte-wish1j"> </span></button>'),Ie=B('<div class="travel-container svelte-wish1j"><div class="map-container svelte-wish1j"></div> <div class="year-overlay svelte-wish1j"> </div> <div class="playbar svelte-wish1j"><div class="playbar-controls svelte-wish1j"><button class="playbar-btn svelte-wish1j"><!></button></div> <div class="timeline svelte-wish1j"><div class="timeline-track svelte-wish1j"><div class="timeline-progress svelte-wish1j"></div></div> <div class="timeline-years svelte-wish1j"></div></div></div></div>');function Te(T,P){ye(P,!1);let c=$(),a,_=$(!1),h=$(0),L=null,x=$(0);const ee=[[2.75,49.45],[6.5,50.85]];function te(e){const s=e.clientWidth||window.innerWidth,o=e.clientHeight||window.innerHeight,r=Math.round(Math.max(12,Math.min(s,o)*.03)),t=s<768,l=t?120:80;return{top:r+(t?30:40),right:r+10,bottom:r+l,left:r+10}}function E(e){if(!a||!i(c))return;const s=te(i(c));a.resize();const o=i(c).clientWidth||window.innerWidth,r=o<640?6.5:o<1024?7:o<1300?7.5:8;a.setMinZoom(r),a.fitBounds(ee,{padding:s,duration:e?.animate?400:0})}const p=Pe.orthophotos.reduce((e,s)=>{const o=s.year.split(" ")[0],r=e.find(t=>t.year===o);return r?r.layers.push(s):e.push({year:o,displayYear:o,layers:[s]}),e},[]).map(e=>({...e,layers:e.layers.slice().sort((s,o)=>{const r=t=>/Printemps/i.test(t)?0:/Été|Ete/i.test(t)?1:2;return r(s.year)-r(o.year)})}));function q(){if(!a)return;const e=(i(h)+1)%p.length;p[e].layers.forEach(o=>{a.getSource(o.id)||a.addSource(o.id,{type:"raster",tiles:[`${o.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),a.getLayer(`${o.id}-layer`)||a.addLayer({id:`${o.id}-layer`,type:"raster",source:o.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function re(){i(_)?C():ae()}function ae(){if(!a)return;m(_,!0),q();const e=Date.now(),s=i(x)/100*(p.length-1),o=2500,r=1300,t=()=>{if(!i(_))return;const n=(Date.now()-e)/o,f=s+n;if(f>=p.length-1){m(h,p.length-1),m(x,100),C();return}const u=Math.floor(f);m(x,f/(p.length-1)*100),u!==i(h)&&(m(h,u),D(r),q()),L=window.requestAnimationFrame(t)};L=window.requestAnimationFrame(t)}function C(){m(_,!1),L&&(cancelAnimationFrame(L),L=null);const e=Math.floor(i(x)/100*(p.length-1));e>=0&&e<p.length&&m(h,e)}function oe(e){i(_)&&C();const o=e/(p.length-1)*100,r=i(x),t=Date.now(),l=300,n=()=>{const f=Date.now()-t,u=Math.min(f/l,1),d=1-Math.pow(1-u,3);m(x,r+(o-r)*d),u<1?requestAnimationFrame(n):m(x,o)};m(h,e),D(),n()}function D(e=0){if(!a)return;const s=p[i(h)],o=a.getStyle();if(o?.layers)for(const r of o.layers){if(!r.id.endsWith("-layer"))continue;!s.layers.some(l=>`${l.id}-layer`===r.id)&&a.getLayer(r.id)&&(a.setPaintProperty(r.id,"raster-opacity-transition",{duration:e,delay:0}),a.setPaintProperty(r.id,"raster-opacity",0))}s.layers.forEach(r=>{const t=r.id,l=`${r.id}-layer`;a.getSource(t)||a.addSource(t,{type:"raster",tiles:[`${r.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),a.getLayer(l)||a.addLayer({id:l,type:"raster",source:t,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),s.layers.forEach(r=>{const t=`${r.id}-layer`;a.getLayer(t)&&a.moveLayer(t)}),s.layers.forEach(r=>{const t=`${r.id}-layer`;a.getLayer(t)&&(a.setPaintProperty(t,"raster-opacity-transition",{duration:e,delay:0}),a.setPaintProperty(t,"raster-opacity",1))}),e>0&&setTimeout(()=>{const r=a?.getStyle();if(r?.layers)for(const t of r.layers){if(!t.id.endsWith("-layer"))continue;if(!s.layers.some(n=>`${n.id}-layer`===t.id)){a.getLayer(t.id)&&a.removeLayer(t.id);const n=t.source;n&&a.getSource(n)&&a.removeSource(n)}}},e+100)}we(()=>{const e=p[0],s={},o=[];e.layers.forEach(d=>{s[d.id]={type:"raster",tiles:[`${d.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}}),e.layers.forEach(d=>{o.push({id:`${d.id}-layer`,type:"raster",source:d.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),a=new I.Map({container:i(c),style:{version:8,sources:s,layers:o},maxZoom:16,minZoom:6,preserveDrawingBuffer:!0,attributionControl:!1}),a.addControl(new I.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const r={forwardGeocode:async d=>{const w=[];try{const j=encodeURIComponent((d.query??"").trim());if(!j)return{type:"FeatureCollection",features:w};const de=`https://nominatim.openstreetmap.org/search?q=${j}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,pe=await(await fetch(de,{headers:{"Accept-Language":"fr"}})).json(),ue=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const g of pe.features??[]){const G=g.properties?.address?.state,me=g.properties?.address?.county;if(!(G==="Wallonie"||G==="Région wallonne"||ue.some(J=>me?.includes(J)||G?.includes(J))))continue;const H=g.bbox,b=Array.isArray(H)&&H.length===4?H.map(Number):void 0;let W;b?W=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2]:g.geometry?.type==="Point"&&Array.isArray(g.geometry.coordinates)?W=[Number(g.geometry.coordinates[0]),Number(g.geometry.coordinates[1])]:W=[4.4699,50.5039],w.push({type:"Feature",geometry:{type:"Point",coordinates:W},place_name:g.properties?.display_name,properties:{...g.properties,bbox:b},text:g.properties?.display_name,place_type:["place"],center:W,bbox:b})}}catch(j){console.error("forwardGeocode error:",j)}return{type:"FeatureCollection",features:w}}},t=new Le(r,{maplibregl:I,placeholder:"Cherchez une adresse en Wallonie",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:200,minLength:2,showResultMarkers:!1});a.addControl(t,"top-left"),a.addControl(new I.NavigationControl,"top-left"),a.once("idle",()=>E({animate:!1}));let l=i(c).clientWidth,n=i(c).clientHeight;const f=new ResizeObserver(()=>{const d=i(c).clientWidth,w=i(c).clientHeight;(d!==l||w!==n)&&(l=d,n=w,E({animate:!1}))});f.observe(i(c));const u=()=>{const d=i(c).clientWidth,w=i(c).clientHeight;(d!==l||w!==n)&&(l=d,n=w,E({animate:!1}))};return window.addEventListener("resize",u),window.addEventListener("orientationchange",u),()=>{C(),f.disconnect(),window.removeEventListener("resize",u),window.removeEventListener("orientationchange",u),a.remove()}}),Ce();var M=Ie(),N=v(M);Se(N,e=>m(c,e),()=>i(c));var R=z(N,2),se=v(R,!0);y(R);var Y=z(R,2),A=v(Y),k=v(A),ie=v(k);{var ne=e=>{var s=je();S(e,s)},le=e=>{var s=ze();S(e,s)};be(ie,e=>{i(_)?e(ne):e(le,!1)})}y(k),y(A);var Z=z(A,2),F=v(Z),ce=v(F);y(F);var O=z(F,2);xe(O,5,()=>p,_e,(e,s,o)=>{const r=ge(()=>o/(p.length-1)*100);var t=$e();let l;var n=v(t),f=v(n,!0);y(n),y(t),K(u=>{l=We(t,1,"year-marker svelte-wish1j",null,l,u),V(t,`left: ${i(r)??""}%`),Q(f,i(s).displayYear)},[()=>({active:o===i(h)})]),U("click",t,()=>oe(o)),S(e,t)}),y(O),y(Z),y(Y),y(M),K(()=>{Q(se,p[i(h)].displayYear),V(ce,`width: ${i(x)??""}%`)}),U("click",k,re),S(T,M),fe()}var Ee=B('<div class="page-container svelte-lwifl2"><!></div>');function Ze(T){var P=Ee();he(a=>{ve.title="Travel in Time - Orthophotos Wallonie"});var c=v(P);Te(c,{}),y(P),S(T,P)}export{Ze as component};
