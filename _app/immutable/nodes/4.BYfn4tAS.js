import"../chunks/DsnmJJEf.js";import"../chunks/C1X7ZH2G.js";import{I as me,A as ne,B as fe,C as ae,J as ge,w as p,K as E,M as B,F as ie,D as Z,G as le}from"../chunks/sZzwH-X8.js";import{o as he,e as ye}from"../chunks/DPlkaXRH.js";import{S as ve,s as oe,m as h,M as se}from"../chunks/vupgCqCY.js";import{b as re}from"../chunks/DlGDAnrT.js";import{i as be}from"../chunks/B2bDIl6U.js";import{o as H}from"../chunks/C4AmPXCP.js";var we=ne('<div class="map-lens-wrapper svelte-lapvzq"><div></div> <div></div> <div class="lens-border svelte-lapvzq"></div> <button class="swap-button svelte-lapvzq" title="Inverser les couches"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-lapvzq"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg></button> <!></div>');function Ce(k,w){me(w,!1);let C=E(),L=E(),i,n,M=E(!1),N=E({lng:4.35,lat:50.85}),_=E(11);const U=[[4.243,50.764],[4.482,50.913]];function j(o){const d=H;return o.service==="urban-brussels"&&o.crs==="EPSG:31370"?`${d.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${o.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${d.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${o.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}function ce(){B(M,!p(M))}he(()=>{let o=null;if(typeof window<"u"&&window.location.hash){const e=window.location.hash.slice(1).split(",");if(e.length===3){const s=parseFloat(e[0]),a=parseFloat(e[1]),m=parseFloat(e[2].replace("z",""));!isNaN(s)&&!isNaN(a)&&!isNaN(m)&&(o={center:[a,s],zoom:m})}}let d=!1;const y=new Map,z=H.orthophotos.find(t=>t.id==="ortho-1971"),R=H.orthophotos.find(t=>t.id==="ortho-2024");n=new h.Map({container:p(L),style:{version:8,sources:{[R.id]:{type:"raster",tiles:[j(R)],tileSize:256}},layers:[{id:`${R.id}-layer`,type:"raster",source:R.id,paint:{}}]},...o?{center:o.center,zoom:o.zoom}:{bounds:U,fitBoundsOptions:{padding:20}},minZoom:10,maxZoom:20,attributionControl:!1}),i=new h.Map({container:p(C),style:{version:8,sources:{[z.id]:{type:"raster",tiles:[j(z)],tileSize:256}},layers:[{id:`${z.id}-layer`,type:"raster",source:z.id,paint:{}}]},...o?{center:o.center,zoom:o.zoom}:{bounds:U,fitBoundsOptions:{padding:20}},minZoom:10,maxZoom:20,attributionControl:!1}),n.addControl(new h.NavigationControl,"bottom-left"),i.addControl(new h.NavigationControl,"bottom-left"),n.addControl(new h.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const Y={forwardGeocode:async t=>{const e=(t.query??"").trim().toLowerCase();if(y.has(e))return y.get(e);const s=[];try{const m=encodeURIComponent(e);if(!m)return{type:"FeatureCollection",features:s};const de=`https://nominatim.openstreetmap.org/search?q=${m}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,ue=await(await fetch(de,{headers:{"Accept-Language":"fr"}})).json();for(const l of ue.features??[]){const ee=l.properties?.address?.region,A=l.properties?.address?.state;if(!(ee?.includes("Bruxelles")||ee?.includes("Brussels")||A==="Bruxelles-Capitale"||A==="Brussels Hoofdstedelijk Gewest"||A==="Région de Bruxelles-Capitale"||A==="Brussels-Capital"))continue;const G=l.bbox,f=Array.isArray(G)&&G.length===4?G.map(Number):void 0;let v;if(f)v=[f[0]+(f[2]-f[0])/2,f[1]+(f[3]-f[1])/2];else if(l.geometry?.type==="Point"&&Array.isArray(l.geometry.coordinates))v=[Number(l.geometry.coordinates[0]),Number(l.geometry.coordinates[1])];else{const g=[],te=r=>{r&&(r.type==="Point"?g.push([+r.coordinates[0],+r.coordinates[1]]):r.type==="LineString"||r.type==="MultiPoint"?r.coordinates.forEach(c=>g.push([+c[0],+c[1]])):r.type==="Polygon"||r.type==="MultiLineString"?r.coordinates.flat(1).forEach(c=>g.push([+c[0],+c[1]])):r.type==="MultiPolygon"?r.coordinates.flat(2).forEach(c=>g.push([+c[0],+c[1]])):r.type==="GeometryCollection"&&(r.geometries||[]).forEach(te))};if(te(l.geometry),g.length){const r=g.map(O=>O[0]),c=g.map(O=>O[1]),b=[Math.min(...r),Math.min(...c),Math.max(...r),Math.max(...c)];v=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2]}else v=[4.3517,50.8503]}s.push({type:"Feature",geometry:{type:"Point",coordinates:v},place_name:l.properties?.display_name,properties:{...l.properties,bbox:f},text:l.properties?.display_name,place_type:["place"],center:v,bbox:f})}}catch(m){console.error("forwardGeocode error:",m)}const a={type:"FeatureCollection",features:s};if(y.size>=50){const m=y.keys().next().value;m!==void 0&&y.delete(m)}return y.set(e,a),a}},S=new se(Y,{maplibregl:h,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});n.addControl(S,"top-left");const T=new se(Y,{maplibregl:h,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});i.addControl(T,"top-left");const K=t=>{const e=t.bbox??t.properties?.bbox;e&&Array.isArray(e)&&e.length===4?n.fitBounds([[e[0],e[1]],[e[2],e[3]]],{padding:50,maxZoom:16,duration:1200}):n.flyTo({center:t.center,zoom:15,duration:1200})};let x=[],u=0;const Q=t=>{x=t.features||[],u=0,setTimeout(()=>{const e=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");e.length>0&&(e.forEach(s=>s.classList.remove("active")),e[0].classList.add("active"))},50)};S.on("results",Q),T.on("results",Q),setTimeout(()=>{const t=document.querySelector(".maplibregl-ctrl-geocoder input");t&&t.addEventListener("keydown",e=>{const s=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(e.key==="Enter"&&x.length>0){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const a=x[u];a&&(K(a),e.target.value="",S.clear(),x=[])}else e.key==="ArrowDown"&&s.length>0?(e.preventDefault(),u=Math.min(u+1,x.length-1),s.forEach(a=>a.classList.remove("active")),s[u]&&s[u].classList.add("active")):e.key==="ArrowUp"&&s.length>0&&(e.preventDefault(),u=Math.max(u-1,0),s.forEach(a=>a.classList.remove("active")),s[u]&&s[u].classList.add("active"))},!0)},100);const X=t=>{const e=t.result;K(e),setTimeout(()=>{S.clear(),T.clear(),document.querySelectorAll(".maplibregl-ctrl-geocoder input").forEach(a=>a.value="")},100)};S.on("result",X),T.on("result",X);const J=(t,e)=>{d||(d=!0,e.jumpTo({center:t.getCenter(),zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch()}),requestAnimationFrame(()=>{d=!1}))};n.on("move",()=>{d||J(n,i);const t=n.getCenter();B(N,{lng:t.lng,lat:t.lat}),B(_,n.getZoom()),typeof window<"u"&&(window.location.hash=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${p(_).toFixed(2)}z`)}),i.on("move",()=>{if(d||J(i,n),typeof window<"u"){const t=i.getCenter(),e=i.getZoom();window.location.hash=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${e.toFixed(2)}z`}});let q=null;const $=()=>{q||(q=window.setTimeout(()=>{i&&i.resize(),n&&n.resize(),q=null},250))};return setTimeout($,100),window.addEventListener("resize",$),()=>{window.removeEventListener("resize",$),i.remove(),n.remove()}}),be();var F=we(),I=ie(F);let D;re(I,o=>B(L,o),()=>p(L));var P=Z(I,2);let W;re(P,o=>B(C,o),()=>p(C));var V=Z(P,4),pe=Z(V,2);ve(pe,{get lat(){return p(N).lat},get lng(){return p(N).lng},get zoom(){return p(_)},yearBefore:"ortho-1971",yearAfter:"ortho-2024"}),le(F),fe((o,d)=>{D=oe(I,1,"map-container after svelte-lapvzq",null,D,o),W=oe(P,1,"map-container before svelte-lapvzq",null,W,d)},[()=>({lens:p(M)}),()=>({lens:!p(M)})]),ye("click",V,ce),ae(k,F),ge()}var Se=ne('<div class="page-container svelte-44n6ux"><!></div>');function Ne(k){var w=Se(),C=ie(w);Ce(C,{}),le(w),ae(k,w)}export{Ne as component};
