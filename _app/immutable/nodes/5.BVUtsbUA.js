import"../chunks/DsnmJJEf.js";import"../chunks/CQmyZwkG.js";import{I as rt,K as S,A as Ge,B as nt,C as He,J as st,F as oe,D as P,w as n,M as m,G as re}from"../chunks/CwdBl0A7.js";import{o as at,e as te}from"../chunks/CWmqxiNW.js";import{s as ze}from"../chunks/CWYEOFQC.js";import{b as G}from"../chunks/Cgb6JafD.js";import{i as it}from"../chunks/Ci2bA8W4.js";import{S as lt,m as Y,M as ct}from"../chunks/B8IqOMgz.js";import{o as Fe}from"../chunks/C4AmPXCP.js";import{Y as ke}from"../chunks/BZ0HtTU2.js";var dt=Ge('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="geocoder-overlay svelte-1awtn06"></div> <div class="navigation-overlay svelte-1awtn06"></div> <div class="attribution-overlay svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div> <!></div> <!> <!></div>');function ut(ne,H){rt(H,!1);let O=S(),se=S(),D=S(),W=S(),U=S(),Z=S(),i,g,ae=S(50),j=!1,V=null,ie=null;function Oe(e){m(ae,e),ie&&cancelAnimationFrame(ie),ie=requestAnimationFrame(()=>{g&&g.triggerRepaint()})}let le=S({lng:4.35,lat:50.85}),Ce=S(11);function qe(e,s=512){const c=Fe;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${c.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${s}&HEIGHT=${s}&BBOX={bbox-epsg-3857}`:`${c.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${s}&HEIGHT=${s}&BBOX={bbox-epsg-3857}`}const Se=new WeakMap;function Ye(e){let s=Se.get(e);return s||(s=new Set,Se.set(e,s)),s}let Ee=new Set;function De(e,s,c=3e3){return new Promise(p=>{let v=!1;const E=()=>{v||(v=!0,_(),Ee.delete(T),p())},T=()=>{v||(console.log("Tile wait cancelled - user is interacting"),E())};Ee.add(T);const l=()=>{s.every(Q=>{const fe=Q.replace(/-layer$/,"");return!!e.getSource(fe)&&e.isSourceLoaded(fe)})&&e.areTilesLoaded()&&E()},B=()=>{console.log("Map movement detected - finishing tile wait early"),E()},M=setTimeout(E,c),_=()=>{e.off("idle",l),e.off("movestart",B),clearTimeout(M)};e.on("idle",l),e.on("movestart",B),l()})}function We(e,s,c=512){const p=s.id,v=`${s.id}-layer`;return e.getSource(p)||e.addSource(p,{type:"raster",tiles:[qe(s,c)],tileSize:c,maxzoom:20}),e.getLayer(v)||e.addLayer({id:v,type:"raster",source:p,layout:{visibility:"visible"},paint:{"raster-opacity":0,"raster-fade-duration":300,"raster-resampling":"nearest"}}),v}const h=Fe.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let A=S(h[0].id),x=S(h[h.length-1].id);function Ue(e){e.currentTarget.setPointerCapture(e.pointerId),V=e.pointerId,j=!0}function Ze(e){if(!j||V!==e.pointerId||!n(D))return;const s=n(D).getBoundingClientRect(),c=e.clientX-s.left;Oe(Math.max(0,Math.min(100,c/s.width*100)))}function Te(e){if(V===e.pointerId){const s=e.currentTarget;try{s.releasePointerCapture(e.pointerId)}catch{}j=!1,V=null}}const ce=new WeakMap;async function N(e,s){const c=ce.get(e);c&&(console.log("Waiting for previous layer change to complete..."),await c);const p=(async()=>{const v=Ye(e),E=[...v],T=s.layers.map(l=>We(e,l,512));requestAnimationFrame(()=>{T.forEach(l=>{e.getLayer(l)&&e.moveLayer(l)})}),await De(e,T,1500),requestAnimationFrame(()=>{T.forEach(l=>{e.getLayer(l)&&e.setPaintProperty(l,"raster-opacity",1)}),E.forEach(l=>{e.getLayer(l)&&e.setPaintProperty(l,"raster-opacity",0)})}),setTimeout(()=>{E.forEach(l=>{if(!T.includes(l)){const B=l.replace(/-layer$/,"");e.getLayer(l)&&e.removeLayer(l),e.getSource(B)&&e.removeSource(B),v.delete(l)}}),T.forEach(l=>v.add(l))},400)})();ce.set(e,p),await p,ce.delete(e)}let q=null;function je(e){if(!i)return;const s=h.find(c=>c.id===e);s&&(N(i,s),m(A,e),q&&q(!0))}function Ve(e){if(!g)return;const s=h.find(c=>c.id===e);s&&(N(g,s),m(x,e),q&&q(!0))}at(()=>{let e=null;(()=>{if(typeof window>"u")return!1;const o=window.location.hash.slice(1);if(!o)return!1;const t=o.split(",");if(t.length>=3){const r=parseFloat(t[0]),a=parseFloat(t[1]),d=parseFloat(t[2].replace("z",""));if(!isNaN(r)&&!isNaN(a)&&!isNaN(d)){if(e={center:[a,r],zoom:d},t.length>=5){const w=t[3],y=t[4];h.find(b=>b.id===w)&&m(A,w),h.find(b=>b.id===y)&&m(x,y)}return!0}}return!1})();let c=!1;const p=new Map,v=[[4.243,50.764],[4.482,50.913]],E=[[4.05,50.65],[4.68,51.05]],T=h.find(o=>o.id===n(A)),l=h.find(o=>o.id===n(x)),B={version:8,sources:{positron:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://b.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://c.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> © <a href="https://carto.com/attributions">CARTO</a>'}},layers:[{id:"positron-layer",type:"raster",source:"positron",paint:{"raster-opacity":1}}]},M={container:n(O),style:B,minZoom:10,maxZoom:20,maxBounds:E,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(M.center=e.center,M.zoom=e.zoom):(M.bounds=v,M.fitBoundsOptions={padding:0}),i=new Y.Map(M);const _={container:n(se),style:JSON.parse(JSON.stringify(B)),minZoom:10,maxZoom:20,maxBounds:E,interactive:!1,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(_.center=e.center,_.zoom=e.zoom):(_.bounds=v,_.fitBoundsOptions={padding:0}),g=new Y.Map(_);const pe=new Map,Q=o=>t=>{if(console.warn("Map error:",t?.error?.status,t?.sourceId),t.sourceId&&t.error?.status>=500){const r=pe.get(t.sourceId)||0;r<2&&(pe.set(t.sourceId,r+1),setTimeout(()=>{const a=o.getSource(t.sourceId);a&&"reload"in a&&a.reload()},1e3*(r+1)))}};i.on("error",Q(i)),g.on("error",Q(g)),i.once("load",()=>N(i,T)),g.once("load",()=>N(g,l));const Re=new Y.NavigationControl().onAdd(i);n(U)&&n(U).appendChild(Re);const Ke=new Y.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}).onAdd(i);n(Z)&&n(Z).appendChild(Ke);const Qe={forwardGeocode:async o=>{const t=(o.query??"").trim().toLowerCase();if(p.has(t))return p.get(t);const r=[];try{const d=encodeURIComponent(t);if(!d)return{type:"FeatureCollection",features:r};const w=`https://nominatim.openstreetmap.org/search?q=${d}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,b=await(await fetch(w,{headers:{"Accept-Language":"fr"}})).json();for(const f of b.features??[]){const $e=f.properties?.address?.region,ee=f.properties?.address?.state;if(!($e?.includes("Bruxelles")||$e?.includes("Brussels")||ee==="Bruxelles-Capitale"||ee==="Brussels Hoofdstedelijk Gewest"||ee==="Région de Bruxelles-Capitale"||ee==="Brussels-Capital"))continue;const we=f.bbox,L=Array.isArray(we)&&we.length===4?we.map(Number):void 0;let F;if(L)F=[L[0]+(L[2]-L[0])/2,L[1]+(L[3]-L[1])/2];else if(f.geometry?.type==="Point"&&Array.isArray(f.geometry.coordinates))F=[Number(f.geometry.coordinates[0]),Number(f.geometry.coordinates[1])];else{const $=[],Ne=u=>{u&&(u.type==="Point"?$.push([+u.coordinates[0],+u.coordinates[1]]):u.type==="LineString"||u.type==="MultiPoint"?u.coordinates.forEach(C=>$.push([+C[0],+C[1]])):u.type==="Polygon"||u.type==="MultiLineString"?u.coordinates.flat(1).forEach(C=>$.push([+C[0],+C[1]])):u.type==="MultiPolygon"?u.coordinates.flat(2).forEach(C=>$.push([+C[0],+C[1]])):u.type==="GeometryCollection"&&(u.geometries||[]).forEach(Ne))};if(Ne(f.geometry),$.length){const u=$.map(be=>be[0]),C=$.map(be=>be[1]),k=[Math.min(...u),Math.min(...C),Math.max(...u),Math.max(...C)];F=[k[0]+(k[2]-k[0])/2,k[1]+(k[3]-k[1])/2]}else F=[4.3517,50.8503]}r.push({type:"Feature",geometry:{type:"Point",coordinates:F},place_name:f.properties?.display_name,properties:{...f.properties,bbox:L},text:f.properties?.display_name,place_type:["place"],center:F,bbox:L})}}catch(d){console.error("forwardGeocode error:",d)}const a={type:"FeatureCollection",features:r};if(p.size>=50){const d=p.keys().next().value;d!==void 0&&p.delete(d)}return p.set(t,a),a}},z=new ct(Qe,{maplibregl:Y,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1}),et=z.onAdd(i);n(W)&&n(W).appendChild(et);const me=o=>{const t=o.bbox??o.properties?.bbox;t&&Array.isArray(t)&&t.length===4?i.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):i.flyTo({center:o.center,zoom:15,duration:1200})};let R=[],I=0;z.on("results",o=>{R=o.features||[],I=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(r=>r.classList.remove("active")),t[0].classList.add("active"),t.forEach((r,a)=>{const d=w=>{if(w.preventDefault(),w.stopPropagation(),R[a]){const y=document.querySelector(".maplibregl-ctrl-geocoder input");y&&y.blur(),me(R[a]),setTimeout(()=>{y&&(y.value=""),z.clear(),R=[]},100)}};r.removeEventListener("touchend",d),r.removeEventListener("click",d),r.addEventListener("touchend",d,{passive:!1}),r.addEventListener("click",d)}))},50)}),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&o.addEventListener("keydown",t=>{const r=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&R.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const a=R[I];a&&(me(a),t.target.value="",z.clear(),R=[])}else t.key==="ArrowDown"&&r.length>0?(t.preventDefault(),I=Math.min(I+1,R.length-1),r.forEach(a=>a.classList.remove("active")),r[I]&&r[I].classList.add("active")):t.key==="ArrowUp"&&r.length>0&&(t.preventDefault(),I=Math.max(I-1,0),r.forEach(a=>a.classList.remove("active")),r[I]&&r[I].classList.add("active"))},!0)},100),z.on("result",o=>{const t=o.result;me(t),setTimeout(()=>{const r=document.querySelector(".maplibregl-ctrl-geocoder input");r&&(r.value=""),z.clear()},100)});const tt=(o,t)=>{c||(c=!0,t.jumpTo({center:o.getCenter(),zoom:o.getZoom(),bearing:o.getBearing(),pitch:o.getPitch()}),requestAnimationFrame(()=>{c=!1}))};let ge=null,Pe="";const ve=(o=!1)=>{if(typeof window>"u"||!i)return;const t=i.getCenter(),r=i.getZoom(),a=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${r.toFixed(2)}z,${n(A)},${n(x)}`;a!==Pe&&(Pe=a,o?window.location.hash=a:history.replaceState(null,"",`#${a}`))};q=ve;let Me=0;i.on("move",()=>{!j&&!c&&tt(i,g);const o=i.getCenter();m(le,{lng:o.lng,lat:o.lat}),m(Ce,i.getZoom());const t=performance.now();t-Me>120&&(ve(!1),Me=t),ge&&clearTimeout(ge),ge=window.setTimeout(()=>{ve(!0)},800)});let he=null;const ye=()=>{he||(he=window.setTimeout(()=>{i&&i.resize(),g&&g.resize(),he=null},250))};setTimeout(ye,100),window.addEventListener("resize",ye);const _e=()=>{if(typeof window>"u")return;const o=window.location.hash.slice(1);if(!o)return;const t=o.split(",");if(t.length>=3){const r=parseFloat(t[0]),a=parseFloat(t[1]),d=parseFloat(t[2].replace("z",""));if(!isNaN(r)&&!isNaN(a)&&!isNaN(d)&&(i&&i.flyTo({center:[a,r],zoom:d,duration:1e3}),t.length>=5)){const w=t[3],y=t[4];if(w&&w!==n(A)){const b=h.find(f=>f.id===w);b&&(m(A,w),N(i,b))}if(y&&y!==n(x)){const b=h.find(f=>f.id===y);b&&(m(x,y),N(g,b))}}}};window.addEventListener("hashchange",_e);const ot=setInterval(()=>{c&&(console.warn("isSyncing stuck - forcing reset"),c=!1)},5e3);return()=>{window.removeEventListener("resize",ye),window.removeEventListener("hashchange",_e),clearInterval(ot),i.remove(),g.remove()}}),it();var de=dt(),J=oe(de),Ie=oe(J);G(Ie,e=>m(O,e),()=>n(O));var ue=P(Ie,2);G(ue,e=>m(se,e),()=>n(se));var Le=P(ue,2);G(Le,e=>m(W,e),()=>n(W));var Ae=P(Le,2);G(Ae,e=>m(U,e),()=>n(U));var xe=P(Ae,2);G(xe,e=>m(Z,e),()=>n(Z));var X=P(xe,2),K=oe(X);re(X);var Je=P(X,2);lt(Je,{get lat(){return n(le).lat},get lng(){return n(le).lng},get zoom(){return n(Ce)},get yearBefore(){return n(A)},get yearAfter(){return n(x)}}),re(J),G(J,e=>m(D,e),()=>n(D));var Be=P(J,2);ke(Be,{side:"left",get groups(){return h},get selectedId(){return n(A)},$$events:{select:e=>je(e.detail.id)}});var Xe=P(Be,2);ke(Xe,{side:"right",get groups(){return h},get selectedId(){return n(x)},$$events:{select:e=>Ve(e.detail.id)}}),re(de),nt(()=>{ze(ue,`clip-path: inset(0 0 0 calc(${n(ae)??""}% - 0.5px))`),ze(X,`left: ${n(ae)??""}%`)}),te("pointerdown",K,Ue),te("pointermove",K,Ze),te("pointerup",K,Te),te("pointercancel",K,Te),He(ne,de),st()}var pt=Ge('<div class="page-container svelte-1ewpa8p"><!></div>');function It(ne){var H=pt(),O=oe(H);ut(O,{}),re(H),He(ne,H)}export{It as component};
