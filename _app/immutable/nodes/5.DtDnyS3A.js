import"../chunks/DsnmJJEf.js";import"../chunks/CoDSuzm1.js";import{I as Ze,K as L,A as Pe,B as je,C as $e,J as Ve,F as Q,D as O,w as c,M as h,G as ee}from"../chunks/BILf7VAl.js";import{o as Je,e as K}from"../chunks/XYDQtagk.js";import{s as Le}from"../chunks/MQgf3nuD.js";import{b as ye}from"../chunks/B7CElIPH.js";import{i as Xe}from"../chunks/MHw7BI_m.js";import{S as Ke,m as Y,M as Qe}from"../chunks/CccdXG49.js";import{o as Re}from"../chunks/C4AmPXCP.js";import{Y as Me}from"../chunks/gDwRjMFD.js";var et=Pe('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div> <!></div> <!> <!></div>');function tt(te,F){Ze(F,!1);let G=L(),oe=L(),q=L(),s,p,re=L(50),W=!1,D=null,ne=null;function Ne(e){h(re,e),ne&&cancelAnimationFrame(ne),ne=requestAnimationFrame(()=>{p&&p.triggerRepaint()})}let se=L({lng:4.35,lat:50.85}),he=L(11);function _e(e,r=512){const l=Re;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${l.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${r}&HEIGHT=${r}&BBOX={bbox-epsg-3857}`:`${l.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${r}&HEIGHT=${r}&BBOX={bbox-epsg-3857}`}const ve=new WeakMap;function ze(e){let r=ve.get(e);return r||(r=new Set,ve.set(e,r)),r}let we=new Set;function Fe(e,r,l=3e3){return new Promise(u=>{let m=!1;const b=()=>{m||(m=!0,M(),we.delete(S),u())},S=()=>{m||(console.log("Tile wait cancelled - user is interacting"),b())};we.add(S);const a=()=>{r.every(V=>{const J=V.replace(/-layer$/,"");return!!e.getSource(J)&&e.isSourceLoaded(J)})&&e.areTilesLoaded()&&b()},B=()=>{console.log("Map movement detected - finishing tile wait early"),b()},R=setTimeout(b,l),M=()=>{e.off("idle",a),e.off("movestart",B),clearTimeout(R)};e.on("idle",a),e.on("movestart",B),a()})}function Ge(e,r,l=512){const u=r.id,m=`${r.id}-layer`;return e.getSource(u)||e.addSource(u,{type:"raster",tiles:[_e(r,l)],tileSize:l,maxzoom:20}),e.getLayer(m)||e.addLayer({id:m,type:"raster",source:u,layout:{visibility:"visible"},paint:{"raster-opacity":0,"raster-fade-duration":300,"raster-resampling":"nearest"}}),m}const g=Re.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let I=L(g[0].id),x=L(g[g.length-1].id);function ke(e){e.currentTarget.setPointerCapture(e.pointerId),D=e.pointerId,W=!0}function He(e){if(!W||D!==e.pointerId||!c(q))return;const r=c(q).getBoundingClientRect(),l=e.clientX-r.left;Ne(Math.max(0,Math.min(100,l/r.width*100)))}function be(e){if(D===e.pointerId){const r=e.currentTarget;try{r.releasePointerCapture(e.pointerId)}catch{}W=!1,D=null}}const ae=new WeakMap;async function $(e,r){const l=ae.get(e);l&&(console.log("Waiting for previous layer change to complete..."),await l);const u=(async()=>{const m=ze(e),b=[...m],S=r.layers.map(a=>Ge(e,a,512));requestAnimationFrame(()=>{S.forEach(a=>{e.getLayer(a)&&e.moveLayer(a)})}),await Fe(e,S,1500),requestAnimationFrame(()=>{S.forEach(a=>{e.getLayer(a)&&e.setPaintProperty(a,"raster-opacity",1)}),b.forEach(a=>{e.getLayer(a)&&e.setPaintProperty(a,"raster-opacity",0)})}),setTimeout(()=>{b.forEach(a=>{if(!S.includes(a)){const B=a.replace(/-layer$/,"");e.getLayer(a)&&e.removeLayer(a),e.getSource(B)&&e.removeSource(B),m.delete(a)}}),S.forEach(a=>m.add(a))},400)})();ae.set(e,u),await u,ae.delete(e)}let k=null;function Oe(e){if(!s)return;const r=g.find(l=>l.id===e);r&&($(s,r),h(I,e),k&&k(!0))}function Ye(e){if(!p)return;const r=g.find(l=>l.id===e);r&&($(p,r),h(x,e),k&&k(!0))}Je(()=>{let e=null;(()=>{if(typeof window>"u")return!1;const o=window.location.hash.slice(1);if(!o)return!1;const t=o.split(",");if(t.length>=3){const n=parseFloat(t[0]),i=parseFloat(t[1]),y=parseFloat(t[2].replace("z",""));if(!isNaN(n)&&!isNaN(i)&&!isNaN(y)){if(e={center:[i,n],zoom:y},t.length>=5){const C=t[3],A=t[4];g.find(v=>v.id===C)&&h(I,C),g.find(v=>v.id===A)&&h(x,A)}return!0}}return!1})();let l=!1;const u=new Map,m=[[4.243,50.764],[4.482,50.913]],b=[[4.05,50.65],[4.68,51.05]],S=g.find(o=>o.id===c(I)),a=g.find(o=>o.id===c(x)),B={version:8,sources:{positron:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://b.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://c.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> © <a href="https://carto.com/attributions">CARTO</a>'}},layers:[{id:"positron-layer",type:"raster",source:"positron",paint:{"raster-opacity":1}}]},R={container:c(G),style:B,minZoom:10,maxZoom:20,maxBounds:b,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(R.center=e.center,R.zoom=e.zoom):(R.bounds=m,R.fitBoundsOptions={padding:0}),s=new Y.Map(R);const M={container:c(oe),style:JSON.parse(JSON.stringify(B)),minZoom:10,maxZoom:20,maxBounds:b,interactive:!1,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(M.center=e.center,M.zoom=e.zoom):(M.bounds=m,M.fitBoundsOptions={padding:0}),p=new Y.Map(M);const ce=new Map,V=o=>t=>{if(console.warn("Map error:",t?.error?.status,t?.sourceId),t.sourceId&&t.error?.status>=500){const n=ce.get(t.sourceId)||0;n<2&&(ce.set(t.sourceId,n+1),setTimeout(()=>{const i=o.getSource(t.sourceId);i&&"reload"in i&&i.reload()},1e3*(n+1)))}};s.on("error",V(s)),p.on("error",V(p)),s.once("load",()=>$(s,S)),p.once("load",()=>$(p,a)),s.addControl(new Y.NavigationControl,"bottom-left"),s.addControl(new Y.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const J={forwardGeocode:async o=>{const t=(o.query??"").trim().toLowerCase();if(u.has(t))return u.get(t);const n=[];try{const y=encodeURIComponent(t);if(!y)return{type:"FeatureCollection",features:n};const C=`https://nominatim.openstreetmap.org/search?q=${y}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,v=await(await fetch(C,{headers:{"Accept-Language":"fr"}})).json();for(const f of v.features??[]){const Be=f.properties?.address?.region,X=f.properties?.address?.state;if(!(Be?.includes("Bruxelles")||Be?.includes("Brussels")||X==="Bruxelles-Capitale"||X==="Brussels Hoofdstedelijk Gewest"||X==="Région de Bruxelles-Capitale"||X==="Brussels-Capital"))continue;const me=f.bbox,E=Array.isArray(me)&&me.length===4?me.map(Number):void 0;let _;if(E)_=[E[0]+(E[2]-E[0])/2,E[1]+(E[3]-E[1])/2];else if(f.geometry?.type==="Point"&&Array.isArray(f.geometry.coordinates))_=[Number(f.geometry.coordinates[0]),Number(f.geometry.coordinates[1])];else{const P=[],Ae=d=>{d&&(d.type==="Point"?P.push([+d.coordinates[0],+d.coordinates[1]]):d.type==="LineString"||d.type==="MultiPoint"?d.coordinates.forEach(w=>P.push([+w[0],+w[1]])):d.type==="Polygon"||d.type==="MultiLineString"?d.coordinates.flat(1).forEach(w=>P.push([+w[0],+w[1]])):d.type==="MultiPolygon"?d.coordinates.flat(2).forEach(w=>P.push([+w[0],+w[1]])):d.type==="GeometryCollection"&&(d.geometries||[]).forEach(Ae))};if(Ae(f.geometry),P.length){const d=P.map(ge=>ge[0]),w=P.map(ge=>ge[1]),z=[Math.min(...d),Math.min(...w),Math.max(...d),Math.max(...w)];_=[z[0]+(z[2]-z[0])/2,z[1]+(z[3]-z[1])/2]}else _=[4.3517,50.8503]}n.push({type:"Feature",geometry:{type:"Point",coordinates:_},place_name:f.properties?.display_name,properties:{...f.properties,bbox:E},text:f.properties?.display_name,place_type:["place"],center:_,bbox:E})}}catch(y){console.error("forwardGeocode error:",y)}const i={type:"FeatureCollection",features:n};if(u.size>=50){const y=u.keys().next().value;y!==void 0&&u.delete(y)}return u.set(t,i),i}},N=new Qe(J,{maplibregl:Y,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});s.addControl(N,"top-left");const Ce=o=>{const t=o.bbox??o.properties?.bbox;t&&Array.isArray(t)&&t.length===4?s.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):s.flyTo({center:o.center,zoom:15,duration:1200})};let H=[],T=0;N.on("results",o=>{H=o.features||[],T=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(n=>n.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&o.addEventListener("keydown",t=>{const n=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&H.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const i=H[T];i&&(Ce(i),t.target.value="",N.clear(),H=[])}else t.key==="ArrowDown"&&n.length>0?(t.preventDefault(),T=Math.min(T+1,H.length-1),n.forEach(i=>i.classList.remove("active")),n[T]&&n[T].classList.add("active")):t.key==="ArrowUp"&&n.length>0&&(t.preventDefault(),T=Math.max(T-1,0),n.forEach(i=>i.classList.remove("active")),n[T]&&n[T].classList.add("active"))},!0)},100),N.on("result",o=>{const t=o.result;Ce(t),setTimeout(()=>{const n=document.querySelector(".maplibregl-ctrl-geocoder input");n&&(n.value=""),N.clear()},100)});const De=(o,t)=>{l||(l=!0,t.jumpTo({center:o.getCenter(),zoom:o.getZoom(),bearing:o.getBearing(),pitch:o.getPitch()}),requestAnimationFrame(()=>{l=!1}))};let de=null,Ee="";const ue=(o=!1)=>{if(typeof window>"u"||!s)return;const t=s.getCenter(),n=s.getZoom(),i=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${n.toFixed(2)}z,${c(I)},${c(x)}`;i!==Ee&&(Ee=i,o?window.location.hash=i:history.replaceState(null,"",`#${i}`))};k=ue;let Ie=0;s.on("move",()=>{!W&&!l&&De(s,p);const o=s.getCenter();h(se,{lng:o.lng,lat:o.lat}),h(he,s.getZoom());const t=performance.now();t-Ie>120&&(ue(!1),Ie=t),de&&clearTimeout(de),de=window.setTimeout(()=>{ue(!0)},800)});let fe=null;const pe=()=>{fe||(fe=window.setTimeout(()=>{s&&s.resize(),p&&p.resize(),fe=null},250))};setTimeout(pe,100),window.addEventListener("resize",pe);const xe=()=>{if(typeof window>"u")return;const o=window.location.hash.slice(1);if(!o)return;const t=o.split(",");if(t.length>=3){const n=parseFloat(t[0]),i=parseFloat(t[1]),y=parseFloat(t[2].replace("z",""));if(!isNaN(n)&&!isNaN(i)&&!isNaN(y)&&(s&&s.flyTo({center:[i,n],zoom:y,duration:1e3}),t.length>=5)){const C=t[3],A=t[4];if(C&&C!==c(I)){const v=g.find(f=>f.id===C);v&&(h(I,C),$(s,v))}if(A&&A!==c(x)){const v=g.find(f=>f.id===A);v&&(h(x,A),$(p,v))}}}};window.addEventListener("hashchange",xe);const Ue=setInterval(()=>{l&&(console.warn("isSyncing stuck - forcing reset"),l=!1)},5e3);return()=>{window.removeEventListener("resize",pe),window.removeEventListener("hashchange",xe),clearInterval(Ue),s.remove(),p.remove()}}),Xe();var ie=et(),U=Q(ie),Se=Q(U);ye(Se,e=>h(G,e),()=>c(G));var le=O(Se,2);ye(le,e=>h(oe,e),()=>c(oe));var Z=O(le,2),j=Q(Z);ee(Z);var qe=O(Z,2);Ke(qe,{get lat(){return c(se).lat},get lng(){return c(se).lng},get zoom(){return c(he)},get yearBefore(){return c(I)},get yearAfter(){return c(x)}}),ee(U),ye(U,e=>h(q,e),()=>c(q));var Te=O(U,2);Me(Te,{side:"left",get groups(){return g},get selectedId(){return c(I)},$$events:{select:e=>Oe(e.detail.id)}});var We=O(Te,2);Me(We,{side:"right",get groups(){return g},get selectedId(){return c(x)},$$events:{select:e=>Ye(e.detail.id)}}),ee(ie),je(()=>{Le(le,`clip-path: inset(0 0 0 calc(${c(re)??""}% - 0.5px))`),Le(Z,`left: ${c(re)??""}%`)}),K("pointerdown",j,ke),K("pointermove",j,He),K("pointerup",j,be),K("pointercancel",j,be),$e(te,ie),Ve()}var ot=Pe('<div class="page-container svelte-1ewpa8p"><!></div>');function mt(te){var F=ot(),G=Q(F);tt(G,{}),ee(F),$e(te,F)}export{mt as component};
