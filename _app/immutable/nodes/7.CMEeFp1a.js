import"../chunks/DsnmJJEf.js";import"../chunks/C1X7ZH2G.js";import{I as me,A as se,B as fe,C as ne,J as he,F as re,D as Z,w as c,K as z,M as k,G as ae}from"../chunks/sZzwH-X8.js";import{o as ge,e as ye}from"../chunks/DPlkaXRH.js";import{S as be,s as X,m as y,M as ee}from"../chunks/DlhcB3S6.js";import{b as te}from"../chunks/DlGDAnrT.js";import{i as ve}from"../chunks/B2bDIl6U.js";import{o as oe}from"../chunks/CUZUMNKG.js";var we=se('<div class="map-lens-wrapper svelte-1kjt96t"><div></div> <div></div> <div class="lens-border svelte-1kjt96t"></div> <button class="swap-button svelte-1kjt96t" title="Inverser les couches"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1kjt96t"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg></button> <!></div>');function xe(_,w){me(w,!1);let x=z(),T=z(),m,n,S=z(!1),j=z({lng:4.5,lat:50.5}),B=z(8);const D=[[2.75,49.45],[6.5,50.85]];function ie(){k(S,!c(S))}ge(()=>{let a=!1;const h=new Map;let g=null;if(typeof window<"u"&&window.location.hash){const e=window.location.hash.slice(1).split(",");if(e.length===3){const o=parseFloat(e[0]),r=parseFloat(e[1]),d=parseFloat(e[2].replace("z",""));!isNaN(o)&&!isNaN(r)&&!isNaN(d)&&(g={center:[r,o],zoom:d})}}const L=oe.orthophotos.find(t=>t.id==="ortho-1971"),A=oe.orthophotos.find(t=>t.id==="ortho-2023-ete");n=new y.Map({container:c(T),style:{version:8,sources:{[A.id]:{type:"raster",tiles:[`${A.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&f=image`],tileSize:256}},layers:[{id:`${A.id}-layer`,type:"raster",source:A.id,paint:{}}]},...g?{center:g.center,zoom:g.zoom}:{bounds:D,fitBoundsOptions:{padding:20}},minZoom:8,maxZoom:17,attributionControl:!1}),m=new y.Map({container:c(x),style:{version:8,sources:{[L.id]:{type:"raster",tiles:[`${L.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&f=image`],tileSize:256}},layers:[{id:`${L.id}-layer`,type:"raster",source:L.id,paint:{}}]},...g?{center:g.center,zoom:g.zoom}:{bounds:D,fitBoundsOptions:{padding:20}},minZoom:8,maxZoom:17,attributionControl:!1}),n.addControl(new y.NavigationControl,"bottom-left"),m.addControl(new y.NavigationControl,"bottom-left"),n.addControl(new y.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const K={forwardGeocode:async t=>{const e=(t.query??"").trim().toLowerCase();if(h.has(e))return h.get(e);const o=[];try{const d=encodeURIComponent(e);if(!d)return{type:"FeatureCollection",features:o};const ce=`https://nominatim.openstreetmap.org/search?q=${d}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,pe=await(await fetch(ce,{headers:{"Accept-Language":"fr"}})).json(),de=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const i of pe.features??[]){const W=i.properties?.address?.state,ue=i.properties?.address?.county;if(!(W==="Wallonie"||W==="Région wallonne"||de.some(u=>ue?.includes(u)||W?.includes(u))))continue;const $=i.bbox,f=Array.isArray($)&&$.length===4?$.map(Number):void 0;let b;if(f)b=[f[0]+(f[2]-f[0])/2,f[1]+(f[3]-f[1])/2];else if(i.geometry?.type==="Point"&&Array.isArray(i.geometry.coordinates))b=[Number(i.geometry.coordinates[0]),Number(i.geometry.coordinates[1])];else{const u=[],Q=s=>{s&&(s.type==="Point"?u.push([+s.coordinates[0],+s.coordinates[1]]):s.type==="LineString"||s.type==="MultiPoint"?s.coordinates.forEach(l=>u.push([+l[0],+l[1]])):s.type==="Polygon"||s.type==="MultiLineString"?s.coordinates.flat(1).forEach(l=>u.push([+l[0],+l[1]])):s.type==="MultiPolygon"?s.coordinates.flat(2).forEach(l=>u.push([+l[0],+l[1]])):s.type==="GeometryCollection"&&(s.geometries||[]).forEach(Q))};if(Q(i.geometry),u.length){const s=u.map(I=>I[0]),l=u.map(I=>I[1]),v=[Math.min(...s),Math.min(...l),Math.max(...s),Math.max(...l)];b=[v[0]+(v[2]-v[0])/2,v[1]+(v[3]-v[1])/2]}else b=[4.4699,50.5039]}o.push({type:"Feature",geometry:{type:"Point",coordinates:b},place_name:i.properties?.display_name,properties:{...i.properties,bbox:f},text:i.properties?.display_name,place_type:["place"],center:b,bbox:f})}}catch(d){console.error("forwardGeocode error:",d)}const r={type:"FeatureCollection",features:o};if(h.size>=50){const d=h.keys().next().value;d!==void 0&&h.delete(d)}return h.set(e,r),r}},C=new ee(K,{maplibregl:y,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});n.addControl(C,"top-left");const R=new ee(K,{maplibregl:y,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});m.addControl(R,"top-left");const U=t=>{const e=t.bbox??t.properties?.bbox;e&&Array.isArray(e)&&e.length===4?n.fitBounds([[e[0],e[1]],[e[2],e[3]]],{padding:50,maxZoom:16,duration:1200}):n.flyTo({center:t.center,zoom:15,duration:1200})};let M=[],p=0;const J=t=>{M=t.features||[],p=0,setTimeout(()=>{const e=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");e.length>0&&(e.forEach(o=>o.classList.remove("active")),e[0].classList.add("active"))},50)};C.on("results",J),R.on("results",J),setTimeout(()=>{const t=document.querySelector(".maplibregl-ctrl-geocoder input");t&&t.addEventListener("keydown",e=>{const o=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(e.key==="Enter"&&M.length>0){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const r=M[p];r&&(U(r),e.target.value="",C.clear(),M=[])}else e.key==="ArrowDown"&&o.length>0?(e.preventDefault(),p=Math.min(p+1,M.length-1),o.forEach(r=>r.classList.remove("active")),o[p]&&o[p].classList.add("active")):e.key==="ArrowUp"&&o.length>0&&(e.preventDefault(),p=Math.max(p-1,0),o.forEach(r=>r.classList.remove("active")),o[p]&&o[p].classList.add("active"))},!0)},100);const V=t=>{const e=t.result;U(e),setTimeout(()=>{C.clear(),R.clear(),document.querySelectorAll(".maplibregl-ctrl-geocoder input").forEach(r=>r.value="")},100)};C.on("result",V),R.on("result",V);const Y=(t,e)=>{a||(a=!0,e.jumpTo({center:t.getCenter(),zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch()}),requestAnimationFrame(()=>{a=!1}))};n.on("move",()=>{a||Y(n,m);const t=n.getCenter();k(j,{lng:t.lng,lat:t.lat}),k(B,n.getZoom()),typeof window<"u"&&(window.location.hash=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${c(B).toFixed(2)}z`)}),m.on("move",()=>{a||Y(m,n)});let P=null;const q=()=>{P||(P=window.setTimeout(()=>{m&&m.resize(),n&&n.resize(),P=null},250))};return setTimeout(q,100),window.addEventListener("resize",q),()=>{window.removeEventListener("resize",q),m.remove(),n.remove()}}),ve();var E=we(),N=re(E);let G;te(N,a=>k(T,a),()=>c(T));var F=Z(N,2);let O;te(F,a=>k(x,a),()=>c(x));var H=Z(F,4),le=Z(H,2);be(le,{get lat(){return c(j).lat},get lng(){return c(j).lng},get zoom(){return c(B)},yearBefore:"ortho-1971",yearAfter:"ortho-2023"}),ae(E),fe((a,h)=>{G=X(N,1,"map-container after svelte-1kjt96t",null,G,a),O=X(F,1,"map-container before svelte-1kjt96t",null,O,h)},[()=>({lens:c(S)}),()=>({lens:!c(S)})]),ye("click",H,ie),ne(_,E),he()}var Ce=se('<div class="map-container svelte-1mf7qal"><!></div>');function Be(_){var w=Ce(),x=re(w);xe(x,{}),ae(w),ne(_,w)}export{Be as component};
