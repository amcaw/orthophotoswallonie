import"../chunks/DsnmJJEf.js";import"../chunks/B4sJI0eo.js";import{M as ge,D as O,F as Q,G as P,O as ye,J as v,I as L,z as o,P as I,Q as m,K as g,av as te,T as fe}from"../chunks/DIJBUjZ_.js";import{o as ve,e as X,s as J}from"../chunks/C9FblJra.js";import{i as he}from"../chunks/BXyouJ3p.js";import{e as we,i as be,s as K}from"../chunks/BjALARFq.js";import{m as R,M as ke,s as xe}from"../chunks/vio3IFUB.js";import{b as Se}from"../chunks/-Mqpy0Mp.js";import{i as Ee}from"../chunks/CyI37tKr.js";import{o as ee}from"../chunks/C4AmPXCP.js";var _e=te('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),Pe=te('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),Te=O('<button><span class="year-label svelte-hmkkg"> </span></button>'),Ce=O('<div class="travel-container svelte-hmkkg"><div class="map-container svelte-hmkkg"></div> <div class="year-overlay svelte-hmkkg"> </div> <div class="playbar svelte-hmkkg"><div class="playbar-controls svelte-hmkkg"><button class="playbar-btn svelte-hmkkg"><!></button></div> <div class="timeline svelte-hmkkg"><div class="timeline-track svelte-hmkkg"><div class="timeline-progress svelte-hmkkg"></div></div> <div class="timeline-years svelte-hmkkg"></div></div></div></div>');function Be(A,S){ge(S,!1);let c=I(),t,x=I(!1),h=I(0),E=null,k=I(0);const re=[[4.243,50.764],[4.482,50.913]];function M(e){const i=ee;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${i.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${i.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}function se(e){const i=e.clientWidth||window.innerWidth,a=e.clientHeight||window.innerHeight,s=Math.round(Math.max(12,Math.min(i,a)*.03)),r=i<768,l=r?120:80;return{top:s+(r?30:40),right:s+10,bottom:s+l,left:s+10}}function W(e){if(!t||!o(c))return;const i=se(o(c));t.resize();const a=o(c).clientWidth||window.innerWidth,s=a<640?9:a<1024?9.5:(a<1300,10);t.setMinZoom(s),t.fitBounds(re,{padding:i,duration:e?.animate?400:0})}const u=ee.orthophotos.map(e=>({year:e.year,displayYear:e.year,layers:[e]}));function Y(){if(!t)return;const e=(o(h)+1)%u.length;u[e].layers.forEach(a=>{t.getSource(a.id)||t.addSource(a.id,{type:"raster",tiles:[M(a)],tileSize:256,maxzoom:20}),t.getLayer(`${a.id}-layer`)||t.addLayer({id:`${a.id}-layer`,type:"raster",source:a.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function ae(){o(x)?T():oe()}function oe(){if(!t)return;m(x,!0),Y();const e=Date.now(),i=o(k)/100*(u.length-1),a=2500,s=1300,r=()=>{if(!o(x))return;const n=(Date.now()-e)/a,y=i+n;if(y>=u.length-1){m(h,u.length-1),m(k,100),T();return}const p=Math.floor(y);m(k,y/(u.length-1)*100),p!==o(h)&&(m(h,p),D(s),Y()),E=window.requestAnimationFrame(r)};E=window.requestAnimationFrame(r)}function T(){m(x,!1),E&&(cancelAnimationFrame(E),E=null);const e=Math.floor(o(k)/100*(u.length-1));e>=0&&e<u.length&&m(h,e)}function ie(e){o(x)&&T();const a=e/(u.length-1)*100,s=o(k),r=Date.now(),l=300,n=()=>{const y=Date.now()-r,p=Math.min(y/l,1),d=1-Math.pow(1-p,3);m(k,s+(a-s)*d),p<1?requestAnimationFrame(n):m(k,a)};m(h,e),D(),n()}function D(e=0){if(!t)return;const i=u[o(h)],a=t.getStyle();if(a?.layers)for(const s of a.layers){if(!s.id.endsWith("-layer"))continue;!i.layers.some(l=>`${l.id}-layer`===s.id)&&t.getLayer(s.id)&&(t.setPaintProperty(s.id,"raster-opacity-transition",{duration:e,delay:0}),t.setPaintProperty(s.id,"raster-opacity",0))}i.layers.forEach(s=>{const r=s.id,l=`${s.id}-layer`;t.getSource(r)||t.addSource(r,{type:"raster",tiles:[M(s)],tileSize:256,maxzoom:20}),t.getLayer(l)||t.addLayer({id:l,type:"raster",source:r,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),i.layers.forEach(s=>{const r=`${s.id}-layer`;t.getLayer(r)&&t.moveLayer(r)}),i.layers.forEach(s=>{const r=`${s.id}-layer`;t.getLayer(r)&&(t.setPaintProperty(r,"raster-opacity-transition",{duration:e,delay:0}),t.setPaintProperty(r,"raster-opacity",1))}),e>0&&setTimeout(()=>{const s=t?.getStyle();if(s?.layers)for(const r of s.layers){if(!r.id.endsWith("-layer"))continue;if(!i.layers.some(n=>`${n.id}-layer`===r.id)){t.getLayer(r.id)&&t.removeLayer(r.id);const n=r.source;n&&t.getSource(n)&&t.removeSource(n)}}},e+100)}ve(()=>{const e=u[0],i={},a=[];e.layers.forEach(d=>{i[d.id]={type:"raster",tiles:[M(d)],tileSize:256,maxzoom:20}}),e.layers.forEach(d=>{a.push({id:`${d.id}-layer`,type:"raster",source:d.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),t=new R.Map({container:o(c),style:{version:8,sources:i,layers:a},maxZoom:20,minZoom:9,preserveDrawingBuffer:!0,attributionControl:!1}),t.addControl(new R.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const s={forwardGeocode:async d=>{const w=[];try{const C=encodeURIComponent((d.query??"").trim());if(!C)return{type:"FeatureCollection",features:w};const pe=`https://nominatim.openstreetmap.org/search?q=${C}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,me=await(await fetch(pe,{headers:{"Accept-Language":"fr"}})).json();for(const f of me.features??[]){const Z=f.properties?.address?.region,B=f.properties?.address?.state;if(!(Z?.includes("Bruxelles")||Z?.includes("Brussels")||B==="Bruxelles-Capitale"||B==="Brussels Hoofdstedelijk Gewest"||B==="Région de Bruxelles-Capitale"||B==="Brussels-Capital"))continue;const N=f.bbox,b=Array.isArray(N)&&N.length===4?N.map(Number):void 0;let _;b?_=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2]:f.geometry?.type==="Point"&&Array.isArray(f.geometry.coordinates)?_=[Number(f.geometry.coordinates[0]),Number(f.geometry.coordinates[1])]:_=[4.3517,50.8503],w.push({type:"Feature",geometry:{type:"Point",coordinates:_},place_name:f.properties?.display_name,properties:{...f.properties,bbox:b},text:f.properties?.display_name,place_type:["place"],center:_,bbox:b})}}catch(C){console.error("forwardGeocode error:",C)}return{type:"FeatureCollection",features:w}}},r=new ke(s,{maplibregl:R,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:200,minLength:2,showResultMarkers:!1});t.addControl(r,"top-left"),t.addControl(new R.NavigationControl,"top-left"),t.once("idle",()=>W({animate:!1}));let l=o(c).clientWidth,n=o(c).clientHeight;const y=new ResizeObserver(()=>{const d=o(c).clientWidth,w=o(c).clientHeight;(d!==l||w!==n)&&(l=d,n=w,W({animate:!1}))});y.observe(o(c));const p=()=>{const d=o(c).clientWidth,w=o(c).clientHeight;(d!==l||w!==n)&&(l=d,n=w,W({animate:!1}))};return setTimeout(()=>t.resize(),100),window.addEventListener("resize",p),window.addEventListener("orientationchange",p),()=>{T(),y.disconnect(),window.removeEventListener("resize",p),window.removeEventListener("orientationchange",p),t.remove()}}),Ee();var G=Ce(),q=v(G);Se(q,e=>m(c,e),()=>o(c));var H=L(q,2),ne=v(H,!0);g(H);var U=L(H,2),z=v(U),$=v(z),le=v($);{var ce=e=>{var i=_e();P(e,i)},de=e=>{var i=Pe();P(e,i)};he(le,e=>{o(x)?e(ce):e(de,!1)})}g($),g(z);var j=L(z,2),F=v(j),ue=v(F);g(F);var V=L(F,2);we(V,5,()=>u,be,(e,i,a)=>{const s=fe(()=>a/(u.length-1)*100);var r=Te();let l;var n=v(r),y=v(n,!0);g(n),g(r),Q(p=>{l=xe(r,1,"year-marker svelte-hmkkg",null,l,p),K(r,`left: ${o(s)??""}%`),J(y,o(i).displayYear)},[()=>({active:a===o(h)})]),X("click",r,()=>ie(a)),P(e,r)}),g(V),g(j),g(U),g(G),Q(()=>{J(ne,u[o(h)].displayYear),K(ue,`width: ${o(k)??""}%`)}),X("click",$,ae),P(A,G),ye()}var Le=O('<div class="page-container svelte-16kfyeo"><!></div>');function Ye(A){var S=Le(),c=v(S);Be(c,{}),g(S),P(A,S)}export{Ye as component};
