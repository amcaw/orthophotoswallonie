import"../chunks/DsnmJJEf.js";import"../chunks/Cflq-a96.js";import{as as Ce,D as ee,F as ue,G as Q,at as Le,z as o,J as A,K as _,I as X,a6 as G,R as I,u as xe,A as Ae,aw as V,av as qe}from"../chunks/Dlg-gMpp.js";import{h as ze}from"../chunks/IuQqTbrd.js";import{c as Pe,e as $,s as we,o as Te}from"../chunks/COQ8bC4V.js";import{e as ke,i as Re,s as pe}from"../chunks/DXLIkSof.js";import{b as le}from"../chunks/5YV8zeCu.js";import{i as Me}from"../chunks/DMWEl-21.js";import{s as ce,o as Be,m as D,M as je}from"../chunks/B22aiAXe.js";import{s as _e}from"../chunks/C074pVVv.js";import{p as de}from"../chunks/B-TxigSj.js";var De=ee('<div role="button" tabindex="0"><div class="circle svelte-7ujlbc"><div class="year-label svelte-7ujlbc"> </div></div></div>'),Ge=ee('<div><button class="expand-button svelte-7ujlbc"> </button> <div></div></div>');function Ee(F,h){Ce(h,!1);let k=de(h,"side",8,"left"),q=de(h,"groups",24,()=>[]),E=de(h,"selectedId",8);const s=Pe();let u=G(!1);function R(B){s("select",{id:B}),I(u,!1)}function C(){I(u,!o(u))}Me();var m=Ge();let W;var L=A(m),z=A(L,!0);_(L);var N=X(L,2);let H;ke(N,5,q,Re,(B,b,te)=>{var M=De();let j;var J=A(M),K=A(J),O=A(K,!0);_(K),_(J),_(M),ue(P=>{j=ce(M,1,"year-circle svelte-7ujlbc",null,j,P),pe(M,`--index: ${te}; --total: ${Ae(q()),xe(()=>q().length)??""}`),we(O,(o(b),xe(()=>o(b).displayYear)))},[()=>({selected:E()===o(b).id,"is-selected-year":E()===o(b).id})]),$("click",M,()=>R(o(b).id)),$("keydown",M,P=>P.key==="Enter"&&R(o(b).id)),Q(B,M)}),_(N),_(m),ue((B,b)=>{W=ce(m,1,"year-picker-wrapper svelte-7ujlbc",null,W,B),_e(m,"data-side",k()),_e(L,"title",o(u)?"Collapse":"Expand"),we(z,o(u)?"−":"+"),H=ce(N,1,"year-circles svelte-7ujlbc",null,H,b)},[()=>({expanded:o(u)}),()=>({expanded:o(u)})]),$("click",L,C),Q(F,m),Le()}var We=ee('<div class="timelapse-container svelte-qt8w5r"><div class="map-wrapper svelte-qt8w5r"><div class="map-container before svelte-qt8w5r"></div> <div class="map-container after svelte-qt8w5r"></div> <div class="compare-slider svelte-qt8w5r"><div class="slider-handle svelte-qt8w5r" role="button" tabindex="0"><span class="slider-arrows svelte-qt8w5r">◄ ►</span></div></div></div> <!> <!></div>');function Ze(F,h){Ce(h,!1);let k=G(),q=G(),E=G(),s,u,R=G(50),C=!1;const m=Be.orthophotos.reduce((e,a)=>{const l=a.year.split(" ")[0],i=e.find(c=>c.year===l);return i?i.layers.push(a):e.push({id:l,year:l,displayYear:l,layers:[a]}),e},[]).map(e=>({...e,layers:e.layers.slice().sort((a,l)=>{const i=c=>/Printemps/i.test(c)?0:/Été|Ete/i.test(c)?1:2;return i(a.year)-i(l.year)})}));let W=G(m[0].id),L=G(m[m.length-1].id),z={};function N(e){e.preventDefault(),e.stopPropagation(),C=!0}function H(e){if(!C||!o(E))return;e.preventDefault();const a=o(E).getBoundingClientRect(),l=e.clientX-a.left;I(R,Math.max(0,Math.min(100,l/a.width*100)))}function B(){C=!1}function b(e){e.preventDefault(),e.stopPropagation(),C=!0}function te(e){if(!C||!o(E))return;e.preventDefault();const a=o(E).getBoundingClientRect(),l=e.touches[0].clientX-a.left;I(R,Math.max(0,Math.min(100,l/a.width*100)))}function M(){C=!1}function j(e,a){const l=e.getStyle();if(l?.layers)for(const i of l.layers){if(!i.id.endsWith("-layer"))continue;e.getLayer(i.id)&&e.removeLayer(i.id);const c=i.source;c&&e.getSource(c)&&e.removeSource(c)}a.layers.forEach(i=>{const c=i.id,T=`${i.id}-layer`;e.getSource(c)||e.addSource(c,{type:"raster",tiles:[`${i.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(T)||e.addLayer({id:T,type:"raster",source:c,paint:{"raster-opacity":0,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),a.layers.forEach(i=>{const c=`${i.id}-layer`;e.getLayer(c)&&e.moveLayer(c)}),a.layers.forEach(i=>{const c=`${i.id}-layer`;e.setPaintProperty(c,"raster-opacity",1)})}function J(e){if(!s)return;const a=m.find(l=>l.id===e);a&&(j(s,a),I(W,e))}function K(e){if(!u)return;const a=m.find(l=>l.id===e);a&&(j(u,a),I(L,e))}Te(()=>{let e=!1;const a=[[2.75,49.45],[6.5,50.85]],l=m.find(r=>r.id===o(W)),i=m.find(r=>r.id===o(L));s=new D.Map({container:o(k),style:{version:8,sources:{},layers:[]},bounds:a,fitBoundsOptions:{padding:0},minZoom:8,maxZoom:17,attributionControl:!1}),u=new D.Map({container:o(q),style:{version:8,sources:{},layers:[]},bounds:a,fitBoundsOptions:{padding:0},minZoom:8,maxZoom:17,interactive:!1,attributionControl:!1}),s.once("load",()=>j(s,l)),u.once("load",()=>j(u,i)),s.addControl(new D.NavigationControl,"bottom-left"),s.addControl(new D.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const c={forwardGeocode:async r=>{const t=[];try{const n=encodeURIComponent((r.query??"").trim());if(!n)return{type:"FeatureCollection",features:t};const v=`https://nominatim.openstreetmap.org/search?q=${n}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,d=await(await fetch(v,{headers:{"Accept-Language":"fr"}})).json(),y=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const p of d.features??[]){const se=p.properties?.address?.state,$e=p.properties?.address?.county;if(!(se==="Wallonie"||se==="Région wallonne"||y.some(w=>$e?.includes(w)||se?.includes(w))))continue;const ne=p.bbox,S=Array.isArray(ne)&&ne.length===4?ne.map(Number):void 0;let Z;if(S)Z=[S[0]+(S[2]-S[0])/2,S[1]+(S[3]-S[1])/2];else if(p.geometry?.type==="Point"&&Array.isArray(p.geometry.coordinates))Z=[Number(p.geometry.coordinates[0]),Number(p.geometry.coordinates[1])];else{const w=[],be=f=>{f&&(f.type==="Point"?w.push([+f.coordinates[0],+f.coordinates[1]]):f.type==="LineString"||f.type==="MultiPoint"?f.coordinates.forEach(g=>w.push([+g[0],+g[1]])):f.type==="Polygon"||f.type==="MultiLineString"?f.coordinates.flat(1).forEach(g=>w.push([+g[0],+g[1]])):f.type==="MultiPolygon"?f.coordinates.flat(2).forEach(g=>w.push([+g[0],+g[1]])):f.type==="GeometryCollection"&&(f.geometries||[]).forEach(be))};if(be(p.geometry),w.length){const f=w.map(ie=>ie[0]),g=w.map(ie=>ie[1]),Y=[Math.min(...f),Math.min(...g),Math.max(...f),Math.max(...g)];Z=[Y[0]+(Y[2]-Y[0])/2,Y[1]+(Y[3]-Y[1])/2]}else Z=[4.4699,50.5039]}t.push({type:"Feature",geometry:{type:"Point",coordinates:Z},place_name:p.properties?.display_name,properties:{...p.properties,bbox:S},text:p.properties?.display_name,place_type:["place"],center:Z,bbox:S})}}catch(n){console.error("forwardGeocode error:",n)}return{type:"FeatureCollection",features:t}}},T=new je(c,{maplibregl:D,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:200,minLength:2,showResultMarkers:!1});s.addControl(T,"top-left");const ve=r=>{const t=r.bbox??r.properties?.bbox;t&&Array.isArray(t)&&t.length===4?s.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):s.flyTo({center:r.center,zoom:15,duration:1200})};let U=[],x=0;T.on("results",r=>{U=r.features||[],x=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(n=>n.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const r=document.querySelector(".maplibregl-ctrl-geocoder input");r&&r.addEventListener("keydown",t=>{const n=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&U.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const v=U[x];v&&(ve(v),t.target.value="",T.clear(),U=[])}else t.key==="ArrowDown"&&n.length>0?(t.preventDefault(),x=Math.min(x+1,U.length-1),n.forEach(v=>v.classList.remove("active")),n[x]&&n[x].classList.add("active")):t.key==="ArrowUp"&&n.length>0&&(t.preventDefault(),x=Math.max(x-1,0),n.forEach(v=>v.classList.remove("active")),n[x]&&n[x].classList.add("active"))},!0)},100),T.on("result",r=>{const t=r.result;ve(t),setTimeout(()=>{const n=document.querySelector(".maplibregl-ctrl-geocoder input");n&&(n.value=""),T.clear()},100)});const Ie=(r,t)=>{e||(e=!0,t.jumpTo({center:r.getCenter(),zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch()}),requestAnimationFrame(()=>{e=!1}))};s.on("move",()=>{!C&&!e&&(Ie(s,u),Object.values(z).forEach(r=>{r.jumpTo({center:s.getCenter(),zoom:s.getZoom(),bearing:s.getBearing(),pitch:s.getPitch()})}))});const ge=()=>{m.forEach(r=>{const t=`before-${r.id}`,n=document.getElementById(`mini-${t}`);if(n&&!z[t])try{const d=new D.Map({container:n,style:{version:8,sources:{},layers:[]},center:s.getCenter(),zoom:s.getZoom(),interactive:!1,attributionControl:!1});d.once("load",()=>{r.layers.forEach(y=>{d.addSource(y.id,{type:"raster",tiles:[`${y.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),d.addLayer({id:`${y.id}-layer`,type:"raster",source:y.id,paint:{"raster-opacity":1,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),r.layers.forEach(y=>{const p=`${y.id}-layer`;d.getLayer(p)&&d.moveLayer(p)})}),z[t]=d}catch(d){console.error("Error creating before minimap:",t,d)}const v=`after-${r.id}`,ae=document.getElementById(`mini-${v}`);if(ae&&!z[v])try{const d=new D.Map({container:ae,style:{version:8,sources:{},layers:[]},center:u.getCenter(),zoom:u.getZoom(),interactive:!1,attributionControl:!1});d.once("load",()=>{r.layers.forEach(y=>{d.addSource(y.id,{type:"raster",tiles:[`${y.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),d.addLayer({id:`${y.id}-layer`,type:"raster",source:y.id,paint:{"raster-opacity":1,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),r.layers.forEach(y=>{const p=`${y.id}-layer`;d.getLayer(p)&&d.moveLayer(p)})}),z[v]=d}catch(d){console.error("Error creating after minimap:",v,d)}})};setTimeout(ge,500);const he=setInterval(()=>{ge()},1e3);return setTimeout(()=>clearInterval(he),1e4),()=>{clearInterval(he),s.remove(),u.remove(),Object.values(z).forEach(r=>r.remove())}}),Me();var O=We();$("mousemove",V,H),$("mouseup",V,B),$("touchmove",V,te),$("touchend",V,M);var P=A(O),fe=A(P);le(fe,e=>I(k,e),()=>o(k));var re=X(fe,2);le(re,e=>I(q,e),()=>o(q));var oe=X(re,2),me=A(oe);_(oe),_(P),le(P,e=>I(E,e),()=>o(E));var ye=X(P,2);Ee(ye,{side:"left",get groups(){return m},get selectedId(){return o(W)},$$events:{select:e=>J(e.detail.id)}});var Se=X(ye,2);Ee(Se,{side:"right",get groups(){return m},get selectedId(){return o(L)},$$events:{select:e=>K(e.detail.id)}}),_(O),ue(()=>{pe(re,`clip-path: inset(0 0 0 ${o(R)??""}%)`),pe(oe,`left: ${o(R)??""}%`)}),$("mousedown",me,N),$("touchstart",me,b),Q(F,O),Le()}var Ye=ee('<div class="page-container svelte-q4ucql"><!></div>');function rt(F){var h=Ye();ze(q=>{qe.title="Timelapse - Comparaison d'orthophotos"});var k=A(h);Ze(k,{}),_(h),Q(F,h)}export{rt as component};
