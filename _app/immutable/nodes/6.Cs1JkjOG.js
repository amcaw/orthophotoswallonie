import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Le,A as te,B as pe,C as R,J as Ie,F as x,w as s,D as $,K as L,M as m,G as w,an as ve,P as ze}from"../chunks/Ehb9Q6W5.js";import{o as Ae,e as me,s as ge}from"../chunks/BKIJojkU.js";import{i as $e}from"../chunks/Im4b7-9j.js";import{e as Re,i as Fe,s as fe}from"../chunks/yJVuIktW.js";import{S as Me,m as W,M as Ge,s as He}from"../chunks/VYvS0YDk.js";import{b as Ne}from"../chunks/m2zDNTuv.js";import{i as We}from"../chunks/D631TkqT.js";import{o as ye}from"../chunks/C4AmPXCP.js";var De=ve('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),Ue=ve('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),Ye=te('<button><span class="year-label svelte-hmkkg"> </span></button>'),qe=te('<div class="travel-container svelte-hmkkg"><div class="map-container svelte-hmkkg"></div> <div class="year-overlay svelte-hmkkg"> </div> <div class="share-wrapper-traveltime svelte-hmkkg"><!></div> <div class="playbar svelte-hmkkg"><div class="playbar-controls svelte-hmkkg"><button class="playbar-btn svelte-hmkkg"><!></button></div> <div class="timeline svelte-hmkkg"><div class="timeline-track svelte-hmkkg"><div class="timeline-progress svelte-hmkkg"></div></div> <div class="timeline-years svelte-hmkkg"></div></div></div></div>');function Oe(D,I){Le(I,!1);let f=L(),e,B=L(!1),v=L(0),z=null,k=L(0),U=L({lng:4.35,lat:50.85}),re=L(11);const he=[[4.243,50.764],[4.482,50.913]],we=[[4.05,50.65],[4.68,51.05]];function F(t){const o=ye;return t.service==="urban-brussels"&&t.crs==="EPSG:31370"?`${o.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${t.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${o.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${t.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}function be(t){const o=t.clientWidth||window.innerWidth,n=t.clientHeight||window.innerHeight,l=Math.round(Math.max(12,Math.min(o,n)*.03)),r=o<768,h=r?120:80;return{top:l+(r?30:40),right:l+10,bottom:l+h,left:l+10}}function se(t){if(!e||!s(f))return;const o=be(s(f));e.resize();const n=s(f).clientWidth||window.innerWidth,l=n<640?9:n<1024?9.5:(n<1300,10);e.setMinZoom(l),e.fitBounds(he,{padding:o,duration:t?.animate?400:0})}const i=ye.orthophotos.map(t=>({id:t.id,year:t.year,displayYear:t.year,layers:[t]}));function ae(){if(!e)return;const t=(s(v)+1)%i.length;i[t].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[F(r)],tileSize:256,maxzoom:20}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})});const n=(s(v)-1+i.length)%i.length;i[n].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[F(r)],tileSize:256,maxzoom:20}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function xe(){s(B)?M():Se()}function Se(){if(!e)return;m(B,!0),ae();const t=Date.now(),o=s(k)/100*(i.length-1),n=2500,l=1300,r=()=>{if(!s(B))return;const y=(Date.now()-t)/n,b=o+y;if(b>=i.length-1){m(v,i.length-1),m(k,100),M();return}const g=Math.floor(b);m(k,b/(i.length-1)*100),g!==s(v)&&(m(v,g),oe(l),ae()),z=window.requestAnimationFrame(r)};z=window.requestAnimationFrame(r)}function M(){m(B,!1),z&&(cancelAnimationFrame(z),z=null);const t=Math.floor(s(k)/100*(i.length-1));t>=0&&t<i.length&&m(v,t)}let Y=null;function ke(t){s(B)&&M();const n=t/(i.length-1)*100,l=s(k),r=Date.now(),h=300,y=()=>{const b=Date.now()-r,g=Math.min(b/h,1),a=1-Math.pow(1-g,3);m(k,l+(n-l)*a),g<1?requestAnimationFrame(y):m(k,n)};m(v,t),oe(),y(),Y&&Y(!0)}function oe(t=0){if(!e)return;const o=i[s(v)],n=e.getStyle();if(n?.layers)for(const a of n.layers){if(!a.id.endsWith("-layer"))continue;!o.layers.some(_=>`${_.id}-layer`===a.id)&&e.getLayer(a.id)&&(e.setPaintProperty(a.id,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(a.id,"raster-opacity",0))}o.layers.forEach(a=>{const d=a.id,_=`${a.id}-layer`;e.getSource(d)||e.addSource(d,{type:"raster",tiles:[F(a)],tileSize:256,maxzoom:20}),e.getLayer(_)||e.addLayer({id:_,type:"raster",source:d,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),o.layers.forEach(a=>{const d=`${a.id}-layer`;e.getLayer(d)&&e.moveLayer(d)});const l=o.layers.map(a=>`${a.id}-layer`);let r=0;const h=l.length,y=()=>{l.forEach(a=>{e.getLayer(a)&&(e.setPaintProperty(a,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(a,"raster-opacity",1))})},b=()=>{r++,r>=h&&y()},g=a=>{a.isSourceLoaded&&a.sourceId&&o.layers.some(d=>d.id===a.sourceId)&&b()};e.on("sourcedata",g),setTimeout(()=>{e.off("sourcedata",g),y()},t>0?t+1e3:1e3),t>0&&setTimeout(()=>{const a=e?.getStyle();if(a?.layers)for(const d of a.layers){if(!d.id.endsWith("-layer"))continue;if(!o.layers.some(E=>`${E.id}-layer`===d.id)){e.getLayer(d.id)&&e.removeLayer(d.id);const E=d.source;E&&e.getSource(E)&&e.removeSource(E)}}},t+100)}Ae(async()=>{let t=null;const o=()=>{if(typeof window>"u")return!1;const c=window.location.hash.slice(1);if(!c)return!1;const u=c.split(",");if(u.length>=3){const C=parseFloat(u[0]),P=parseFloat(u[1]),p=parseFloat(u[2].replace("z",""));if(!isNaN(C)&&!isNaN(P)&&!isNaN(p)){if(t={center:[P,C],zoom:p},u.length>=4){const X=u[3],H=i.findIndex(J=>J.id===X);H!==-1&&(m(v,H),m(k,H/(i.length-1)*100))}return!0}}return!1};o()||(await new Promise(c=>setTimeout(c,10)),o());const n=new Map,l=i[0],r={},h=[];l.layers.forEach(c=>{r[c.id]={type:"raster",tiles:[F(c)],tileSize:256,maxzoom:20}}),l.layers.forEach(c=>{h.push({id:`${c.id}-layer`,type:"raster",source:c.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),e=new W.Map({container:s(f),style:{version:8,sources:r,layers:h},...t?{center:t.center,zoom:t.zoom}:{},maxZoom:20,minZoom:9,maxBounds:we,preserveDrawingBuffer:!0,attributionControl:!1}),e.addControl(new W.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const y={forwardGeocode:async c=>{const u=(c.query??"").trim().toLowerCase();if(n.has(u))return n.get(u);const C=[];try{const p=encodeURIComponent(u);if(!p)return{type:"FeatureCollection",features:C};const X=`https://nominatim.openstreetmap.org/search?q=${p}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,J=await(await fetch(X,{headers:{"Accept-Language":"fr"}})).json();for(const S of J.features??[]){const ue=S.properties?.address?.region,N=S.properties?.address?.state;if(!(ue?.includes("Bruxelles")||ue?.includes("Brussels")||N==="Bruxelles-Capitale"||N==="Brussels Hoofdstedelijk Gewest"||N==="Région de Bruxelles-Capitale"||N==="Brussels-Capital"))continue;const ee=S.bbox,T=Array.isArray(ee)&&ee.length===4?ee.map(Number):void 0;let A;T?A=[T[0]+(T[2]-T[0])/2,T[1]+(T[3]-T[1])/2]:S.geometry?.type==="Point"&&Array.isArray(S.geometry.coordinates)?A=[Number(S.geometry.coordinates[0]),Number(S.geometry.coordinates[1])]:A=[4.3517,50.8503],C.push({type:"Feature",geometry:{type:"Point",coordinates:A},place_name:S.properties?.display_name,properties:{...S.properties,bbox:T},text:S.properties?.display_name,place_type:["place"],center:A,bbox:T})}}catch(p){console.error("forwardGeocode error:",p)}const P={type:"FeatureCollection",features:C};if(n.size>=50){const p=n.keys().next().value;p!==void 0&&n.delete(p)}return n.set(u,P),P}},b=new Ge(y,{maplibregl:W,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});e.addControl(b,"top-left"),e.addControl(new W.NavigationControl,"top-left");let g=null,a="";const d=(c=!1)=>{if(typeof window>"u"||!e)return;const u=e.getCenter(),C=e.getZoom(),P=i[s(v)]?.id,p=P?`${u.lat.toFixed(6)},${u.lng.toFixed(6)},${C.toFixed(2)}z,${P}`:`${u.lat.toFixed(6)},${u.lng.toFixed(6)},${C.toFixed(2)}z`;p!==a&&(a=p,c?window.location.hash=p:history.replaceState(null,"",`#${p}`))};Y=d,e.on("move",()=>{const c=e.getCenter();m(U,{lng:c.lng,lat:c.lat}),m(re,e.getZoom()),d(!1),g&&clearTimeout(g),g=window.setTimeout(()=>{d(!0)},1e3)}),t||e.once("idle",()=>se({animate:!1}));let _=s(f).clientWidth,E=s(f).clientHeight;const de=new ResizeObserver(()=>{const c=s(f).clientWidth,u=s(f).clientHeight;(c!==_||u!==E)&&(_=c,E=u,se({animate:!1}))});de.observe(s(f));let Q=null;const G=()=>{Q||(Q=window.setTimeout(()=>{e&&e.resize(),Q=null},250))};return setTimeout(()=>e.resize(),100),window.addEventListener("resize",G),window.addEventListener("orientationchange",G),()=>{M(),de.disconnect(),window.removeEventListener("resize",G),window.removeEventListener("orientationchange",G),e.remove()}}),We();var q=qe(),ne=x(q);Ne(ne,t=>m(f,t),()=>s(f));var O=$(ne,2),Ce=x(O,!0);w(O);var j=$(O,2),Te=x(j);Me(Te,{get lat(){return s(U).lat},get lng(){return s(U).lng},get zoom(){return s(re)}}),w(j);var ie=$(j,2),Z=x(ie),V=x(Z),_e=x(V);{var Ee=t=>{var o=De();R(t,o)},Pe=t=>{var o=Ue();R(t,o)};$e(_e,t=>{s(B)?t(Ee):t(Pe,!1)})}w(V),w(Z);var le=$(Z,2),K=x(le),Be=x(K);w(K);var ce=$(K,2);Re(ce,5,()=>i,Fe,(t,o,n)=>{const l=ze(()=>n/(i.length-1)*100);var r=Ye();let h;var y=x(r),b=x(y,!0);w(y),w(r),pe(g=>{h=He(r,1,"year-marker svelte-hmkkg",null,h,g),fe(r,`left: ${s(l)??""}%`),ge(b,s(o).displayYear)},[()=>({active:n===s(v)})]),me("click",r,()=>ke(n)),R(t,r)}),w(ce),w(le),w(ie),w(q),pe(()=>{ge(Ce,i[s(v)].displayYear),fe(Be,`width: ${s(k)??""}%`)}),me("click",V,xe),R(D,q),Ie()}var je=te('<div class="page-container svelte-16kfyeo"><!></div>');function ot(D){var I=je(),f=x(I);Oe(f,{}),w(I),R(D,I)}export{ot as component};
