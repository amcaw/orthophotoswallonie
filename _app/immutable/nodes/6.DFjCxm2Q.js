import"../chunks/DsnmJJEf.js";import"../chunks/CQmyZwkG.js";import{I as Ie,A as te,B as me,C as M,J as ze,F as k,w as s,D as N,K as I,M as f,G as b,am as we,P as Ae}from"../chunks/CwdBl0A7.js";import{o as Fe,e as ge,s as ye}from"../chunks/CFz4bSAm.js";import{i as $e}from"../chunks/JAd6ih3G.js";import{e as Re,i as Ne,s as he}from"../chunks/RwkDEKZ4.js";import{S as Me,m as U,M as He,s as Ge}from"../chunks/DdJ4ZmzT.js";import{b as We}from"../chunks/Cgb6JafD.js";import{i as De}from"../chunks/Ci2bA8W4.js";import{o as ve}from"../chunks/C4AmPXCP.js";var Ue=we('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),Ye=we('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),qe=te('<button><span class="year-label svelte-hmkkg"> </span></button>'),Oe=te('<div class="travel-container svelte-hmkkg"><div class="map-container svelte-hmkkg"></div> <div class="year-overlay svelte-hmkkg"> </div> <div class="share-wrapper-traveltime svelte-hmkkg"><!></div> <div class="playbar svelte-hmkkg"><div class="playbar-controls svelte-hmkkg"><button class="playbar-btn svelte-hmkkg"><!></button></div> <div class="timeline svelte-hmkkg"><div class="timeline-track svelte-hmkkg"><div class="timeline-progress svelte-hmkkg"></div></div> <div class="timeline-years svelte-hmkkg"></div></div></div></div>');function je(Y,z){Ie(z,!1);let g=I(),e,B=I(!1),y=I(0),A=null,E=I(0),q=I({lng:4.35,lat:50.85}),re=I(11);const be=[[4.243,50.764],[4.482,50.913]],xe=[[4.05,50.65],[4.68,51.05]];function H(t){const n=ve;return t.service==="urban-brussels"&&t.crs==="EPSG:31370"?`${n.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${t.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${n.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${t.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}function Se(t){const n=t.clientWidth||window.innerWidth,o=t.clientHeight||window.innerHeight,d=Math.round(Math.max(12,Math.min(n,o)*.03)),r=n<768,v=r?120:80;return{top:d+(r?30:40),right:d+10,bottom:d+v,left:d+10}}function se(t){if(!e||!s(g))return;const n=Se(s(g));e.resize();const o=s(g).clientWidth||window.innerWidth,d=o<640?9:o<1024?9.5:(o<1300,10);e.setMinZoom(d),e.fitBounds(be,{padding:n,duration:t?.animate?400:0})}const c=ve.orthophotos.map(t=>({id:t.id,year:t.year,displayYear:t.year,layers:[t]}));function ae(){if(!e)return;const t=(s(y)+1)%c.length;c[t].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[H(r)],tileSize:256,maxzoom:20}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})});const o=(s(y)-1+c.length)%c.length;c[o].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[H(r)],tileSize:256,maxzoom:20}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function ke(){s(B)?G():Ce()}function Ce(){if(!e)return;f(B,!0),ae();const t=Date.now(),n=s(E)/100*(c.length-1),o=2500,d=1300,r=()=>{if(!s(B))return;const h=(Date.now()-t)/o,x=n+h;if(x>=c.length-1){f(y,c.length-1),f(E,100),G();return}const m=Math.floor(x);f(E,x/(c.length-1)*100),m!==s(y)&&(f(y,m),oe(d),ae()),A=window.requestAnimationFrame(r)};A=window.requestAnimationFrame(r)}function G(){f(B,!1),A&&(cancelAnimationFrame(A),A=null);const t=Math.floor(s(E)/100*(c.length-1));t>=0&&t<c.length&&f(y,t)}let O=null;function ne(t){s(B)&&G();const o=t/(c.length-1)*100,d=s(E),r=Date.now(),v=300,h=()=>{const x=Date.now()-r,m=Math.min(x/v,1),a=1-Math.pow(1-m,3);f(E,d+(o-d)*a),m<1?requestAnimationFrame(h):f(E,o)};f(y,t),oe(),h(),O&&O(!0)}function oe(t=0){if(!e)return;const n=c[s(y)],o=e.getStyle();if(o?.layers)for(const a of o.layers){if(!a.id.endsWith("-layer"))continue;!n.layers.some(_=>`${_.id}-layer`===a.id)&&e.getLayer(a.id)&&(e.setPaintProperty(a.id,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(a.id,"raster-opacity",0))}n.layers.forEach(a=>{const u=a.id,_=`${a.id}-layer`;e.getSource(u)||e.addSource(u,{type:"raster",tiles:[H(a)],tileSize:256,maxzoom:20}),e.getLayer(_)||e.addLayer({id:_,type:"raster",source:u,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),n.layers.forEach(a=>{const u=`${a.id}-layer`;e.getLayer(u)&&e.moveLayer(u)});const d=n.layers.map(a=>`${a.id}-layer`);let r=0;const v=d.length,h=()=>{d.forEach(a=>{e.getLayer(a)&&(e.setPaintProperty(a,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(a,"raster-opacity",1))})},x=()=>{r++,r>=v&&h()},m=a=>{a.isSourceLoaded&&a.sourceId&&n.layers.some(u=>u.id===a.sourceId)&&x()};e.on("sourcedata",m),setTimeout(()=>{e.off("sourcedata",m),h()},t>0?t+1e3:1e3),t>0&&setTimeout(()=>{const a=e?.getStyle();if(a?.layers)for(const u of a.layers){if(!u.id.endsWith("-layer"))continue;if(!n.layers.some(L=>`${L.id}-layer`===u.id)){e.getLayer(u.id)&&e.removeLayer(u.id);const L=u.source;L&&e.getSource(L)&&e.removeSource(L)}}},t+100)}Fe(async()=>{let t=null;const n=()=>{if(typeof window>"u")return!1;const l=window.location.hash.slice(1);if(!l)return!1;const i=l.split(",");if(i.length>=3){const w=parseFloat(i[0]),S=parseFloat(i[1]),p=parseFloat(i[2].replace("z",""));if(!isNaN(w)&&!isNaN(S)&&!isNaN(p)){if(t={center:[S,w],zoom:p},i.length>=4){const F=i[3],P=c.findIndex($=>$.id===F);P!==-1&&(f(y,P),f(E,P/(c.length-1)*100))}return!0}}return!1};n()||(await new Promise(l=>setTimeout(l,10)),n());const o=new Map,d=c[0],r={},v=[];d.layers.forEach(l=>{r[l.id]={type:"raster",tiles:[H(l)],tileSize:256,maxzoom:20}}),d.layers.forEach(l=>{v.push({id:`${l.id}-layer`,type:"raster",source:l.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),e=new U.Map({container:s(g),style:{version:8,sources:r,layers:v},...t?{center:t.center,zoom:t.zoom}:{},maxZoom:20,minZoom:9,maxBounds:xe,preserveDrawingBuffer:!0,attributionControl:!1}),e.addControl(new U.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const h={forwardGeocode:async l=>{const i=(l.query??"").trim().toLowerCase();if(o.has(i))return o.get(i);const w=[];try{const p=encodeURIComponent(i);if(!p)return{type:"FeatureCollection",features:w};const F=`https://nominatim.openstreetmap.org/search?q=${p}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,$=await(await fetch(F,{headers:{"Accept-Language":"fr"}})).json();for(const C of $.features??[]){const fe=C.properties?.address?.region,D=C.properties?.address?.state;if(!(fe?.includes("Bruxelles")||fe?.includes("Brussels")||D==="Bruxelles-Capitale"||D==="Brussels Hoofdstedelijk Gewest"||D==="Région de Bruxelles-Capitale"||D==="Brussels-Capital"))continue;const ee=C.bbox,T=Array.isArray(ee)&&ee.length===4?ee.map(Number):void 0;let R;T?R=[T[0]+(T[2]-T[0])/2,T[1]+(T[3]-T[1])/2]:C.geometry?.type==="Point"&&Array.isArray(C.geometry.coordinates)?R=[Number(C.geometry.coordinates[0]),Number(C.geometry.coordinates[1])]:R=[4.3517,50.8503],w.push({type:"Feature",geometry:{type:"Point",coordinates:R},place_name:C.properties?.display_name,properties:{...C.properties,bbox:T},text:C.properties?.display_name,place_type:["place"],center:R,bbox:T})}}catch(p){console.error("forwardGeocode error:",p)}const S={type:"FeatureCollection",features:w};if(o.size>=50){const p=o.keys().next().value;p!==void 0&&o.delete(p)}return o.set(i,S),S}},x=new He(h,{maplibregl:U,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});e.addControl(x,"top-left"),e.addControl(new U.NavigationControl,"top-left");let m=null,a="";const u=(l=!1)=>{if(typeof window>"u"||!e)return;const i=e.getCenter(),w=e.getZoom(),S=c[s(y)]?.id,p=S?`${i.lat.toFixed(6)},${i.lng.toFixed(6)},${w.toFixed(2)}z,${S}`:`${i.lat.toFixed(6)},${i.lng.toFixed(6)},${w.toFixed(2)}z`;p!==a&&(a=p,l?window.location.hash=p:history.replaceState(null,"",`#${p}`))};O=u,e.on("move",()=>{const l=e.getCenter();f(q,{lng:l.lng,lat:l.lat}),f(re,e.getZoom()),u(!1),m&&clearTimeout(m),m=window.setTimeout(()=>{u(!0)},1e3)}),t||e.once("idle",()=>se({animate:!1}));let _=s(g).clientWidth,L=s(g).clientHeight;const ue=new ResizeObserver(()=>{const l=s(g).clientWidth,i=s(g).clientHeight;(l!==_||i!==L)&&(_=l,L=i,se({animate:!1}))});ue.observe(s(g));let J=null;const W=()=>{J||(J=window.setTimeout(()=>{e&&e.resize(),J=null},250))};setTimeout(()=>e.resize(),100),window.addEventListener("resize",W),window.addEventListener("orientationchange",W);const pe=()=>{if(typeof window>"u")return;const l=window.location.hash.slice(1);if(!l)return;const i=l.split(",");if(i.length>=3){const w=parseFloat(i[0]),S=parseFloat(i[1]),p=parseFloat(i[2].replace("z",""));if(!isNaN(w)&&!isNaN(S)&&!isNaN(p)&&(e&&e.flyTo({center:[S,w],zoom:p,duration:1e3}),i.length>=4)){const F=i[3],P=c.findIndex($=>$.id===F);P!==-1&&P!==s(y)&&ne(P)}}};return window.addEventListener("hashchange",pe),()=>{G(),ue.disconnect(),window.removeEventListener("resize",W),window.removeEventListener("orientationchange",W),window.removeEventListener("hashchange",pe),e.remove()}}),De();var j=Oe(),ie=k(j);We(ie,t=>f(g,t),()=>s(g));var Z=N(ie,2),Ee=k(Z,!0);b(Z);var V=N(Z,2),Te=k(V);Me(Te,{get lat(){return s(q).lat},get lng(){return s(q).lng},get zoom(){return s(re)}}),b(V);var le=N(V,2),K=k(le),Q=k(K),_e=k(Q);{var Le=t=>{var n=Ue();M(t,n)},Pe=t=>{var n=Ye();M(t,n)};$e(_e,t=>{s(B)?t(Le):t(Pe,!1)})}b(Q),b(K);var ce=N(K,2),X=k(ce),Be=k(X);b(X);var de=N(X,2);Re(de,5,()=>c,Ne,(t,n,o)=>{const d=Ae(()=>o/(c.length-1)*100);var r=qe();let v;var h=k(r),x=k(h,!0);b(h),b(r),me(m=>{v=Ge(r,1,"year-marker svelte-hmkkg",null,v,m),he(r,`left: ${s(d)??""}%`),ye(x,s(n).displayYear)},[()=>({active:o===s(y)})]),ge("click",r,()=>ne(o)),M(t,r)}),b(de),b(ce),b(le),b(j),me(()=>{ye(Ee,c[s(y)].displayYear),he(Be,`width: ${s(E)??""}%`)}),ge("click",Q,ke),M(Y,j),ze()}var Ze=te('<div class="page-container svelte-16kfyeo"><!></div>');function ot(Y){var z=Ze(),g=k(z);je(g,{}),b(z),M(Y,z)}export{ot as component};
