import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Le,A as V,B as ie,C as E,J as Pe,F as b,w as s,D as A,K as F,M as f,G as w,an as pe,P as Ce,ao as Fe}from"../chunks/Ehb9Q6W5.js";import{o as Ie,e as le,s as ce,h as je}from"../chunks/BKIJojkU.js";import{i as Te}from"../chunks/Im4b7-9j.js";import{e as We,i as Ae,s as de}from"../chunks/yJVuIktW.js";import{S as Ee,m as B,M as Me,s as Re}from"../chunks/VYvS0YDk.js";import{b as ke}from"../chunks/m2zDNTuv.js";import{i as Be}from"../chunks/D631TkqT.js";import{o as Ge}from"../chunks/CUZUMNKG.js";var Ne=pe('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),qe=pe('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),He=V('<button><span class="year-label svelte-wish1j"> </span></button>'),De=V('<div class="travel-container svelte-wish1j"><div class="map-container svelte-wish1j"></div> <div class="year-overlay svelte-wish1j"> </div> <div class="share-wrapper-traveltime svelte-wish1j"><!></div> <div class="playbar svelte-wish1j"><div class="playbar-controls svelte-wish1j"><button class="playbar-btn svelte-wish1j"><!></button></div> <div class="timeline svelte-wish1j"><div class="timeline-track svelte-wish1j"><div class="timeline-progress svelte-wish1j"></div></div> <div class="timeline-years svelte-wish1j"></div></div></div></div>');function Ze(G,I){Le(I,!1);let y=F(),e,P=F(!1),h=F(0),j=null,S=F(0),N=F({lng:4.5,lat:50.5}),M=F(8);const ue=[[2.75,49.45],[6.5,50.85]],fe=[[2,49],[7.2,51.3]];function me(t){const o=t.clientWidth||window.innerWidth,n=t.clientHeight||window.innerHeight,i=Math.round(Math.max(12,Math.min(o,n)*.03)),r=o<768,v=r?120:80;return{top:i+(r?30:40),right:i+10,bottom:i+v,left:i+10}}function X(t){if(!e||!s(y))return;const o=me(s(y));e.resize();const n=s(y).clientWidth||window.innerWidth,i=n<640?5.5:n<1024?6:n<1300?6.5:7;e.setMinZoom(i);const r={top:o.top-50,right:o.right-50,bottom:o.bottom-50,left:o.left-50};e.fitBounds(ue,{padding:r,duration:t?.animate?400:0})}const c=Ge.orthophotos.reduce((t,o)=>{const n=o.year.split(" ")[0],i=t.find(r=>r.year===n);return i?i.layers.push(o):t.push({year:n,displayYear:n,layers:[o]}),t},[]).map(t=>({...t,layers:t.layers.slice().sort((o,n)=>{const i=r=>/Printemps/i.test(r)?0:/Été|Ete/i.test(r)?1:2;return i(o.year)-i(n.year)})}));function ee(){if(!e)return;const t=(s(h)+1)%c.length;c[t].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[`${r.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})});const n=(s(h)-1+c.length)%c.length;c[n].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[`${r.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function ye(){s(P)?R():ge()}function ge(){if(!e)return;f(P,!0),ee();const t=Date.now(),o=s(S)/100*(c.length-1),n=2500,i=1300,r=()=>{if(!s(P))return;const g=(Date.now()-t)/n,m=o+g;if(m>=c.length-1){f(h,c.length-1),f(S,100),R();return}const u=Math.floor(m);f(S,m/(c.length-1)*100),u!==s(h)&&(f(h,u),te(i),ee()),j=window.requestAnimationFrame(r)};j=window.requestAnimationFrame(r)}function R(){f(P,!1),j&&(cancelAnimationFrame(j),j=null);const t=Math.floor(s(S)/100*(c.length-1));t>=0&&t<c.length&&f(h,t)}function he(t){s(P)&&R();const n=t/(c.length-1)*100,i=s(S),r=Date.now(),v=300,g=()=>{const m=Date.now()-r,u=Math.min(m/v,1),a=1-Math.pow(1-u,3);f(S,i+(n-i)*a),u<1?requestAnimationFrame(g):f(S,n)};if(f(h,t),te(),g(),typeof window<"u"&&e){const m=e.getCenter(),u=e.getZoom(),a=c[t]?.id;a&&(window.location.hash=`${m.lat.toFixed(6)},${m.lng.toFixed(6)},${u.toFixed(2)}z,${a}`)}}function te(t=0){if(!e)return;const o=c[s(h)],n=e.getStyle();if(n?.layers)for(const a of n.layers){if(!a.id.endsWith("-layer"))continue;!o.layers.some($=>`${$.id}-layer`===a.id)&&e.getLayer(a.id)&&(e.setPaintProperty(a.id,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(a.id,"raster-opacity",0))}o.layers.forEach(a=>{const d=a.id,$=`${a.id}-layer`;e.getSource(d)||e.addSource(d,{type:"raster",tiles:[`${a.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer($)||e.addLayer({id:$,type:"raster",source:d,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),o.layers.forEach(a=>{const d=`${a.id}-layer`;e.getLayer(d)&&e.moveLayer(d)});const i=o.layers.map(a=>`${a.id}-layer`);let r=0;const v=i.length,g=()=>{i.forEach(a=>{e.getLayer(a)&&(e.setPaintProperty(a,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(a,"raster-opacity",1))})},m=()=>{r++,r>=v&&g()},u=a=>{a.isSourceLoaded&&a.sourceId&&o.layers.some(d=>d.id===a.sourceId)&&m()};e.on("sourcedata",u),setTimeout(()=>{e.off("sourcedata",u),g()},t>0?t+1e3:1e3),t>0&&setTimeout(()=>{const a=e?.getStyle();if(a?.layers)for(const d of a.layers){if(!d.id.endsWith("-layer"))continue;if(!o.layers.some(x=>`${x.id}-layer`===d.id)){e.getLayer(d.id)&&e.removeLayer(d.id);const x=d.source;x&&e.getSource(x)&&e.removeSource(x)}}},t+100)}Ie(async()=>{const t=new Map,o=c[0];let n=null;const i=()=>{if(typeof window>"u")return!1;const l=window.location.hash.slice(1);if(!l)return!1;const p=l.split(",");if(p.length>=3){const C=parseFloat(p[0]),T=parseFloat(p[1]),_=parseFloat(p[2].replace("z",""));if(!isNaN(C)&&!isNaN(T)&&!isNaN(_)){if(n={center:[T,C],zoom:_},p.length>=4){const K=p[3],k=c.findIndex(J=>J.id===K);k!==-1&&(f(h,k),f(S,k/(c.length-1)*100))}return!0}}return!1};i()||(await new Promise(l=>setTimeout(l,10)),i());const r={},v=[];o.layers.forEach(l=>{r[l.id]={type:"raster",tiles:[`${l.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}}),o.layers.forEach(l=>{v.push({id:`${l.id}-layer`,type:"raster",source:l.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),e=new B.Map({container:s(y),style:{version:8,sources:r,layers:v},...n?{center:n.center,zoom:n.zoom}:{},maxZoom:16,minZoom:5,maxBounds:fe,preserveDrawingBuffer:!0,attributionControl:!1}),e.addControl(new B.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const g={forwardGeocode:async l=>{const p=(l.query??"").trim().toLowerCase();if(t.has(p))return t.get(p);const C=[];try{const _=encodeURIComponent(p);if(!_)return{type:"FeatureCollection",features:C};const K=`https://nominatim.openstreetmap.org/search?q=${_}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,J=await(await fetch(K,{headers:{"Accept-Language":"fr"}})).json(),Se=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const z of J.features??[]){const U=z.properties?.address?.state,$e=z.properties?.address?.county;if(!(U==="Wallonie"||U==="Région wallonne"||Se.some(ne=>$e?.includes(ne)||U?.includes(ne))))continue;const Q=z.bbox,L=Array.isArray(Q)&&Q.length===4?Q.map(Number):void 0;let W;L?W=[L[0]+(L[2]-L[0])/2,L[1]+(L[3]-L[1])/2]:z.geometry?.type==="Point"&&Array.isArray(z.geometry.coordinates)?W=[Number(z.geometry.coordinates[0]),Number(z.geometry.coordinates[1])]:W=[4.4699,50.5039],C.push({type:"Feature",geometry:{type:"Point",coordinates:W},place_name:z.properties?.display_name,properties:{...z.properties,bbox:L},text:z.properties?.display_name,place_type:["place"],center:W,bbox:L})}}catch(_){console.error("forwardGeocode error:",_)}const T={type:"FeatureCollection",features:C};if(t.size>=50){const _=t.keys().next().value;_!==void 0&&t.delete(_)}return t.set(p,T),T}},m=new Me(g,{maplibregl:B,placeholder:"Cherchez une adresse en Wallonie",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});e.addControl(m,"top-left"),e.addControl(new B.NavigationControl,"top-left"),e.on("move",()=>{const l=e.getCenter();if(f(N,{lng:l.lng,lat:l.lat}),f(M,e.getZoom()),typeof window<"u"){const p=c[s(h)]?.id;p?window.location.hash=`${l.lat.toFixed(6)},${l.lng.toFixed(6)},${s(M).toFixed(2)}z,${p}`:window.location.hash=`${l.lat.toFixed(6)},${l.lng.toFixed(6)},${s(M).toFixed(2)}z`}}),e.once("idle",()=>{n||X({animate:!1})});let u=s(y).clientWidth,a=s(y).clientHeight;const d=new ResizeObserver(()=>{const l=s(y).clientWidth,p=s(y).clientHeight;(l!==u||p!==a)&&(u=l,a=p,X({animate:!1}))});d.observe(s(y));let $=null;const x=()=>{$||($=window.setTimeout(()=>{e&&e.resize(),$=null},250))};return setTimeout(()=>e.resize(),100),window.addEventListener("resize",x),window.addEventListener("orientationchange",x),()=>{R(),d.disconnect(),window.removeEventListener("resize",x),window.removeEventListener("orientationchange",x),e.remove()}}),Be();var q=De(),re=b(q);ke(re,t=>f(y,t),()=>s(y));var H=A(re,2),ve=b(H,!0);w(H);var D=A(H,2),we=b(D);Ee(we,{get lat(){return s(N).lat},get lng(){return s(N).lng},get zoom(){return s(M)}}),w(D);var oe=A(D,2),Z=b(oe),Y=b(Z),be=b(Y);{var xe=t=>{var o=Ne();E(t,o)},_e=t=>{var o=qe();E(t,o)};Te(be,t=>{s(P)?t(xe):t(_e,!1)})}w(Y),w(Z);var ae=A(Z,2),O=b(ae),ze=b(O);w(O);var se=A(O,2);We(se,5,()=>c,Ae,(t,o,n)=>{const i=Ce(()=>n/(c.length-1)*100);var r=He();let v;var g=b(r),m=b(g,!0);w(g),w(r),ie(u=>{v=Re(r,1,"year-marker svelte-wish1j",null,v,u),de(r,`left: ${s(i)??""}%`),ce(m,s(o).displayYear)},[()=>({active:n===s(h)})]),le("click",r,()=>he(n)),E(t,r)}),w(se),w(ae),w(oe),w(q),ie(()=>{ce(ve,c[s(h)].displayYear),de(ze,`width: ${s(S)??""}%`)}),le("click",Y,ye),E(G,q),Pe()}var Ye=V('<div class="page-container svelte-lwifl2"><!></div>');function at(G){var I=Ye();je(e=>{Fe.title="Travel in Time - Orthophotos Wallonie"});var y=b(I);Ze(y,{}),w(I),E(G,I)}export{at as component};
