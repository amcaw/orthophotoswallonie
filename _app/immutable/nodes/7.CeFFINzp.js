import"../chunks/DsnmJJEf.js";import"../chunks/CQmyZwkG.js";import{I as he,A as se,B as ye,C as ae,J as be,F as ie,D as I,w as i,K as z,M as h,G as le}from"../chunks/CwdBl0A7.js";import{o as ve,e as we}from"../chunks/CWmqxiNW.js";import{S as xe,s as te,m as y,M as oe}from"../chunks/B8IqOMgz.js";import{b as ne}from"../chunks/Cgb6JafD.js";import{i as Ce}from"../chunks/Ci2bA8W4.js";import{o as re}from"../chunks/CUZUMNKG.js";var Me=se('<div class="map-lens-wrapper svelte-1kjt96t"><div></div> <div></div> <div class="lens-border svelte-1kjt96t"></div> <button class="swap-button svelte-1kjt96t" title="Inverser les couches"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1kjt96t"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg></button> <!></div>');function ke(F,w){he(w,!1);let x=z(),T=z(),a,r,S=z(!1),A=z({lng:4.5,lat:50.5}),C=z(8);const ce=[[2.75,49.45],[6.5,50.85]],D=[[2,49],[7.2,51.3]];function de(){h(S,!i(S))}ve(()=>{let l=!1;const g=new Map;let L;const K=()=>{if(typeof window>"u")return!1;const e=window.location.hash.slice(1);if(!e)return!1;const t=e.split(",");if(t.length===3){const o=parseFloat(t[0]),s=parseFloat(t[1]),u=parseFloat(t[2].replace("z",""));if(!isNaN(o)&&!isNaN(s)&&!isNaN(u))return L={center:[s,o],zoom:u},!0}return!1};K()||setTimeout(()=>K(),10);const R=re.orthophotos.find(e=>e.id==="ortho-1971"),B=re.orthophotos.find(e=>e.id==="ortho-2023-ete"),U=L?{center:L.center,zoom:L.zoom}:{bounds:ce,fitBoundsOptions:{padding:-50}};r=new y.Map({container:i(T),style:{version:8,sources:{[B.id]:{type:"raster",tiles:[`${B.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&f=image`],tileSize:256}},layers:[{id:`${B.id}-layer`,type:"raster",source:B.id,paint:{}}]},...U,minZoom:7,maxZoom:17,maxBounds:D,attributionControl:!1}),a=new y.Map({container:i(x),style:{version:8,sources:{[R.id]:{type:"raster",tiles:[`${R.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&f=image`],tileSize:256}},layers:[{id:`${R.id}-layer`,type:"raster",source:R.id,paint:{}}]},...U,minZoom:7,maxZoom:17,maxBounds:D,attributionControl:!1}),r.on("error",e=>{console.warn("AfterMap tile loading error:",e)}),a.on("error",e=>{console.warn("BeforeMap tile loading error:",e)}),r.addControl(new y.NavigationControl,"bottom-left"),a.addControl(new y.NavigationControl,"bottom-left"),r.addControl(new y.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const J={forwardGeocode:async e=>{const t=(e.query??"").trim().toLowerCase();if(g.has(t))return g.get(t);const o=[];try{const u=encodeURIComponent(t);if(!u)return{type:"FeatureCollection",features:o};const ue=`https://nominatim.openstreetmap.org/search?q=${u}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,fe=await(await fetch(ue,{headers:{"Accept-Language":"fr"}})).json(),me=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const c of fe.features??[]){const q=c.properties?.address?.state,ge=c.properties?.address?.county;if(!(q==="Wallonie"||q==="Région wallonne"||me.some(f=>ge?.includes(f)||q?.includes(f))))continue;const W=c.bbox,m=Array.isArray(W)&&W.length===4?W.map(Number):void 0;let b;if(m)b=[m[0]+(m[2]-m[0])/2,m[1]+(m[3]-m[1])/2];else if(c.geometry?.type==="Point"&&Array.isArray(c.geometry.coordinates))b=[Number(c.geometry.coordinates[0]),Number(c.geometry.coordinates[1])];else{const f=[],ee=n=>{n&&(n.type==="Point"?f.push([+n.coordinates[0],+n.coordinates[1]]):n.type==="LineString"||n.type==="MultiPoint"?n.coordinates.forEach(d=>f.push([+d[0],+d[1]])):n.type==="Polygon"||n.type==="MultiLineString"?n.coordinates.flat(1).forEach(d=>f.push([+d[0],+d[1]])):n.type==="MultiPolygon"?n.coordinates.flat(2).forEach(d=>f.push([+d[0],+d[1]])):n.type==="GeometryCollection"&&(n.geometries||[]).forEach(ee))};if(ee(c.geometry),f.length){const n=f.map(Z=>Z[0]),d=f.map(Z=>Z[1]),v=[Math.min(...n),Math.min(...d),Math.max(...n),Math.max(...d)];b=[v[0]+(v[2]-v[0])/2,v[1]+(v[3]-v[1])/2]}else b=[4.4699,50.5039]}o.push({type:"Feature",geometry:{type:"Point",coordinates:b},place_name:c.properties?.display_name,properties:{...c.properties,bbox:m},text:c.properties?.display_name,place_type:["place"],center:b,bbox:m})}}catch(u){console.error("forwardGeocode error:",u)}const s={type:"FeatureCollection",features:o};if(g.size>=50){const u=g.keys().next().value;u!==void 0&&g.delete(u)}return g.set(t,s),s}},M=new oe(J,{maplibregl:y,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});r.addControl(M,"top-left");const _=new oe(J,{maplibregl:y,placeholder:"Cherchez une adresse en Wallonie",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});a.addControl(_,"top-left");const V=e=>{const t=e.bbox??e.properties?.bbox;t&&Array.isArray(t)&&t.length===4?r.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):r.flyTo({center:e.center,zoom:15,duration:1200})};let k=[],p=0;const Y=e=>{k=e.features||[],p=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(o=>o.classList.remove("active")),t[0].classList.add("active"))},50)};M.on("results",Y),_.on("results",Y),setTimeout(()=>{const e=document.querySelector(".maplibregl-ctrl-geocoder input");e&&e.addEventListener("keydown",t=>{const o=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&k.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const s=k[p];s&&(V(s),t.target.value="",M.clear(),k=[])}else t.key==="ArrowDown"&&o.length>0?(t.preventDefault(),p=Math.min(p+1,k.length-1),o.forEach(s=>s.classList.remove("active")),o[p]&&o[p].classList.add("active")):t.key==="ArrowUp"&&o.length>0&&(t.preventDefault(),p=Math.max(p-1,0),o.forEach(s=>s.classList.remove("active")),o[p]&&o[p].classList.add("active"))},!0)},100);const Q=e=>{const t=e.result;V(t),setTimeout(()=>{M.clear(),_.clear(),document.querySelectorAll(".maplibregl-ctrl-geocoder input").forEach(s=>s.value="")},100)};M.on("result",Q),_.on("result",Q);const X=(e,t)=>{l||(l=!0,t.jumpTo({center:e.getCenter(),zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()}),requestAnimationFrame(()=>{l=!1}))};r.on("move",()=>{if(!l){X(r,a);const e=r.getCenter();h(A,{lng:e.lng,lat:e.lat}),h(C,r.getZoom()),typeof window<"u"&&(window.location.hash=`${e.lat.toFixed(6)},${e.lng.toFixed(6)},${i(C).toFixed(2)}z`)}}),a.on("move",()=>{if(!l){X(a,r);const e=a.getCenter();h(A,{lng:e.lng,lat:e.lat}),h(C,a.getZoom()),typeof window<"u"&&(window.location.hash=`${e.lat.toFixed(6)},${e.lng.toFixed(6)},${i(C).toFixed(2)}z`)}});let P=null;const $=()=>{P||(P=window.setTimeout(()=>{a&&a.resize(),r&&r.resize(),P=null},250))};return setTimeout($,100),window.addEventListener("resize",$),()=>{window.removeEventListener("resize",$),a.remove(),r.remove()}}),Ce();var j=Me(),E=ie(j);let G;ne(E,l=>h(T,l),()=>i(T));var N=I(E,2);let O;ne(N,l=>h(x,l),()=>i(x));var H=I(N,4),pe=I(H,2);xe(pe,{get lat(){return i(A).lat},get lng(){return i(A).lng},get zoom(){return i(C)},yearBefore:"ortho-1971",yearAfter:"ortho-2023"}),le(j),ye((l,g)=>{G=te(E,1,"map-container after svelte-1kjt96t",null,G,l),O=te(N,1,"map-container before svelte-1kjt96t",null,O,g)},[()=>({lens:i(S)}),()=>({lens:!i(S)})]),we("click",H,de),ae(F,j),be()}var ze=se('<div class="map-container svelte-1mf7qal"><!></div>');function Ne(F){var w=ze(),x=ie(w);ke(x,{}),le(w),ae(F,w)}export{Ne as component};
