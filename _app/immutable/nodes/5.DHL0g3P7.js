import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Ie,K as S,A as we,B as _e,C as Se,J as Ge,am as W,F as j,D as N,w as a,M as y,G as V}from"../chunks/Ehb9Q6W5.js";import{o as Ne,e as P}from"../chunks/BKIJojkU.js";import{s as he}from"../chunks/yJVuIktW.js";import{b as ce}from"../chunks/m2zDNTuv.js";import{i as ke}from"../chunks/D631TkqT.js";import{S as De,m as k,M as Fe}from"../chunks/VYvS0YDk.js";import{o as ve}from"../chunks/C4AmPXCP.js";import{Y as be}from"../chunks/Br037vyA.js";var He=we('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div> <!></div> <!> <!></div>');function Oe(X,R){Ie(R,!1);let z=S(),K=S(),C=S(),i,b,D=S(50),E=!1,Q=S({lng:4.35,lat:50.85}),ue=S(11);function Ee(e){const s=ve;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${s.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`:`${s.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=256&HEIGHT=256&BBOX={bbox-epsg-3857}`}const f=ve.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let T=S(f[0].id),x=S(f[f.length-1].id);function Be(e){e.preventDefault(),e.stopPropagation(),E=!0}function Ce(e){if(!E||!a(C))return;e.preventDefault();const s=a(C).getBoundingClientRect(),d=e.clientX-s.left;y(D,Math.max(0,Math.min(100,d/s.width*100)))}function Te(){E=!1}function xe(e){e.preventDefault(),e.stopPropagation(),E=!0}function Le(e){if(!E||!a(C))return;e.preventDefault();const s=a(C).getBoundingClientRect(),d=e.touches[0].clientX-s.left;y(D,Math.max(0,Math.min(100,d/s.width*100)))}function Ae(){E=!1}function F(e,s){const d=e.getStyle();if(d?.layers)for(const r of d.layers){if(!r.id.endsWith("-layer"))continue;e.getLayer(r.id)&&e.removeLayer(r.id);const l=r.source;l&&e.getSource(l)&&e.removeSource(l)}s.layers.forEach(r=>{const l=r.id,I=`${r.id}-layer`;e.getSource(l)||e.addSource(l,{type:"raster",tiles:[Ee(r)],tileSize:256,maxzoom:20}),e.getLayer(I)||e.addLayer({id:I,type:"raster",source:l,paint:{"raster-opacity":0,"raster-fade-duration":0,"raster-resampling":"nearest"}})}),s.layers.forEach(r=>{const l=`${r.id}-layer`;e.getLayer(l)&&e.moveLayer(l)});const g=s.layers.map(r=>`${r.id}-layer`);let $=0;const U=g.length,te=()=>{$++,$>=U&&g.forEach(r=>{e.getLayer(r)&&e.setPaintProperty(r,"raster-opacity",1)})},Y=r=>{r.isSourceLoaded&&r.sourceId&&s.layers.some(l=>l.id===r.sourceId)&&te()};e.on("sourcedata",Y),setTimeout(()=>{e.off("sourcedata",Y),g.forEach(r=>{e.getLayer(r)&&e.getPaintProperty(r,"raster-opacity")===0&&e.setPaintProperty(r,"raster-opacity",1)})},2e3)}let M=null;function Pe(e){if(!i)return;const s=f.find(d=>d.id===e);s&&(F(i,s),y(T,e),M&&M(!0))}function Re(e){if(!b)return;const s=f.find(d=>d.id===e);s&&(F(b,s),y(x,e),M&&M(!0))}Ne(async()=>{let e=null;const s=()=>{if(typeof window>"u")return!1;const o=window.location.hash.slice(1);if(!o)return!1;const t=o.split(",");if(t.length>=3){const n=parseFloat(t[0]),c=parseFloat(t[1]),v=parseFloat(t[2].replace("z",""));if(!isNaN(n)&&!isNaN(c)&&!isNaN(v)){if(e={center:[c,n],zoom:v},t.length>=5){const q=t[3],ae=t[4];f.find(G=>G.id===q)&&y(T,q),f.find(G=>G.id===ae)&&y(x,ae)}return!0}}return!1};s()||(await new Promise(o=>setTimeout(o,10)),s());let d=!1;const g=new Map,$=[[4.243,50.764],[4.482,50.913]],U=[[4.05,50.65],[4.68,51.05]],te=f.find(o=>o.id===a(T)),Y=f.find(o=>o.id===a(x));i=new k.Map({container:a(z),style:{version:8,sources:{},layers:[]},...e?{center:e.center,zoom:e.zoom}:{bounds:$,fitBoundsOptions:{padding:0}},minZoom:10,maxZoom:20,maxBounds:U,attributionControl:!1}),b=new k.Map({container:a(K),style:{version:8,sources:{},layers:[]},...e?{center:e.center,zoom:e.zoom}:{bounds:$,fitBoundsOptions:{padding:0}},minZoom:10,maxZoom:20,maxBounds:U,interactive:!1,attributionControl:!1}),i.once("load",()=>F(i,te)),b.once("load",()=>F(b,Y)),i.addControl(new k.NavigationControl,"bottom-left"),i.addControl(new k.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const r={forwardGeocode:async o=>{const t=(o.query??"").trim().toLowerCase();if(g.has(t))return g.get(t);const n=[];try{const v=encodeURIComponent(t);if(!v)return{type:"FeatureCollection",features:n};const q=`https://nominatim.openstreetmap.org/search?q=${v}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,G=await(await fetch(q,{headers:{"Accept-Language":"fr"}})).json();for(const p of G.features??[]){const ye=p.properties?.address?.region,Z=p.properties?.address?.state;if(!(ye?.includes("Bruxelles")||ye?.includes("Brussels")||Z==="Bruxelles-Capitale"||Z==="Brussels Hoofdstedelijk Gewest"||Z==="Région de Bruxelles-Capitale"||Z==="Brussels-Capital"))continue;const ie=p.bbox,w=Array.isArray(ie)&&ie.length===4?ie.map(Number):void 0;let L;if(w)L=[w[0]+(w[2]-w[0])/2,w[1]+(w[3]-w[1])/2];else if(p.geometry?.type==="Point"&&Array.isArray(p.geometry.coordinates))L=[Number(p.geometry.coordinates[0]),Number(p.geometry.coordinates[1])];else{const B=[],ge=u=>{u&&(u.type==="Point"?B.push([+u.coordinates[0],+u.coordinates[1]]):u.type==="LineString"||u.type==="MultiPoint"?u.coordinates.forEach(m=>B.push([+m[0],+m[1]])):u.type==="Polygon"||u.type==="MultiLineString"?u.coordinates.flat(1).forEach(m=>B.push([+m[0],+m[1]])):u.type==="MultiPolygon"?u.coordinates.flat(2).forEach(m=>B.push([+m[0],+m[1]])):u.type==="GeometryCollection"&&(u.geometries||[]).forEach(ge))};if(ge(p.geometry),B.length){const u=B.map(le=>le[0]),m=B.map(le=>le[1]),A=[Math.min(...u),Math.min(...m),Math.max(...u),Math.max(...m)];L=[A[0]+(A[2]-A[0])/2,A[1]+(A[3]-A[1])/2]}else L=[4.3517,50.8503]}n.push({type:"Feature",geometry:{type:"Point",coordinates:L},place_name:p.properties?.display_name,properties:{...p.properties,bbox:w},text:p.properties?.display_name,place_type:["place"],center:L,bbox:w})}}catch(v){console.error("forwardGeocode error:",v)}const c={type:"FeatureCollection",features:n};if(g.size>=50){const v=g.keys().next().value;v!==void 0&&g.delete(v)}return g.set(t,c),c}},l=new Fe(r,{maplibregl:k,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});i.addControl(l,"top-left");const I=o=>{const t=o.bbox??o.properties?.bbox;t&&Array.isArray(t)&&t.length===4?i.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):i.flyTo({center:o.center,zoom:15,duration:1200})};let _=[],h=0;l.on("results",o=>{_=o.features||[],h=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(n=>n.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&o.addEventListener("keydown",t=>{const n=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&_.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const c=_[h];c&&(I(c),t.target.value="",l.clear(),_=[])}else t.key==="ArrowDown"&&n.length>0?(t.preventDefault(),h=Math.min(h+1,_.length-1),n.forEach(c=>c.classList.remove("active")),n[h]&&n[h].classList.add("active")):t.key==="ArrowUp"&&n.length>0&&(t.preventDefault(),h=Math.max(h-1,0),n.forEach(c=>c.classList.remove("active")),n[h]&&n[h].classList.add("active"))},!0)},100),l.on("result",o=>{const t=o.result;I(t),setTimeout(()=>{const n=document.querySelector(".maplibregl-ctrl-geocoder input");n&&(n.value=""),l.clear()},100)});const $e=(o,t)=>{d||(d=!0,t.jumpTo({center:o.getCenter(),zoom:o.getZoom(),bearing:o.getBearing(),pitch:o.getPitch()}),requestAnimationFrame(()=>{d=!1}))};let oe=null,me="";const re=(o=!1)=>{if(typeof window>"u"||!i)return;const t=i.getCenter(),n=i.getZoom(),c=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${n.toFixed(2)}z,${a(T)},${a(x)}`;c!==me&&(me=c,o?window.location.hash=c:history.replaceState(null,"",`#${c}`))};M=re,i.on("move",()=>{!E&&!d&&$e(i,b);const o=i.getCenter();y(Q,{lng:o.lng,lat:o.lat}),y(ue,i.getZoom()),re(!1),oe&&clearTimeout(oe),oe=window.setTimeout(()=>{re(!0)},1e3)});let se=null;const ne=()=>{se||(se=window.setTimeout(()=>{i&&i.resize(),b&&b.resize(),se=null},250))};return setTimeout(ne,100),window.addEventListener("resize",ne),()=>{window.removeEventListener("resize",ne),i.remove(),b.remove()}}),ke();var J=He();P("mousemove",W,Ce),P("mouseup",W,Te),P("touchmove",W,Le),P("touchend",W,Ae);var H=j(J),de=j(H);ce(de,e=>y(z,e),()=>a(z));var ee=N(de,2);ce(ee,e=>y(K,e),()=>a(K));var O=N(ee,2),fe=j(O);V(O);var ze=N(O,2);De(ze,{get lat(){return a(Q).lat},get lng(){return a(Q).lng},get zoom(){return a(ue)},get yearBefore(){return a(T)},get yearAfter(){return a(x)}}),V(H),ce(H,e=>y(C,e),()=>a(C));var pe=N(H,2);be(pe,{side:"left",get groups(){return f},get selectedId(){return a(T)},$$events:{select:e=>Pe(e.detail.id)}});var Me=N(pe,2);be(Me,{side:"right",get groups(){return f},get selectedId(){return a(x)},$$events:{select:e=>Re(e.detail.id)}}),V(J),_e(()=>{he(ee,`clip-path: inset(0 0 0 ${a(D)??""}%)`),he(O,`left: ${a(D)??""}%`)}),P("mousedown",fe,Be),P("touchstart",fe,xe),Se(X,J),Ge()}var Ue=we('<div class="page-container svelte-1ewpa8p"><!></div>');function tt(X){var R=Ue(),z=j(R);Oe(z,{}),V(R),Se(X,R)}export{tt as component};
