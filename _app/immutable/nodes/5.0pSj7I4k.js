import"../chunks/DsnmJJEf.js";import"../chunks/z-ChGS7w.js";import{I as Ke,K as L,A as _e,B as Qe,C as Ne,J as et,am as W,F as ee,D as Z,w as c,M as y,G as te}from"../chunks/Ehb9Q6W5.js";import{o as tt,e as N}from"../chunks/BKIJojkU.js";import{s as Ae}from"../chunks/yJVuIktW.js";import{b as he}from"../chunks/m2zDNTuv.js";import{i as ot}from"../chunks/D631TkqT.js";import{S as rt,m as V,M as nt}from"../chunks/VYvS0YDk.js";import{o as Re}from"../chunks/C4AmPXCP.js";import{Y as $e}from"../chunks/Br037vyA.js";var st=_e('<div class="timelapse-container svelte-1awtn06"><div class="map-wrapper svelte-1awtn06"><div class="map-container before svelte-1awtn06"></div> <div class="map-container after svelte-1awtn06"></div> <div class="compare-slider svelte-1awtn06"><div class="slider-handle svelte-1awtn06" role="button" tabindex="0"><span class="slider-arrows svelte-1awtn06">◄ ►</span></div></div> <!></div> <!> <!></div>');function at(oe,D){Ke(D,!1);let O=L(),re=L(),P=L(),a,m,ne=L(50),I=!1,T=null,se=null;function ye(e){y(ne,e),se&&cancelAnimationFrame(se),se=requestAnimationFrame(()=>{m&&m.triggerRepaint()})}let ae=L({lng:4.35,lat:50.85}),ve=L(11);function Pe(e,r=512){const s=Re;return e.service==="urban-brussels"&&e.crs==="EPSG:31370"?`${s.wmsUrbanBrusselsUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${r}&HEIGHT=${r}&BBOX={bbox-epsg-3857}`:`${s.wmsBaseUrl}?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&LAYERS=${e.layer}&CRS=EPSG:3857&STYLES=&WIDTH=${r}&HEIGHT=${r}&BBOX={bbox-epsg-3857}`}const we=new WeakMap;function ze(e){let r=we.get(e);return r||(r=new Set,we.set(e,r)),r}let be=new Set;function Fe(e,r,s=3e3){return new Promise(f=>{let d=!1;const i=()=>{d||(d=!0,$(),be.delete(A),f())},A=()=>{d||(console.log("Tile wait cancelled - user is interacting"),i())};be.add(A);const Y=()=>{r.every(J=>{const K=J.replace(/-layer$/,"");return!!e.getSource(K)&&e.isSourceLoaded(K)})&&e.areTilesLoaded()&&i()},U=()=>{console.log("Map movement detected - finishing tile wait early"),i()},R=setTimeout(i,s),$=()=>{e.off("idle",Y),e.off("movestart",U),clearTimeout(R)};e.on("idle",Y),e.on("movestart",U),Y()})}function Ge(e,r,s=512){const f=r.id,d=`${r.id}-layer`;return e.getSource(f)||e.addSource(f,{type:"raster",tiles:[Pe(r,s)],tileSize:s,maxzoom:20}),e.getLayer(d)||e.addLayer({id:d,type:"raster",source:f,layout:{visibility:"visible"},paint:{"raster-opacity":0,"raster-fade-duration":300,"raster-resampling":"nearest"}}),d}const g=Re.orthophotos.map(e=>({id:e.id,year:e.year,displayYear:e.year,layers:[e]}));let E=L(g[0].id),x=L(g[g.length-1].id);function M(){I=!1,T!==null&&(clearTimeout(T),T=null)}function ke(e){e.preventDefault(),e.stopPropagation(),I=!0,T!==null&&clearTimeout(T),T=window.setTimeout(()=>{console.warn("Drag timeout - forcing reset"),M()},1e4)}function De(e){if(!I||!c(P))return;e.preventDefault();const r=c(P).getBoundingClientRect(),s=e.clientX-r.left;ye(Math.max(0,Math.min(100,s/r.width*100)))}function Oe(){M()}function He(e){I=!0,T!==null&&clearTimeout(T),T=window.setTimeout(()=>{console.warn("Touch timeout - forcing reset"),M()},1e4)}function Ye(e){if(!I||!c(P))return;if(!e.touches||e.touches.length===0){M();return}const r=c(P).getBoundingClientRect(),s=e.touches[0].clientX-r.left;ye(Math.max(0,Math.min(100,s/r.width*100)))}function Ue(){M()}function qe(){M()}function Te(){document.hidden&&I&&(console.log("Page hidden - resetting drag state"),M())}async function z(e,r){const s=ze(e),f=[...s],d=r.layers.map(i=>Ge(e,i,512));d.forEach(i=>e.moveLayer(i)),await Fe(e,d,3e3),d.forEach(i=>{e.getLayer(i)&&e.setPaintProperty(i,"raster-opacity",1)}),f.forEach(i=>{e.getLayer(i)&&e.setPaintProperty(i,"raster-opacity",0)}),setTimeout(()=>{f.forEach(i=>{if(!d.includes(i)){const A=i.replace(/-layer$/,"");e.getLayer(i)&&e.removeLayer(i),e.getSource(A)&&e.removeSource(A),s.delete(i)}}),d.forEach(i=>s.add(i))},400)}let H=null;function We(e){if(!a)return;const r=g.find(s=>s.id===e);r&&(z(a,r),y(E,e),H&&H(!0))}function Ze(e){if(!m)return;const r=g.find(s=>s.id===e);r&&(z(m,r),y(x,e),H&&H(!0))}tt(()=>{let e=null;(()=>{if(typeof window>"u")return!1;const o=window.location.hash.slice(1);if(!o)return!1;const t=o.split(",");if(t.length>=3){const n=parseFloat(t[0]),l=parseFloat(t[1]),h=parseFloat(t[2].replace("z",""));if(!isNaN(n)&&!isNaN(l)&&!isNaN(h)){if(e={center:[l,n],zoom:h},t.length>=5){const S=t[3],B=t[4];g.find(v=>v.id===S)&&y(E,S),g.find(v=>v.id===B)&&y(x,B)}return!0}}return!1})();let s=!1;const f=new Map,d=[[4.243,50.764],[4.482,50.913]],i=[[4.05,50.65],[4.68,51.05]],A=g.find(o=>o.id===c(E)),Y=g.find(o=>o.id===c(x)),U={version:8,sources:{positron:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://b.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png","https://c.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> © <a href="https://carto.com/attributions">CARTO</a>'}},layers:[{id:"positron-layer",type:"raster",source:"positron",paint:{"raster-opacity":1}}]},R={container:c(O),style:U,minZoom:10,maxZoom:20,maxBounds:i,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?(R.center=e.center,R.zoom=e.zoom):(R.bounds=d,R.fitBoundsOptions={padding:0}),a=new V.Map(R);const $={container:c(re),style:JSON.parse(JSON.stringify(U)),minZoom:10,maxZoom:20,maxBounds:i,interactive:!1,attributionControl:!1,renderWorldCopies:!1,fadeDuration:0};e?($.center=e.center,$.zoom=e.zoom):($.bounds=d,$.fitBoundsOptions={padding:0}),m=new V.Map($);const ce=new Map,J=o=>t=>{if(console.warn("Map error:",t?.error?.status,t?.sourceId),t.sourceId&&t.error?.status>=500){const n=ce.get(t.sourceId)||0;n<2&&(ce.set(t.sourceId,n+1),setTimeout(()=>{const l=o.getSource(t.sourceId);l&&"reload"in l&&l.reload()},1e3*(n+1)))}};a.on("error",J(a)),m.on("error",J(m)),a.once("load",()=>z(a,A)),m.once("load",()=>z(m,Y)),a.addControl(new V.NavigationControl,"bottom-left"),a.addControl(new V.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Creative Commons Attribution (CC-BY) - <a href="https://be.brussels/en/about-region/structure-and-organisations/administrations-and-institutions-region/paradigm" target="_blank">Paradigm</a> - <a href="https://bruciel.brussels/" target="_blank">Bruciel</a>'}),"bottom-right");const K={forwardGeocode:async o=>{const t=(o.query??"").trim().toLowerCase();if(f.has(t))return f.get(t);const n=[];try{const h=encodeURIComponent(t);if(!h)return{type:"FeatureCollection",features:n};const S=`https://nominatim.openstreetmap.org/search?q=${h}, Bruxelles&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,v=await(await fetch(S,{headers:{"Accept-Language":"fr"}})).json();for(const p of v.features??[]){const Le=p.properties?.address?.region,Q=p.properties?.address?.state;if(!(Le?.includes("Bruxelles")||Le?.includes("Brussels")||Q==="Bruxelles-Capitale"||Q==="Brussels Hoofdstedelijk Gewest"||Q==="Région de Bruxelles-Capitale"||Q==="Brussels-Capital"))continue;const me=p.bbox,C=Array.isArray(me)&&me.length===4?me.map(Number):void 0;let G;if(C)G=[C[0]+(C[2]-C[0])/2,C[1]+(C[3]-C[1])/2];else if(p.geometry?.type==="Point"&&Array.isArray(p.geometry.coordinates))G=[Number(p.geometry.coordinates[0]),Number(p.geometry.coordinates[1])];else{const _=[],Ie=u=>{u&&(u.type==="Point"?_.push([+u.coordinates[0],+u.coordinates[1]]):u.type==="LineString"||u.type==="MultiPoint"?u.coordinates.forEach(w=>_.push([+w[0],+w[1]])):u.type==="Polygon"||u.type==="MultiLineString"?u.coordinates.flat(1).forEach(w=>_.push([+w[0],+w[1]])):u.type==="MultiPolygon"?u.coordinates.flat(2).forEach(w=>_.push([+w[0],+w[1]])):u.type==="GeometryCollection"&&(u.geometries||[]).forEach(Ie))};if(Ie(p.geometry),_.length){const u=_.map(ge=>ge[0]),w=_.map(ge=>ge[1]),k=[Math.min(...u),Math.min(...w),Math.max(...u),Math.max(...w)];G=[k[0]+(k[2]-k[0])/2,k[1]+(k[3]-k[1])/2]}else G=[4.3517,50.8503]}n.push({type:"Feature",geometry:{type:"Point",coordinates:G},place_name:p.properties?.display_name,properties:{...p.properties,bbox:C},text:p.properties?.display_name,place_type:["place"],center:G,bbox:C})}}catch(h){console.error("forwardGeocode error:",h)}const l={type:"FeatureCollection",features:n};if(f.size>=50){const h=f.keys().next().value;h!==void 0&&f.delete(h)}return f.set(t,l),l}},F=new nt(K,{maplibregl:V,placeholder:"Cherchez une adresse à Bruxelles",flyTo:!1,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});a.addControl(F,"top-left");const xe=o=>{const t=o.bbox??o.properties?.bbox;t&&Array.isArray(t)&&t.length===4?a.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:50,maxZoom:16,duration:1200}):a.flyTo({center:o.center,zoom:15,duration:1200})};let q=[],b=0;F.on("results",o=>{q=o.features||[],b=0,setTimeout(()=>{const t=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");t.length>0&&(t.forEach(n=>n.classList.remove("active")),t[0].classList.add("active"))},50)}),setTimeout(()=>{const o=document.querySelector(".maplibregl-ctrl-geocoder input");o&&o.addEventListener("keydown",t=>{const n=document.querySelectorAll(".maplibregl-ctrl-geocoder .suggestions > li");if(t.key==="Enter"&&q.length>0){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const l=q[b];l&&(xe(l),t.target.value="",F.clear(),q=[])}else t.key==="ArrowDown"&&n.length>0?(t.preventDefault(),b=Math.min(b+1,q.length-1),n.forEach(l=>l.classList.remove("active")),n[b]&&n[b].classList.add("active")):t.key==="ArrowUp"&&n.length>0&&(t.preventDefault(),b=Math.max(b-1,0),n.forEach(l=>l.classList.remove("active")),n[b]&&n[b].classList.add("active"))},!0)},100),F.on("result",o=>{const t=o.result;xe(t),setTimeout(()=>{const n=document.querySelector(".maplibregl-ctrl-geocoder input");n&&(n.value=""),F.clear()},100)});const Xe=(o,t)=>{s||(s=!0,t.jumpTo({center:o.getCenter(),zoom:o.getZoom(),bearing:o.getBearing(),pitch:o.getPitch()}),requestAnimationFrame(()=>{s=!1}))};let ue=null,Me="";const de=(o=!1)=>{if(typeof window>"u"||!a)return;const t=a.getCenter(),n=a.getZoom(),l=`${t.lat.toFixed(6)},${t.lng.toFixed(6)},${n.toFixed(2)}z,${c(E)},${c(x)}`;l!==Me&&(Me=l,o?window.location.hash=l:history.replaceState(null,"",`#${l}`))};H=de,a.on("move",()=>{!I&&!s&&Xe(a,m);const o=a.getCenter();y(ae,{lng:o.lng,lat:o.lat}),y(ve,a.getZoom()),de(!1),ue&&clearTimeout(ue),ue=window.setTimeout(()=>{de(!0)},1e3)});let fe=null;const pe=()=>{fe||(fe=window.setTimeout(()=>{a&&a.resize(),m&&m.resize(),fe=null},250))};setTimeout(pe,100),window.addEventListener("resize",pe);const Be=()=>{if(typeof window>"u")return;const o=window.location.hash.slice(1);if(!o)return;const t=o.split(",");if(t.length>=3){const n=parseFloat(t[0]),l=parseFloat(t[1]),h=parseFloat(t[2].replace("z",""));if(!isNaN(n)&&!isNaN(l)&&!isNaN(h)&&(a&&a.flyTo({center:[l,n],zoom:h,duration:1e3}),t.length>=5)){const S=t[3],B=t[4];if(S&&S!==c(E)){const v=g.find(p=>p.id===S);v&&(y(E,S),z(a,v))}if(B&&B!==c(x)){const v=g.find(p=>p.id===B);v&&(y(x,B),z(m,v))}}}};window.addEventListener("hashchange",Be),document.addEventListener("visibilitychange",Te);const Je=setInterval(()=>{s&&(console.warn("isSyncing stuck - forcing reset"),s=!1)},5e3);return()=>{window.removeEventListener("resize",pe),window.removeEventListener("hashchange",Be),document.removeEventListener("visibilitychange",Te),clearInterval(Je),M(),a.remove(),m.remove()}}),ot();var ie=st();N("mousemove",W,De),N("mouseup",W,Oe),N("touchmove",W,Ye),N("touchend",W,Ue),N("touchcancel",W,qe);var j=ee(ie),Se=ee(j);he(Se,e=>y(O,e),()=>c(O));var le=Z(Se,2);he(le,e=>y(re,e),()=>c(re));var X=Z(le,2),Ce=ee(X);te(X);var Ve=Z(X,2);rt(Ve,{get lat(){return c(ae).lat},get lng(){return c(ae).lng},get zoom(){return c(ve)},get yearBefore(){return c(E)},get yearAfter(){return c(x)}}),te(j),he(j,e=>y(P,e),()=>c(P));var Ee=Z(j,2);$e(Ee,{side:"left",get groups(){return g},get selectedId(){return c(E)},$$events:{select:e=>We(e.detail.id)}});var je=Z(Ee,2);$e(je,{side:"right",get groups(){return g},get selectedId(){return c(x)},$$events:{select:e=>Ze(e.detail.id)}}),te(ie),Qe(()=>{Ae(le,`clip-path: inset(0 0 0 calc(${c(ne)??""}% - 0.5px))`),Ae(X,`left: ${c(ne)??""}%`)}),N("mousedown",Ce,ke),N("touchstart",Ce,He),Ne(oe,ie),et()}var it=_e('<div class="page-container svelte-1ewpa8p"><!></div>');function wt(oe){var D=it(),O=ee(D);at(O,{}),te(D),Ne(oe,D)}export{wt as component};
