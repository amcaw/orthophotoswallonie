import"../chunks/DsnmJJEf.js";import"../chunks/CoDSuzm1.js";import{I as Fe,A as ee,B as fe,C as R,J as je,F as z,w as s,D as M,K as F,M as f,G as b,am as he,P as We,an as Ee}from"../chunks/BILf7VAl.js";import{o as Ne,e as me,s as ge,h as Ae}from"../chunks/XYDQtagk.js";import{i as Me}from"../chunks/BDAy6SKk.js";import{e as Re,i as He,s as ye}from"../chunks/MQgf3nuD.js";import{S as ke,m as B,M as Be,s as Ge}from"../chunks/CccdXG49.js";import{b as qe}from"../chunks/B7CElIPH.js";import{i as De}from"../chunks/MHw7BI_m.js";import{o as Ze}from"../chunks/CUZUMNKG.js";var Ye=he('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'),Oe=he('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"></polygon></svg>'),Ue=ee('<button><span class="year-label svelte-wish1j"> </span></button>'),Ke=ee('<div class="travel-container svelte-wish1j"><div class="map-container svelte-wish1j"></div> <div class="year-overlay svelte-wish1j"> </div> <div class="share-wrapper-traveltime svelte-wish1j"><!></div> <div class="playbar svelte-wish1j"><div class="playbar-controls svelte-wish1j"><button class="playbar-btn svelte-wish1j"><!></button></div> <div class="timeline svelte-wish1j"><div class="timeline-track svelte-wish1j"><div class="timeline-progress svelte-wish1j"></div></div> <div class="timeline-years svelte-wish1j"></div></div></div></div>');function Je(G,j){Fe(j,!1);let g=F(),e,I=F(!1),y=F(0),W=null,L=F(0),q=F({lng:4.5,lat:50.5}),te=F(8);const ve=[[2.75,49.45],[6.5,50.85]],we=[[2,49],[7.2,51.3]];function be(t){const a=t.clientWidth||window.innerWidth,o=t.clientHeight||window.innerHeight,i=Math.round(Math.max(12,Math.min(a,o)*.03)),r=a<768,v=r?120:80;return{top:i+(r?30:40),right:i+10,bottom:i+v,left:i+10}}function re(t){if(!e||!s(g))return;const a=be(s(g));e.resize();const o=s(g).clientWidth||window.innerWidth,i=o<640?5.5:o<1024?6:o<1300?6.5:7;e.setMinZoom(i);const r={top:a.top-50,right:a.right-50,bottom:a.bottom-50,left:a.left-50};e.fitBounds(ve,{padding:r,duration:t?.animate?400:0})}const d=Ze.orthophotos.reduce((t,a)=>{const o=a.year.split(" ")[0],i=t.find(r=>r.year===o);return i?i.layers.push(a):t.push({year:o,displayYear:o,layers:[a]}),t},[]).map(t=>({...t,layers:t.layers.slice().sort((a,o)=>{const i=r=>/Printemps/i.test(r)?0:/Été|Ete/i.test(r)?1:2;return i(a.year)-i(o.year)})}));function ae(){if(!e)return;const t=(s(y)+1)%d.length;d[t].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[`${r.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})});const o=(s(y)-1+d.length)%d.length;d[o].layers.forEach(r=>{e.getSource(r.id)||e.addSource(r.id,{type:"raster",tiles:[`${r.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(`${r.id}-layer`)||e.addLayer({id:`${r.id}-layer`,type:"raster",source:r.id,paint:{"raster-opacity":0,"raster-fade-duration":0}})})}function xe(){s(I)?H():_e()}function _e(){if(!e)return;f(I,!0),ae();const t=Date.now(),a=s(L)/100*(d.length-1),o=2500,i=1300,r=()=>{if(!s(I))return;const h=(Date.now()-t)/o,x=a+h;if(x>=d.length-1){f(y,d.length-1),f(L,100),H();return}const m=Math.floor(x);f(L,x/(d.length-1)*100),m!==s(y)&&(f(y,m),se(i),ae()),W=window.requestAnimationFrame(r)};W=window.requestAnimationFrame(r)}function H(){f(I,!1),W&&(cancelAnimationFrame(W),W=null);const t=Math.floor(s(L)/100*(d.length-1));t>=0&&t<d.length&&f(y,t)}let D=null;function oe(t){s(I)&&H();const o=t/(d.length-1)*100,i=s(L),r=Date.now(),v=300,h=()=>{const x=Date.now()-r,m=Math.min(x/v,1),n=1-Math.pow(1-m,3);f(L,i+(o-i)*n),m<1?requestAnimationFrame(h):f(L,o)};f(y,t),se(),h(),D&&D(!0)}function se(t=0){if(!e)return;const a=d[s(y)],o=e.getStyle();if(o?.layers)for(const n of o.layers){if(!n.id.endsWith("-layer"))continue;!a.layers.some(C=>`${C.id}-layer`===n.id)&&e.getLayer(n.id)&&(e.setPaintProperty(n.id,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(n.id,"raster-opacity",0))}a.layers.forEach(n=>{const u=n.id,C=`${n.id}-layer`;e.getSource(u)||e.addSource(u,{type:"raster",tiles:[`${n.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}),e.getLayer(C)||e.addLayer({id:C,type:"raster",source:u,paint:{"raster-opacity":0,"raster-fade-duration":0}})}),a.layers.forEach(n=>{const u=`${n.id}-layer`;e.getLayer(u)&&e.moveLayer(u)});const i=a.layers.map(n=>`${n.id}-layer`);let r=0;const v=i.length,h=()=>{i.forEach(n=>{e.getLayer(n)&&(e.setPaintProperty(n,"raster-opacity-transition",{duration:t,delay:0}),e.setPaintProperty(n,"raster-opacity",1))})},x=()=>{r++,r>=v&&h()},m=n=>{n.isSourceLoaded&&n.sourceId&&a.layers.some(u=>u.id===n.sourceId)&&x()};e.on("sourcedata",m),setTimeout(()=>{e.off("sourcedata",m),h()},t>0?t+1e3:1e3),t>0&&setTimeout(()=>{const n=e?.getStyle();if(n?.layers)for(const u of n.layers){if(!u.id.endsWith("-layer"))continue;if(!a.layers.some($=>`${$.id}-layer`===u.id)){e.getLayer(u.id)&&e.removeLayer(u.id);const $=u.source;$&&e.getSource($)&&e.removeSource($)}}},t+100)}Ne(async()=>{const t=new Map,a=d[0];let o=null;const i=()=>{if(typeof window>"u")return!1;const c=window.location.hash.slice(1);if(!c)return!1;const l=c.split(",");if(l.length>=3){const w=parseFloat(l[0]),_=parseFloat(l[1]),p=parseFloat(l[2].replace("z",""));if(!isNaN(w)&&!isNaN(_)&&!isNaN(p)){if(o={center:[_,w],zoom:p},l.length>=4){const E=l[3],T=d.findIndex(N=>N.id===E);T!==-1&&(f(y,T),f(L,T/(d.length-1)*100))}return!0}}return!1};i()||(await new Promise(c=>setTimeout(c,10)),i());const r={},v=[];a.layers.forEach(c=>{r[c.id]={type:"raster",tiles:[`${c.url}/export?bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256,256&format=png32&transparent=true&f=image`],tileSize:256,maxzoom:18}}),a.layers.forEach(c=>{v.push({id:`${c.id}-layer`,type:"raster",source:c.id,paint:{"raster-opacity":1,"raster-fade-duration":0}})}),e=new B.Map({container:s(g),style:{version:8,sources:r,layers:v},...o?{center:o.center,zoom:o.zoom}:{},maxZoom:16,minZoom:5,maxBounds:we,preserveDrawingBuffer:!0,attributionControl:!1}),e.addControl(new B.AttributionControl({customAttribution:'Made by <a href="https://bsky.app/profile/amcaw.bsky.social" target="_blank">@amcaw</a> - Service public de Wallonie (Licence CC-BY 4.0)'}),"bottom-right");const h={forwardGeocode:async c=>{const l=(c.query??"").trim().toLowerCase();if(t.has(l))return t.get(l);const w=[];try{const p=encodeURIComponent(l);if(!p)return{type:"FeatureCollection",features:w};const E=`https://nominatim.openstreetmap.org/search?q=${p}, Wallonie&format=geojson&polygon_geojson=1&addressdetails=1&countrycodes=be&limit=20`,N=await(await fetch(E,{headers:{"Accept-Language":"fr"}})).json(),Te=["Hainaut","Liège","Luxembourg","Namur","Brabant wallon"];for(const S of N.features??[]){const V=S.properties?.address?.state,Ie=S.properties?.address?.county;if(!(V==="Wallonie"||V==="Région wallonne"||Te.some(pe=>Ie?.includes(pe)||V?.includes(pe))))continue;const X=S.bbox,P=Array.isArray(X)&&X.length===4?X.map(Number):void 0;let A;P?A=[P[0]+(P[2]-P[0])/2,P[1]+(P[3]-P[1])/2]:S.geometry?.type==="Point"&&Array.isArray(S.geometry.coordinates)?A=[Number(S.geometry.coordinates[0]),Number(S.geometry.coordinates[1])]:A=[4.4699,50.5039],w.push({type:"Feature",geometry:{type:"Point",coordinates:A},place_name:S.properties?.display_name,properties:{...S.properties,bbox:P},text:S.properties?.display_name,place_type:["place"],center:A,bbox:P})}}catch(p){console.error("forwardGeocode error:",p)}const _={type:"FeatureCollection",features:w};if(t.size>=50){const p=t.keys().next().value;p!==void 0&&t.delete(p)}return t.set(l,_),_}},x=new Be(h,{maplibregl:B,placeholder:"Cherchez une adresse en Wallonie",flyTo:!0,showResultsWhileTyping:!0,marker:!1,debounceSearch:400,minLength:2,showResultMarkers:!1});e.addControl(x,"top-left"),e.addControl(new B.NavigationControl,"top-left");let m=null,n="";const u=(c=!1)=>{if(typeof window>"u"||!e)return;const l=e.getCenter(),w=e.getZoom(),_=d[s(y)]?.id,p=_?`${l.lat.toFixed(6)},${l.lng.toFixed(6)},${w.toFixed(2)}z,${_}`:`${l.lat.toFixed(6)},${l.lng.toFixed(6)},${w.toFixed(2)}z`;p!==n&&(n=p,c?window.location.hash=p:history.replaceState(null,"",`#${p}`))};D=u,e.on("move",()=>{const c=e.getCenter();f(q,{lng:c.lng,lat:c.lat}),f(te,e.getZoom()),u(!1),m&&clearTimeout(m),m=window.setTimeout(()=>{u(!0)},1e3)}),e.once("idle",()=>{o||re({animate:!1})});let C=s(g).clientWidth,$=s(g).clientHeight;const de=new ResizeObserver(()=>{const c=s(g).clientWidth,l=s(g).clientHeight;(c!==C||l!==$)&&(C=c,$=l,re({animate:!1}))});de.observe(s(g));let Q=null;const k=()=>{Q||(Q=window.setTimeout(()=>{e&&e.resize(),Q=null},250))};setTimeout(()=>e.resize(),100),window.addEventListener("resize",k),window.addEventListener("orientationchange",k);const ue=()=>{if(typeof window>"u")return;const c=window.location.hash.slice(1);if(!c)return;const l=c.split(",");if(l.length>=3){const w=parseFloat(l[0]),_=parseFloat(l[1]),p=parseFloat(l[2].replace("z",""));if(!isNaN(w)&&!isNaN(_)&&!isNaN(p)&&(e&&e.flyTo({center:[_,w],zoom:p,duration:1e3}),l.length>=4)){const E=l[3],T=d.findIndex(N=>N.id===E);T!==-1&&T!==s(y)&&oe(T)}}};return window.addEventListener("hashchange",ue),()=>{H(),de.disconnect(),window.removeEventListener("resize",k),window.removeEventListener("orientationchange",k),window.removeEventListener("hashchange",ue),e.remove()}}),De();var Z=Ke(),ne=z(Z);qe(ne,t=>f(g,t),()=>s(g));var Y=M(ne,2),ze=z(Y,!0);b(Y);var O=M(Y,2),Se=z(O);ke(Se,{get lat(){return s(q).lat},get lng(){return s(q).lng},get zoom(){return s(te)}}),b(O);var ie=M(O,2),U=z(ie),K=z(U),Le=z(K);{var Pe=t=>{var a=Ye();R(t,a)},Ce=t=>{var a=Oe();R(t,a)};Me(Le,t=>{s(I)?t(Pe):t(Ce,!1)})}b(K),b(U);var le=M(U,2),J=z(le),$e=z(J);b(J);var ce=M(J,2);Re(ce,5,()=>d,He,(t,a,o)=>{const i=We(()=>o/(d.length-1)*100);var r=Ue();let v;var h=z(r),x=z(h,!0);b(h),b(r),fe(m=>{v=Ge(r,1,"year-marker svelte-wish1j",null,v,m),ye(r,`left: ${s(i)??""}%`),ge(x,s(a).displayYear)},[()=>({active:o===s(y)})]),me("click",r,()=>oe(o)),R(t,r)}),b(ce),b(le),b(ie),b(Z),fe(()=>{ge(ze,d[s(y)].displayYear),ye($e,`width: ${s(L)??""}%`)}),me("click",K,xe),R(G,Z),je()}var Qe=ee('<div class="page-container svelte-lwifl2"><!></div>');function ct(G){var j=Qe();Ae(e=>{Ee.title="Travel in Time - Orthophotos Wallonie"});var g=z(j);Je(g,{}),b(j),R(G,j)}export{ct as component};
